<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>残剑博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Hexo theme - Icarus">
<meta property="og:type" content="website">
<meta property="og:title" content="残剑博客">
<meta property="og:url" content="http://liuling07.github.io/page/5/index.html">
<meta property="og:site_name" content="残剑博客">
<meta property="og:description" content="Hexo theme - Icarus">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="残剑博客">
<meta name="twitter:description" content="Hexo theme - Icarus">
  
  
    <link rel="icon" href="favicon.png">
  
  
 <link href='//fonts.lug.ustc.edu.cn/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
 <link href="//fonts.lug.ustc.edu.cn/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">


  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css" type="text/css">
  

  

  
</head>
<body>
  <div id="container">
    <header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="/" id="logo"><i class="logo" style="background-image: url(/css/images/logo.png)"></i><span class="site-title">残剑博客</span></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/.">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/categories">Categories</a>
        
          <a class="main-nav-link" href="/tags">Tags</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      
        <nav id="sub-nav">
          <div class="profile" id="profile-nav">
            <a id="profile-anchor" href="javascript:;"><img class="avatar" src="/css/images/protrait.jpg"><i class="fa fa-caret-down"></i></a>
          </div>
        </nav>
      
      <div id="search-form-wrap">
        
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="sitesearch" value="http://liuling07.github.io"></form>
        
      </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tr>
        
          <td><a class="main-nav-link" href="/.">Home</a></td>
        
          <td><a class="main-nav-link" href="/archives">Archives</a></td>
        
          <td><a class="main-nav-link" href="/categories">Categories</a></td>
        
          <td><a class="main-nav-link" href="/tags">Tags</a></td>
        
          <td><a class="main-nav-link" href="/about">About</a></td>
        
        <td>
          
            <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="http://liuling07.github.io"></form>
          
        </td>
      </tr>
    </table>
  </div>
</header>

    <div class="outer">
      
        <aside id="profile">
  <div class="inner profile-inner">
    <div class="base-info profile-block">
      <img id="avatar" src="/css/images/protrait.jpg">
      <h2 id="name">Lauren</h2>
      <h3 id="title">Android Developer</h3>
      <span id="location"><i class="fa fa-map-marker"></i>Shenzhen, China</span>
      <a id="follow" href="https://github.com/liuling07">FOLLOW</a>
    </div>
    <div class="article-info profile-block">
      <div class="article-info-block">
        135
        <span>posts</span>
      </div>
      <div class="article-info-block">
        32
        <span>tags</span>
      </div>
    </div>
    
    <div class="contact-info profile-block">
      <table class="contact-list">
        <tr>
          
          <td><a href="https://github.com/liuling07" target="_blank" title="github"><i class="fa fa-github"></i></a></td>
          
          <td><a href="http://weibo.com/LaurenLiuling/" target="_blank" title="weibo"><i class="fa fa-weibo"></i></a></td>
          
          <td><a href="https://plus.google.com/u/0/107098505138563589748/" target="_blank" title="google-plus"><i class="fa fa-google-plus"></i></a></td>
          
          <td><a href="http://stackoverflow.com/users/5629327/lauren-liuling" target="_blank" title="stack-overflow"><i class="fa fa-stack-overflow"></i></a></td>
          
          <td><a href="https://twitter.com/lauren_liuLing/" target="_blank" title="twitter"><i class="fa fa-twitter"></i></a></td>
          
          <td><a href="https://www.facebook.com/lauren.liuling/" target="_blank" title="facebook"><i class="fa fa-facebook"></i></a></td>
          
          <td><a href="/atom.xml" target="_blank" title="rss"><i class="fa fa-rss"></i></a></td>
          
        </tr>
      </table>
    </div>
    
    
  </div>
</aside>

      
      <section id="main">
      <article id="post-springmvc-upload" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/03/springmvc-upload.html">Spring MVC实现上传文件报错解决方案</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2014/03/springmvc-upload.html">
      <time datetime="2014-03-04T23:38:00.000Z" itemprop="datePublished">2014-03-05</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/后端/">后端</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>报错代码：</p>
<div class="cnblogs_code"><br><pre>org.springframework.beans.BeanInstantiationException: Could not instantiate bean <span style="color: #0000ff;">class</span> [org.springframework.web.multipart.MultipartFile]: Specified <span style="color: #0000ff;">class</span> is an <span style="color: #0000ff;">interface</span><span style="color: #000000;"><br>    org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:</span>101<span style="color: #000000;">)<br>    org.springframework.web.bind.annotation.support.HandlerMethodInvoker.resolveModelAttribute(HandlerMethodInvoker.java:</span>762<span style="color: #000000;">)<br>    org.springframework.web.bind.annotation.support.HandlerMethodInvoker.resolveHandlerArguments(HandlerMethodInvoker.java:</span>356<span style="color: #000000;">)<br>    org.springframework.web.bind.annotation.support.HandlerMethodInvoker.invokeHandlerMethod(HandlerMethodInvoker.java:</span>171<span style="color: #000000;">)<br>    org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.invokeHandlerMethod(AnnotationMethodHandlerAdapter.java:</span>426<span style="color: #000000;">)<br>    org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.handle(AnnotationMethodHandlerAdapter.java:</span>414<span style="color: #000000;">)<br>    org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:</span>790<span style="color: #000000;">)<br>    org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:</span>719<span style="color: #000000;">)<br>    org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:</span>644<span style="color: #000000;">)<br>    org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:</span>560<span style="color: #000000;">)<br>    javax.servlet.http.HttpServlet.service(HttpServlet.java:</span>646<span style="color: #000000;">)<br>    javax.servlet.http.HttpServlet.service(HttpServlet.java:</span>727<span style="color: #000000;">)<br>    org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:</span>52<span style="color: #000000;">)<br>    org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:</span>88<span style="color: #000000;">)<br>    org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:</span>76<span style="color: #000000;">)<br>    org.springframework.orm.hibernate3.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:</span>198<span style="color: #000000;">)<br>    org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:</span>76)</pre><br></div>

<p>&nbsp;</p>
<p>解决方案：在Controller的MultipartFile参数前面加上@RequestParam就解决了！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuling07.github.io/2014/03/springmvc-upload.html" data-id="ciiy5f4po001dq1d0vkmp2hgr" class="article-share-link">Share</a>
      
        <a href="http://liuling07.github.io/2014/03/springmvc-upload.html#ds-thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/">spring</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web后端/">web后端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/解决方案/">解决方案</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-jni-summary" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/12/jni-summary.html">JNI学习小结</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2013/12/jni-summary.html">
      <time datetime="2013-12-22T06:18:00.000Z" itemprop="datePublished">2013-12-22</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/JNI-amp-NDK/">JNI&amp;NDK</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <div>Java中类型与C/C++中对应关系</div><br><div><img src="http://www.liuling123.com/wp-content/uploads/2015/11/20130119043523145.png" alt=""></div><br><div>&nbsp;</div><br><div>Java中的类的对应</div><br><div>&nbsp;</div><br><div><img src="http://www.liuling123.com/wp-content/uploads/2015/11/20130119043523805.jpg" alt=""></div><br><div>Sign签名, 用来识别对应各个方法。</div><br><div>JDK下的javap.exe能输出签名。用法javap -s -p 完整类名</div><br><div>&nbsp;</div><br><div><img src="http://www.liuling123.com/wp-content/uploads/2015/11/20130119043524402.png" alt=""></div><br><div>&nbsp;</div>

<p>　　下面是几个例子程序：</p>
<p>1、C++本地方法中获取Java中的变量以及调用Java中的方法</p>
<p>　　Java代码：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.test;<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Date;<br></span><span style="color: #008080;"> 4</span><br><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> TestNative {<br></span><span style="color: #008080;"> 6</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">native</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> sayHello();<br></span><span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">int</span> a = 10<span style="color: #000000;">;<br></span><span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span> function(<span style="color: #0000ff;">int</span> x,Date date,<span style="color: #0000ff;">int</span><span style="color: #000000;">[] y){<br></span><span style="color: #008080;"> 9</span>         System.out.println(“function”<span style="color: #000000;">);<br></span><span style="color: #008080;">10</span>         <span style="color: #0000ff;">return</span> 0<span style="color: #000000;">;<br></span><span style="color: #008080;">11</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">12</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">double</span> max(<span style="color: #0000ff;">double</span> a,<span style="color: #0000ff;">double</span><span style="color: #000000;"> b){<br></span><span style="color: #008080;">13</span>         <span style="color: #0000ff;">return</span> a&gt;b?<span style="color: #000000;">a:b;<br></span><span style="color: #008080;">14</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">15</span>     <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;">16</span> <span style="color: #008000;">      </span><span style="color: #808080;">@param</span><span style="color: #008000;"> args<br></span><span style="color: #008080;">17</span>      <span style="color: #008000;">*/</span><br><span style="color: #008080;">18</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {<br></span><span style="color: #008080;">19</span>         System.loadLibrary(“NativeCode”<span style="color: #000000;">);<br></span><span style="color: #008080;">20</span>         TestNative tNative = <span style="color: #0000ff;">new</span><span style="color: #000000;"> TestNative();<br></span><span style="color: #008080;">21</span> <span style="color: #000000;">        tNative.sayHello();<br></span><span style="color: #008080;">22</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">23</span><br><span style="color: #008080;">24</span> }</pre><br></div>

<p>　　C++本地代码：</p>
<p>　　com_test_TestNative.h代码省略了</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> #include<iostream.h><br><span style="color: #008080;"> 2</span> #include<span style="color: #800000;">“</span><span style="color: #800000;">com_test_TestNative.h</span><span style="color: #800000;">“</span><br><span style="color: #008080;"> 3</span><br><span style="color: #008080;"> 4</span> JNIEXPORT <span style="color: #0000ff;">void</span> JNICALL Java_com_test_TestNative_sayHello(JNIEnv <em><span style="color: #000000;">env, jobject obj)<br></span><span style="color: #008080;"> 5</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 6</span>     <span style="color: #008000;">//</span><span style="color: #008000;">因为sayHello不是静态函数，所以传进来的obj就是调用这个函数的对象，否则就是传入native方法所在的类</span><br><span style="color: #008080;"> 7</span>     jclass hello_clazz = env-&gt;GetObjectClass(obj); <span style="color: #008000;">//</span><span style="color: #008000;">得到的就是native方法所在的类<br></span><span style="color: #008080;"> 8</span> <span style="color: #008000;">//</span><span style="color: #008000;">    jfieldID fieldId_a = env-&gt;GetFieldID(hello_clazz,”a”,”I”);<br></span><span style="color: #008080;"> 9</span> <span style="color: #008000;">//</span><span style="color: #008000;">    jmethodID methodId_fun = env-&gt;GetMethodID(hello_clazz,”function”,”(ILjava/util/Date;[I)I”);<br></span><span style="color: #008080;">10</span> <span style="color: #008000;">//</span><span style="color: #008000;">    env-&gt;CallIntMethod(obj,methodId_fun,0L,NULL,NULL); </span><span style="color: #008000;">//</span><span style="color: #008000;">方法调用<br></span><span style="color: #008080;">11</span> <span style="color: #008000;">//</span><span style="color: #008000;">    cout&lt;&lt;”hello world!”&lt;<endl; <="" span=""><span style="color: #008080;">12</span> <span style="color: #008000;">//</span><span style="color: #008000;">    cout&lt;&lt;”successful”&lt;<endl;< span=""><br><span style="color: #008080;">13</span> <span style="color: #008000;">/</span></endl;<></span></endl;></span></em><br><span style="color: #008080;">14</span> <span style="color: #008000;">    jfieldID field_a = env-&gt;GetFieldID(hello_clazz,”a”,”I”);  //得到字段a的ID<br></span><span style="color: #008080;">15</span> <span style="color: #008000;">    jint a = env-&gt;GetIntField(obj,field_a);   //得到字段a的值<br></span><span style="color: #008080;">16</span> <span style="color: #008000;">    cout&lt;<a<<endl; <="" span=""><span style="color: #008080;">17</span> <span style="color: #008000;">    env-&gt;SetIntField(obj,field_a,100L);<br></span><span style="color: #008080;">18</span> <span style="color: #008000;"><em>/</em></span><br><span style="color: #008080;">19</span>     jmethodID methodId_max = env-&gt;GetMethodID(hello_clazz,<span style="color: #800000;">“</span><span style="color: #800000;">max</span><span style="color: #800000;">“</span>,<span style="color: #800000;">“</span><span style="color: #800000;">(DD)D</span><span style="color: #800000;">“</span><span style="color: #000000;">);<br></span><span style="color: #008080;">20</span>     jvalue values = <span style="color: #0000ff;">new</span> jvalue[<span style="color: #800080;">2</span>];  <span style="color: #008000;">//</span><span style="color: #008000;">jvalue是用来向java函数中传参数的</span><br><span style="color: #008080;">21</span>     values[<span style="color: #800080;">0</span>].d = <span style="color: #800080;">3.14</span><span style="color: #000000;">;<br></span><span style="color: #008080;">22</span>     values[<span style="color: #800080;">1</span>].d = <span style="color: #800080;">3.22</span><span style="color: #000000;">;<br></span><span style="color: #008080;">23</span>     <span style="color: #008000;">//</span><span style="color: #008000;">jdouble max = env-&gt;CallDoubleMethod(obj,methodId_max,3.18,3.15); </span><span style="color: #008000;">//</span><span style="color: #008000;">第一种方法调用</span><br><span style="color: #008080;">24</span>     jdouble max = env-&gt;CallDoubleMethodA(obj,methodId_max,values); <span style="color: #008000;">//</span><span style="color: #008000;">第二种方法调用</span><br><span style="color: #008080;">25</span> <span style="color: #000000;">    delete [] values;<br></span><span style="color: #008080;">26</span>     cout&lt;<max<<<span style="color: #000000;">endl;<br></max<<<span></a<<endl;></span><span style="color: #008080;">27</span><br><span style="color: #008080;">28</span> }</iostream.h></pre><br></div>

<p>2、C++本地方法中对Java中的字符串操作（实现用户输入一个字符串，在C++中对其反转）</p>
<p>　　Java代码：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.test;<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.BufferedReader;<br></span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;<br></span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.InputStreamReader;<br></span><span style="color: #008080;"> 6</span><br><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> TestStr {<br></span><span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">native</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> cppCode();<br></span><span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> String message;<br></span><span style="color: #008080;">10</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> main(String[] args) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> IOException {<br></span><span style="color: #008080;">11</span>         System.loadLibrary(“CPP”<span style="color: #000000;">);<br></span><span style="color: #008080;">12</span>         BufferedReader reader = <span style="color: #0000ff;">new</span> BufferedReader(<span style="color: #0000ff;">new</span><span style="color: #000000;"> InputStreamReader(System.in));<br></span><span style="color: #008080;">13</span>         String str =<span style="color: #000000;"> reader.readLine();<br></span><span style="color: #008080;">14</span>         TestStr obj = <span style="color: #0000ff;">new</span><span style="color: #000000;"> TestStr();<br></span><span style="color: #008080;">15</span>         obj.message =<span style="color: #000000;"> str;<br></span><span style="color: #008080;">16</span> <span style="color: #000000;">        obj.cppCode();<br></span><span style="color: #008080;">17</span>         System.out.println(“java :”+<span style="color: #000000;">obj.message);<br></span><span style="color: #008080;">18</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">19</span><br><span style="color: #008080;">20</span> }</pre><br></div>

<p>　　c++本地方法：</p>
<p>　　com_test_TestStr.h省略了</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> #include <span style="color: #800000;">“</span><span style="color: #800000;">com_test_TestStr.h</span><span style="color: #800000;">“</span><br><span style="color: #008080;"> 2</span> #include<windows.h><br><span style="color: #008080;"> 3</span> #include&lt;<span style="color: #0000ff;">string</span>&gt;<br><span style="color: #008080;"> 4</span> #include<algorithm><br><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">using</span> <span style="color: #0000ff;">namespace</span><span style="color: #000000;"> std;<br></span><span style="color: #008080;"> 6</span> JNIEXPORT <span style="color: #0000ff;">void</span> JNICALL Java_com_test_TestStr_cppCode(JNIEnv <em><span style="color: #000000;">env, jobject obj)<br></span><span style="color: #008080;"> 7</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 8</span>     jfieldID fid_msg = env-&gt;GetFieldID(env-&gt;GetObjectClass(obj),<span style="color: #800000;">“</span><span style="color: #800000;">message</span><span style="color: #800000;">“</span>,<span style="color: #800000;">“</span><span style="color: #800000;">Ljava/lang/String;</span><span style="color: #800000;">“</span><span style="color: #000000;">);<br></span><span style="color: #008080;"> 9</span>     jstring j_msg = (jstring)env-&gt;<span style="color: #000000;">GetObjectField(obj,fid_msg);<br></span><span style="color: #008080;">10</span>     jsize len = env-&gt;GetStringLength(j_msg);   <span style="color: #008000;">//</span><span style="color: #008000;">得到字符串的长度</span><br><span style="color: #008080;">11</span>     jchar</em> jstr = <span style="color: #0000ff;">new</span> jchar[len+<span style="color: #800080;">1</span>];    <span style="color: #008000;">//</span><span style="color: #008000;">申请空间</span><br><span style="color: #008080;">12</span>     jstr[len] = L<span style="color: #800000;">‘</span><span style="color: #800000;">\0</span><span style="color: #800000;">‘</span><span style="color: #000000;">;<br></span><span style="color: #008080;">13</span>     env-&gt;GetStringRegion(j_msg,<span style="color: #800080;">0</span><span style="color: #000000;">,len,jstr);<br></span><span style="color: #008080;">14</span>     <span style="color: #008000;">//</span><span style="color: #008000;">env-&gt;ReleaseStringChars(j_msg,jstr);<br></span><span style="color: #008080;">15</span>     <span style="color: #008000;">//</span><span style="color: #008000;">MessageBoxW(NULL,(const wchar_t<em>)jstr,L”Title”,MB_OK);</em></span><br><span style="color: #008080;">16</span>     wstring wstr((<span style="color: #0000ff;">const</span> wchar_t<span style="color: #000000;">)jstr);<br></span><span style="color: #008080;">17</span>     delete[] jstr;  <span style="color: #008000;">//</span><span style="color: #008000;">释放空间</span><br><span style="color: #008080;">18</span>     std::reverse(wstr.begin(),wstr.end());  <span style="color: #008000;">//</span><span style="color: #008000;">字符串反转</span><br><span style="color: #008080;">19</span>     jstring j_new_str = env-&gt;NewString((<span style="color: #0000ff;">const</span> jchar*)wstr.c_str(),(jint)wstr.size());   <span style="color: #008000;">//</span><span style="color: #008000;">创建一个新的字符串</span><br><span style="color: #008080;">20</span>     env-&gt;SetObjectField(obj,fid_msg,j_new_str);  <span style="color: #008000;">//</span><span style="color: #008000;">设置字符串给java对象</span><br><span style="color: #008080;">21</span><br><span style="color: #008080;">22</span> }</algorithm></windows.h></pre><br></div>

<p>&nbsp;</p>
<p>3、C++本地方法中获取Java中的数组（实现用C++本地方法将Java中的数组排序）</p>
<p>　　Java代码：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #000000;">package com.test;<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> TestArray {<br></span><span style="color: #008080;"> 4</span><br><span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span>[] array = {<span style="color: #800080;">5</span>,<span style="color: #800080;">7</span>,<span style="color: #800080;">3</span>,<span style="color: #800080;">4</span>,<span style="color: #800080;">1</span>,<span style="color: #800080;">9</span>,<span style="color: #800080;">2</span>,<span style="color: #800080;">8</span>,<span style="color: #800080;">6</span>,<span style="color: #800080;">0</span><span style="color: #000000;">};<br></span><span style="color: #008080;"> 6</span><br><span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">public</span> native <span style="color: #0000ff;">void</span><span style="color: #000000;"> callCppFun();<br></span><span style="color: #008080;"> 8</span><br><span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {<br></span><span style="color: #008080;">10</span>         System.loadLibrary(<span style="color: #800000;">“</span><span style="color: #800000;">TestArray</span><span style="color: #800000;">“</span><span style="color: #000000;">);<br></span><span style="color: #008080;">11</span>         TestArray obj = <span style="color: #0000ff;">new</span><span style="color: #000000;"> TestArray();<br></span><span style="color: #008080;">12</span> <span style="color: #000000;">        obj.callCppFun();<br></span><span style="color: #008080;">13</span>         <span style="color: #0000ff;">for</span>(<span style="color: #0000ff;">int</span><span style="color: #000000;"> a:obj.array){<br></span><span style="color: #008080;">14</span>             System.<span style="color: #0000ff;">out</span><span style="color: #000000;">.println(a);<br></span><span style="color: #008080;">15</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">16</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">17</span><br><span style="color: #008080;">18</span> }</pre><br></div>

<p>　　C++本地代码：</p>
<p>　　com_test_TestArray.h省略了</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> #include<span style="color: #800000;">“</span><span style="color: #800000;">com_test_TestArray.h</span><span style="color: #800000;">“</span><br><span style="color: #008080;"> 2</span> #include<iostream><br><span style="color: #008080;"> 3</span> #include<algorithm><br><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">using</span> <span style="color: #0000ff;">namespace</span><span style="color: #000000;"> std;<br></span><span style="color: #008080;"> 5</span> JNIEXPORT <span style="color: #0000ff;">void</span> JNICALL Java_com_test_TestArray_callCppFun (JNIEnv <em><span style="color: #000000;">env, jobject obj)<br></span><span style="color: #008080;"> 6</span> <span style="color: #000000;">{<br></span><span style="color: #008080;"> 7</span>     jfieldID fid_array = env-&gt;GetFieldID(env-&gt;GetObjectClass(obj),<span style="color: #800000;">“</span><span style="color: #800000;">array</span><span style="color: #800000;">“</span>,<span style="color: #800000;">“</span><span style="color: #800000;">[I</span><span style="color: #800000;">“</span>); <span style="color: #008000;">//</span><span style="color: #008000;">获取数组的id</span><br><span style="color: #008080;"> 8</span>     jintArray jint_array = (jintArray)env-&gt;<span style="color: #000000;">GetObjectField(obj,fid_array);<br></span><span style="color: #008080;"> 9</span><br><span style="color: #008080;">10</span>     jint</em> int_arr = env-&gt;GetIntArrayElements(jint_array,NULL); <span style="color: #008000;">//</span><span style="color: #008000;">转化为jint数组</span><br><span style="color: #008080;">11</span>     jsize len = env-&gt;<span style="color: #000000;">GetArrayLength(jint_array);<br></span><span style="color: #008080;">12</span>     std::sort(int_arr,int_arr+len);  <span style="color: #008000;">//</span><span style="color: #008000;">对数组进行排序</span><br><span style="color: #008080;">13</span>     env-&gt;ReleaseIntArrayElements(jint_array,int_arr,<span style="color: #800080;">0</span>); <span style="color: #008000;">//</span><span style="color: #008000;">0：释放C++数组，并且更新到Java</span><br><span style="color: #008080;">14</span> <span style="color: #008000;">/<em></em></span><span style="color: #008000;">    for(jsize i=0;i<len;i++){ <="" span=""><span style="color: #008080;">15</span> <span style="color: #008000;">        cout&lt;<int_arr[i]<<endl; <="" span=""><span style="color: #008080;">16</span> <span style="color: #008000;">    }<br></span><span style="color: #008080;">17</span> <span style="color: #008000;">/</span><br><span style="color: #008080;">18</span>  <span style="color: #008000;">//</span><span style="color: #008000;">   env-&gt;ReleaseIntArrayElements(jint_array,int_arr,JNI_ABORT);</span><span style="color: #008000;">//</span><span style="color: #008000;">JNI_ABORT:释放C++数组，但是不更新到Java  </span><br><span style="color: #008080;">19</span> }</int_arr[i]<<endl;></span></len;i++){></span></algorithm></iostream></pre><br></div>

<p>&nbsp;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuling07.github.io/2013/12/jni-summary.html" data-id="ciiy5f4tj0072q1d0jdj1wobu" class="article-share-link">Share</a>
      
        <a href="http://liuling07.github.io/2013/12/jni-summary.html#ds-thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jni/">jni</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-java-jni" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/12/java-jni.html">Java通过JNI调用C++程序</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2013/12/java-jni.html">
      <time datetime="2013-12-20T07:10:00.000Z" itemprop="datePublished">2013-12-20</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/JNI-amp-NDK/">JNI&amp;NDK</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>　　JNI是Java Native Interface的缩写，中文为JAVA本地调用。使用JNI可以很方便的用我们的Java程序调用C/C++程序。很多时候，某些功能用Java无法实现，比如说涉及到底层驱动的一些功能，这时候我们就可以利用JNI来调用C或者C++程序来实现，这就是JNI的强大之处。但是JNI也有它的缺点，使用java与本地已编译的代码交互，通常会丧失平台可移植性。</p>
<p>　　下面是一个JNI例子，调用C++输出”hello world”：</p>
<p>&nbsp;</p>
<p>第一步：创建Java类，在里面定义一个本地方法（用native关键字修饰的方法）</p>
<p>　　public native void sayHello();</p>
<p>第二步：使用javah命令（javah&nbsp; 类的全路径）生成本地方法的C++头文件</p>
<p>　　在DOS窗口中进入工程所在目录，然后执行javah com.test.TestNative命令，执行完之后就会在当前目录生成一个后缀名为.h的头文件，如com_test_TestNative.h，这个头文件是根据包名和类名来命名的。</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #008000;">/<em></em></span><span style="color: #008000;"> DO NOT EDIT THIS FILE - it is machine generated </span><span style="color: #008000;">/</span><br><span style="color: #008080;"> 2</span> #include <jni.h><br><span style="color: #008080;"> 3</span> <span style="color: #008000;">/<em></em></span><span style="color: #008000;"> Header for class com_test_TestNative </span><span style="color: #008000;">/</span><br><span style="color: #008080;"> 4</span><br><span style="color: #008080;"> 5</span> <span style="color: #000000;">#ifndef _Included_com_test_TestNative<br></span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">#define</span> _Included_com_test_TestNative<br><span style="color: #008080;"> 7</span> <span style="color: #000000;">#ifdef <strong>cplusplus<br></strong></span><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">extern</span> <span style="color: #800000;">“</span><span style="color: #800000;">C</span><span style="color: #800000;">“</span><span style="color: #000000;"> {<br></span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">#endif</span><br><span style="color: #008080;">10</span> <span style="color: #008000;">/<em></em></span><br><span style="color: #008080;">11</span> <span style="color: #008000;">  Class:     com_test_TestNative<br></span><span style="color: #008080;">12</span> <span style="color: #008000;"> <em> Method:    sayHello<br></em></span><span style="color: #008080;">13</span> <span style="color: #008000;">  Signature: ()V<br></span><span style="color: #008080;">14</span>  <span style="color: #008000;"><em>/</em></span><br><span style="color: #008080;">15</span> JNIEXPORT <span style="color: #0000ff;">void</span><span style="color: #000000;"> JNICALL Java_com_test_TestNative_sayHello<br></span><span style="color: #008080;">16</span>   (JNIEnv <span style="color: #000000;">, jobject);<br></span><span style="color: #008080;">17</span><br><span style="color: #008080;">18</span> <span style="color: #000000;">#ifdef cplusplus<br></span><span style="color: #008080;">19</span> <span style="color: #000000;">}<br></span><span style="color: #008080;">20</span> <span style="color: #0000ff;">#endif</span><br><span style="color: #008080;">21</span> <span style="color: #0000ff;">#endif</span></jni.h></pre><br></div>

<p>　　15、16行是对TestNative类中的本地方法sayHello()的声明。这个h文件相当于我们在java里面的接口，这里声明了一个 Java_com_test_TestNative_sayHello (JNIEnv *, jobject);方法，然后在我们的本地方法里面实现这个方法，也就是说我们在编写C/C++程序的时候所使用的方法名必须和这里的一致。</p>
<p>第三步：编写C/C++本地代码，生成动态链接库文件</p>
<p>　　首先在VC6.0（当然也可以用其他工具）中创建一个dll工程—Win32 Dynamic-Link Library工程。然后将上面生成的头文件com_test_TestNative.h添加到该工程中，然后创建一个源文件引用该头文件并且实现头文件中本地函数的功能：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span>     #include<iostream.h><br><span style="color: #008080;">2</span>     #include<span style="color: #800000;">“</span><span style="color: #800000;">com_test_TestNative.h</span><span style="color: #800000;">“</span><br><span style="color: #008080;">3</span><br><span style="color: #008080;">4</span>     JNIEXPORT <span style="color: #0000ff;">void</span> JNICALL Java_com_test_TestNative_sayHello(JNIEnv *<span style="color: #000000;">env, jobject obj)<br></span><span style="color: #008080;">5</span> <span style="color: #000000;">    {<br></span><span style="color: #008080;">6</span>         cout&lt;&lt;<span style="color: #800000;">“</span><span style="color: #800000;">hello world!</span><span style="color: #800000;">“</span>&lt;&lt;<span style="color: #000000;">endl;<br></span><span style="color: #008080;">7</span>     }</iostream.h></pre><br></div>

<p>&nbsp;</p>
<p>　　这里因为com_test_TestNative.h中引入了jni.h所以要将jni.h加入到VC6.0安装目录下的Include目录中。jni.h在JDK安装目录下的include中，同时得件include/win32中的两个头文件jawt_md.h、jni_md.h也导入到VC6.0中。</p>
<p>　　将所依赖的头文件导入之后，我们就可以构建该工程了，按F7就行了，完了会在工程目录中的Degug目录下生成一个动态链接库文件，我这里生成的是NativeCode.dll。我们就可以将该dll文件拷贝到环境变量path所包含的目录下给咱们的Java程序调用了，为了方便，我们也可以将dll所在的工程目录加入到环境变量path中去，这样可以避免每次都要拷贝的麻烦。注意修改环境变量之后要重启myeclipse。</p>
<p>&nbsp;</p>
<p>第四步：Java调用本地函数</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.test;<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> TestNative {<br></span><span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">native</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> sayHello();<br></span><span style="color: #008080;"> 5</span><br><span style="color: #008080;"> 6</span>     <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;"> 7</span> <span style="color: #008000;">      </span><span style="color: #808080;">@param</span><span style="color: #008000;"> args<br></span><span style="color: #008080;"> 8</span>      <span style="color: #008000;">*/</span><br><span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {<br></span><span style="color: #008080;">10</span>         System.loadLibrary(“NativeCode”<span style="color: #000000;">);<br></span><span style="color: #008080;">11</span>         TestNative tNative = <span style="color: #0000ff;">new</span><span style="color: #000000;"> TestNative();<br></span><span style="color: #008080;">12</span> <span style="color: #000000;">        tNative.sayHello();<br></span><span style="color: #008080;">13</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">14</span> }</pre><br></div>

<p>　　第10行是加载动态链接库，JVM只需要加载一次就可以调用了，&ldquo;NativeCode&rdquo;是上面生成的动态链接库的名字，不含后缀名。</p>
<p>　　运行该程序，成功打印输出了”hello world”。</p>
<p>&nbsp;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuling07.github.io/2013/12/java-jni.html" data-id="ciiy5f4uh008nq1d0imd50i8l" class="article-share-link">Share</a>
      
        <a href="http://liuling07.github.io/2013/12/java-jni.html#ds-thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jni/">jni</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-linux-cut" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/12/linux-cut.html">Linux cut命令用法</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2013/12/linux-cut.html">
      <time datetime="2013-12-08T06:27:00.000Z" itemprop="datePublished">2013-12-08</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>cut是一个选取命令，就是将一段数据经过分析，取出我们想要的。一般来说，选取信息通常是针对&ldquo;行&rdquo;来进行分析的，并不是整篇信息分析的。</p>
<p>（1）其语法格式为： <span style="color: #ff0000;">cut&nbsp; [-bn] [file] 或 cut [-c] [file]&nbsp; 或&nbsp; cut [-df] [file]</span></p>
<p>使用说明 cut 命令从文件的每一行剪切字节、字符和字段并将这些字节、字符和字段写至标准输出。 如果不指定 File 参数，cut 命令将读取标准输入。必须指定 -b、-c 或 -f 标志之一。</p>
<p>主要参数 -b ：以字节为单位进行分割。这些字节位置将忽略多字节字符边界，除非也指定了 -n 标志。 -c ：以字符为单位进行分割。 -d ：自定义分隔符，默认为制表符。 -f&nbsp; ：与-d一起使用，指定显示哪个区域。 -n ：取消分割多字节字符。仅和 -b 标志一起使用。如果字符的最后一个字节落在由 -b 标志的 List 参数指示的<br>范围之内，该字符将被写出；否则，该字符将被排除。</p>
<p>（2）cut一般以什么为依据呢? 也就是说，我怎么告诉cut我想定位到的剪切内容呢?</p>
<p>cut命令主要是接受三个定位方法：</p>
<p>第一，字节（bytes），用选项-b</p>
<p>第二，字符（characters），用选项-c</p>
<p>第三，域（fields），用选项-f</p>
<p>（3）以&ldquo;字节&rdquo;定位</p>
<p>举个例子吧，当你执行ps命令时，会输出类似如下的内容：</p>
<p>[rocrocket@rocrocket programming]$ who rocrocket :0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2009-01-08 11:07 rocrocket pts/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2009-01-08 11:23 (:0.0) rocrocket pts/1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2009-01-08 14:15 (:0.0) 如果我们想提取每一行的第3个字节，就这样：</p>
<p>[rocrocket@rocrocket programming]$ who|cut -b 3 c c c</p>
<p>（4） 如果&ldquo;字节&rdquo;定位中，我想提取第3，第4、第5和第8个字节，怎么办?</p>
<p>-b支持形如3-5的写法，而且多个定位之间用逗号隔开就成了。看看例子吧：</p>
<p>[rocrocket@rocrocket programming]$ who|cut -b 3-5,8 croe croe croe 但有一点要注意，cut命令如果使用了-b选项，那么执行此命令时，cut会先把-b后面所有的定位进行从小到大排序，然后再提取。可不能颠倒定位的顺序哦。这个例子就可以说明这个问题：</p>
<p>[rocrocket@rocrocket programming]$ who|cut -b 8,3-5 croe croe croe （5） 还有哪些类似&ldquo;3-5&rdquo;这样的小技巧，列举一下吧!</p>
<p>[rocrocket@rocrocket programming]$ who rocrocket :0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2009-01-08 11:07 rocrocket pts/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2009-01-08 11:23 (:0.0) rocrocket pts/1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2009-01-08 14:15 (:0.0) [rocrocket@rocrocket programming]$ who|cut -b -3 roc roc roc [rocrocket@rocrocket programming]$ who|cut -b 3- crocket :0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2009-01-08 11:07 crocket pts/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2009-01-08 11:23 (:0.0) crocket pts/1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2009-01-08 14:15 (:0.0) 想必你也看到了，-3表示从第一个字节到第三个字节，而3-表示从第三个字节到行尾。如果你细心，你可以看到这两种情况下，都包括了第三个字节&ldquo;c&rdquo;。 如果我执行who|cut -b -3,3-，你觉得会如何呢？答案是输出整行，不会出现连续两个重叠的c的。看：</p>
<p>[rocrocket@rocrocket programming]$ who|cut -b -3,3- rocrocket :0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2009-01-08 11:07 rocrocket pts/0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2009-01-08 11:23 (:0.0) rocrocket pts/1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2009-01-08 14:15 (:0.0) （6）给个以字符为定位标志的最简单的例子吧!</p>
<p>下面例子你似曾相识，提取第3，第4，第5和第8个字符：</p>
<p>[rocrocket@rocrocket programming]$ who|cut -c 3-5,8 croe croe croe 不过，看着怎么和-b没有什么区别啊？莫非-b和-c作用一样? 其实不然，看似相同，只是因为这个例子举的不好，who输出的都是单字节字符，所以用-b和-c没有区别，如果你提取中文，区别就看出来了，来，看看中文提取的情况：</p>
<p>[rocrocket@rocrocket programming]$ cat cut_ch.txt 星期一 星期二 星期三 星期四 [rocrocket@rocrocket programming]$ cut -b 3 cut_ch.txt � � � � [rocrocket@rocrocket programming]$ cut -c 3 cut_ch.txt 一 二 三 四 看到了吧，用-c则会以字符为单位，输出正常；而-b只会傻傻的以字节（8位二进制位）来计算，输出就是乱码。 既然提到了这个知识点，就再补充一句，如果你学有余力，就提高一下。 当遇到多字节字符时，可以使用-n选项，-n用于告诉cut不要将多字节字符拆开。例子如下：</p>
<p>[rocrocket@rocrocket programming]$ cat cut_ch.txt |cut -b 2 � � � � [rocrocket@rocrocket programming]$ cat cut_ch.txt |cut -nb 2<br>[rocrocket@rocrocket programming]$ cat cut_ch.txt |cut -nb 1,2,3 星 星 星 星 （7）域是怎么回事呢？解释解释:)</p>
<p>为什么会有&ldquo;域&rdquo;的提取呢，因为刚才提到的-b和-c只能在固定格式的文档中提取信息，而对于非固定格式的信息则束手无策。这时候&ldquo;域&rdquo;就派上用场了。如果你观察过/etc/passwd文件，你会发现，它并不像who的输出信息那样具有固定格式，而是比较零散的排放。但是，冒号在这个文件的每一行中都起到了非常重要的作用，冒号用来隔开每一个项。</p>
<p>我们很幸运，cut命令提供了这样的提取方式，具体的说就是设置&ldquo;间隔符&rdquo;，再设置&ldquo;提取第几个域&rdquo;，就OK了！</p>
<p>以/etc/passwd的前五行内容为例：</p>
<p>[rocrocket@rocrocket programming]$ cat /etc/passwd|head -n 5 root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin adm:x:3:4:adm:/var/adm:/sbin/nologin lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin [rocrocket@rocrocket programming]$ cat /etc/passwd|head -n 5|cut -d : -f 1 root bin daemon adm lp 看到了吧，用-d来设置间隔符为冒号，然后用-f来设置我要取的是第一个域，再按回车，所有的用户名就都列出来了！呵呵 有成就感吧！ 当然，在设定-f时，也可以使用例如3-5或者4-类似的格式：</p>
<p>[rocrocket@rocrocket programming]$ cat /etc/passwd|head -n 5|cut -d : -f 1,3-5 root:0:0:root bin:1:1:bin daemon:2:2:daemon adm:3:4:adm lp:4:7:lp [rocrocket@rocrocket programming]$ cat /etc/passwd|head -n 5|cut -d : -f 1,3-5,7 root:0:0:root:/bin/bash bin:1:1:bin:/sbin/nologin daemon:2:2:daemon:/sbin/nologin adm:3:4:adm:/sbin/nologin lp:4:7:lp:/sbin/nologin [rocrocket@rocrocket programming]$ cat /etc/passwd|head -n 5|cut -d : -f -2 root:x bin:x daemon:x adm:x lp:x （8）如果遇到空格和制表符时，怎么分辨呢？我觉得有点乱，怎么办？</p>
<p>有时候制表符确实很难辨认，有一个方法可以看出一段空格到底是由若干个空格组成的还是由一个制表符组成的。</p>
<p>[rocrocket@rocrocket programming]$ cat tab_space.txt this is tab finish. this is several space&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; finish. [rocrocket@rocrocket programming]$ sed -n l tab_space.txt this is tab\tfinish.$ this is several space&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; finish.$ 看到了吧，如果是制表符（TAB），那么会显示为\t符号，如果是空格，就会原样显示。 通过此方法即可以判断制表符和空格了。 注意，上面sed -n后面的字符是L的小写字母哦，不要看错。</p>
<p>（9）我应该在cut -d中用什么符号来设定制表符或空格呢?</p>
<p>其实cut的-d选项的默认间隔符就是制表符，所以当你就是要使用制表符的时候，完全就可以省略-d选项，而直接用－f来取域就可以了。</p>
<p>如果你设定一个空格为间隔符，那么就这样：</p>
<p>[rocrocket@rocrocket programming]$ cat tab_space.txt |cut -d ‘ ‘ -f 1 this this 注意，两个单引号之间可确实要有一个空格哦，不能偷懒。 而且，你只能在-d后面设置一个空格，可不许设置多个空格，因为cut只允许间隔符是一个字符。</p>
<p>[rocrocket@rocrocket programming]$ cat tab_space.txt |cut -d ‘ ‘ -f 1 cut: the delimiter must be a single character Try `cut –help’ for more information.</p>
<p>（10）cut有哪些缺陷和不足？</p>
<p>猜出来了吧？对，就是在处理多空格时。 如果文件里面的某些域是由若干个空格来间隔的，那么用cut就有点麻烦了，因为cut只擅长处理&ldquo;以一个字符间隔&rdquo;的文本内容</p>
<p>&nbsp;</p>
<p>转自<a href="http://www.cnblogs.com/dong008259/archive/2011/12/09/2282679.html" target="_blank" rel="external">http://www.cnblogs.com/dong008259/archive/2011/12/09/2282679.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuling07.github.io/2013/12/linux-cut.html" data-id="ciiy5f4ss0066q1d0u0h6l9or" class="article-share-link">Share</a>
      
        <a href="http://liuling07.github.io/2013/12/linux-cut.html#ds-thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-linux-sed" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/12/linux-sed.html">Linux sed命令详解</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2013/12/linux-sed.html">
      <time datetime="2013-12-07T07:20:00.000Z" itemprop="datePublished">2013-12-07</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <ul>
<li><span><span class="number">1</span><span>. Sed简介&nbsp; </span></span></li>
<li><span>sed 是一种在线编辑器，它一次处理一行内容。处理时，把当前处理的行存储在临时缓冲区中，称为&ldquo;模式空间&rdquo;（pattern space），接着用sed命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。文件内容并没有 改变，除非你使用重定向存储输出。Sed主要用来自动编辑一个或多个文件；简化对文件的反复操作；编写转换程序等。以下介绍的是Gnu版本的Sed <span class="number">3.02</span><span>。&nbsp; </span></span></li>
<li><span><span class="number">2</span><span>. 定址&nbsp; </span></span></li>
<li><span>可以通过定址来定位你所希望编辑的行，该地址用数字构成，用逗号分隔的两个行数表示以这两行为起止的行的范围（包括行数表示的那两行）。如<span class="number">1</span><span>，</span><span class="number">3</span><span>表示</span><span class="number">1</span><span>，</span><span class="number">2</span><span>，</span><span class="number">3</span><span>行，美元符号($)表示最后一行。范围可以通过数据，正则表达式或者二者结合的方式确定 。&nbsp; </span></span></li>
<li><span>&nbsp; </span></li>
<li><span><span class="number">3</span><span>. Sed命令&nbsp; </span></span></li>
<li><span>调用sed命令有两种形式：&nbsp; </span></li>
<li><span>*&nbsp; </span></li>
<li><span>sed [options] <span class="string">‘command’</span><span> file(s)&nbsp; </span></span></li>
<li><span>*&nbsp; </span></li>
<li><span>sed [options] -f scriptfile file(s)&nbsp; </span></li>
<li><span>a\&nbsp; </span></li>
<li><span>在当前行后面加入一行文本。&nbsp; </span></li>
<li><span>b lable&nbsp; </span></li>
<li><span>分支到脚本中带有标记的地方，如果分支不存在则分支到脚本的末尾。&nbsp; </span></li>
<li><span>c\&nbsp; </span></li>
<li><span>用新的文本改变本行的文本。&nbsp; </span></li>
<li><span>d&nbsp; </span></li>
<li><span>从模板块（Pattern space）位置删除行。&nbsp; </span></li>
<li><span>D&nbsp; </span></li>
<li><span>删除模板块的第一行。&nbsp; </span></li>
<li><span>i\&nbsp; </span></li>
<li><span>在当前行上面插入文本。&nbsp; </span></li>
<li><span>h&nbsp; </span></li>
<li><span>拷贝模板块的内容到内存中的缓冲区。&nbsp; </span></li>
<li><span>H&nbsp; </span></li>
<li><span>追加模板块的内容到内存中的缓冲区&nbsp; </span></li>
<li><span>g&nbsp; </span></li>
<li><span>获得内存缓冲区的内容，并替代当前模板块中的文本。&nbsp; </span></li>
<li><span>G&nbsp; </span></li>
<li><span>获得内存缓冲区的内容，并追加到当前模板块文本的后面。&nbsp; </span></li>
<li><span>l&nbsp; </span></li>
<li><span>列表不能打印字符的清单。&nbsp; </span></li>
<li><span>n&nbsp; </span></li>
<li><span>读取下一个输入行，用下一个命令处理新的行而不是用第一个命令。&nbsp; </span></li>
<li><span>N&nbsp; </span></li>
<li><span>追加下一个输入行到模板块后面并在二者间嵌入一个新行，改变当前行号码。&nbsp; </span></li>
<li><span>p&nbsp; </span></li>
<li><span>打印模板块的行。&nbsp; </span></li>
<li><span>P（大写）&nbsp; </span></li>
<li><span>打印模板块的第一行。&nbsp; </span></li>
<li><span>q&nbsp; </span></li>
<li><span>退出Sed。&nbsp; </span></li>
<li><span>r file&nbsp; </span></li>
<li><span>从file中读行。&nbsp; </span></li>
<li><span>t label&nbsp; </span></li>
<li><span><span class="keyword">if</span><span>分支，从最后一行开始，条件一旦满足或者T，t命令，将导致分支到带有标号的命令处，或者到脚本的末尾。&nbsp; </span></span></li>
<li><span>T label&nbsp; </span></li>
<li><span>错误分支，从最后一行开始，一旦发生错误或者T，t命令，将导致分支到带有标号的命令处，或者到脚本的末尾。&nbsp; </span></li>
<li><span>w file&nbsp; </span></li>
<li><span>写并追加模板块到file末尾。&nbsp; </span></li>
<li><span>W file&nbsp; </span></li>
<li><span>写并追加模板块的第一行到file末尾。&nbsp; </span></li>
<li><span>!&nbsp; </span></li>
<li><span>表示后面的命令对所有没有被选定的行发生作用。&nbsp; </span></li>
<li><span>s/re/string&nbsp; </span></li>
<li><span>用string替换正则表达式re。&nbsp; </span></li>
<li><span>=&nbsp; </span></li>
<li><span>打印当前行号码。&nbsp; </span></li>
<li><span>#&nbsp; </span></li>
<li><span>把注释扩展到下一个换行符以前。&nbsp; </span></li>
<li><span>以下的是替换标记&nbsp; </span></li>
<li><span>*&nbsp; </span></li>
<li><span>g表示行内全面替换。&nbsp; </span></li>
<li><span>*&nbsp; </span></li>
<li><span>p表示打印行。&nbsp; </span></li>
<li><span>*&nbsp; </span></li>
<li><span>w表示把行写入一个文件。&nbsp; </span></li>
<li><span>*&nbsp; </span></li>
<li><span>x表示互换模板块中的文本和缓冲区中的文本。&nbsp; </span></li>
<li><span>*&nbsp; </span></li>
<li><span>y表示把一个字符翻译为另外的字符（但是不用于正则表达式）&nbsp; </span></li>
<li><span>&nbsp; </span></li>
<li><span><span class="number">4</span><span>. 选项&nbsp; </span></span></li>
<li><span>-e command, –expression=command&nbsp; </span></li>
<li><span>允许多台编辑。&nbsp; </span></li>
<li><span>-h, –help&nbsp; </span></li>
<li><span>打印帮助，并显示bug列表的地址。&nbsp; </span></li>
<li><span>-n, –quiet, –silent&nbsp; </span></li>
<li><span>&nbsp; </span></li>
<li><span>取消默认输出。&nbsp; </span></li>
<li><span>-f, –filer=script-file&nbsp; </span></li>
<li><span>引导sed脚本文件名。&nbsp; </span></li>
<li><span>-V, –version&nbsp; </span></li>
<li><span>打印版本和版权信息。&nbsp; </span></li>
<li><span>&nbsp; </span></li>
<li><span><span class="number">5</span><span>. 元字符集^&nbsp; </span></span></li>
<li><span>锚定行的开始 如：/^sed/匹配所有以sed开头的行。&nbsp;&nbsp; </span></li>
<li><span>$&nbsp; </span></li>
<li><span>锚定行的结束 如：/sed$/匹配所有以sed结尾的行。&nbsp;&nbsp; </span></li>
<li><span>.&nbsp; </span></li>
<li><span>匹配一个非换行符的字符 如：/s.d/匹配s后接一个任意字符，然后是d。&nbsp;&nbsp; </span></li>
<li><span>*&nbsp; </span></li>
<li><span>匹配零或多个字符 如：<span class="comment">/*sed/匹配所有模板是一个或多个空格后紧跟sed的行。 </span> </span></li>
<li><span><span class="comment">[]</span> </span></li>
<li><span><span class="comment">匹配一个指定范围内的字符，如/[Ss]ed/匹配sed和Sed。 </span> </span></li>
<li><span><span class="comment">[^]</span> </span></li>
<li><span><span class="comment">匹配一个不在指定范围内的字符，如：/[^A-RT-Z]ed/匹配不包含A-R和T-Z的一个字母开头，紧跟ed的行。 </span> </span></li>
<li><span><span class="comment">(..)</span> </span></li>
<li><span><span class="comment">保存匹配的字符，如s/(love)able/\1rs，loveable被替换成lovers。 </span> </span></li>
<li><span><span class="comment">&amp;</span> </span></li>
<li><span><span class="comment">保存搜索字符用来替换其他字符，如s/love/<strong>&amp;</strong>/</span><span>，love这成<strong>love</strong>。&nbsp;&nbsp; </span></span></li>
<li><span>\&lt;&nbsp; </span></li>
<li><span>锚定单词的开始，如:/\<love 匹配包含以love开头的单词的行。&nbsp;&nbsp;="" <="" span=""></love></span></li>
<li><span>>&nbsp; </span></li>
<li><span>锚定单词的结束，如/love>/匹配包含以love结尾的单词的行。&nbsp;&nbsp; </span></li>
<li><span>x{m}&nbsp; </span></li>
<li><span>重复字符x，m次，如：/<span class="number">0</span><span>{</span><span class="number">5</span><span>}/匹配包含</span><span class="number">5</span><span>个o的行。&nbsp;&nbsp; </span></span></li>
<li><span>x{m,}&nbsp; </span></li>
<li><span>重复字符x,至少m次，如：/o{<span class="number">5</span><span>,}/匹配至少有</span><span class="number">5</span><span>个o的行。&nbsp;&nbsp; </span></span></li>
<li><span>x{m,n}&nbsp; </span></li>
<li><span>重复字符x，至少m次，不多于n次，如：/o{<span class="number">5</span><span>,</span><span class="number">10</span><span>}/匹配</span><span class="number">5</span><span>–</span><span class="number">10</span><span>个o的行。&nbsp; </span></span></li>
<li><span><span class="number">6</span><span>. 实例&nbsp; </span></span></li>
<li><span>删除：d命令&nbsp; </span></li>
<li><span>*&nbsp; </span></li>
<li><span>$ sed <span class="string">‘2d’</span><span> example—–删除example文件的第二行。&nbsp; </span></span></li>
<li><span>*&nbsp; </span></li>
<li><span>$ sed <span class="string">‘2,$d’</span><span> example—–删除example文件的第二行到末尾所有行。&nbsp; </span></span></li>
<li><span>*&nbsp; </span></li>
<li><span>$ sed <span class="string">‘$d’</span><span> example—–删除example文件的最后一行。&nbsp; </span></span></li>
<li><span>*&nbsp; </span></li>
<li><span>$ sed <span class="string">‘/test/‘</span><span>d example—–删除example文件所有包含test的行。&nbsp; </span></span></li>
<li><span>替换：s命令&nbsp; </span></li>
<li><span>*&nbsp; </span></li>
<li><span>$ sed <span class="string">‘s/test/mytest/g’</span><span> example—–在整行范围内把test替换为mytest。如果没有g标记，则只有每行第一个匹配的test被替换成mytest。&nbsp; </span></span></li>
<li><span>*&nbsp; </span></li>
<li><span>$ sed -n <span class="string">‘s/^test/mytest/p’</span><span> example—–(-n)选项和p标志一起使用表示只打印那些发生替换的行。也就是说，如果某一行开头的test被替换成mytest，就打印它。&nbsp; </span></span></li>
<li><span>*&nbsp; </span></li>
<li><span>$ sed <span class="string">‘s/^192.168.0.1/&amp;localhost/‘</span><span> example—–&amp;符号表示替换换字符串中被找到的部份。所有以</span><span class="number">192.168</span><span>.</span><span class="number">0.1</span><span>开头的行都会被替换成它自已加 localhost，变成</span><span class="number">192.168</span><span>.</span><span class="number">0</span><span>.1localhost。&nbsp; </span></span></li>
<li><span>*&nbsp; </span></li>
<li><span>$ sed -n <span class="string">‘s/(love)able/\1rs/p’</span><span> example—–love被标记为</span><span class="number">1</span><span>，所有loveable会被替换成lovers，而且替换的行会被打印出来。&nbsp; </span></span></li>
<li><span>*&nbsp; </span></li>
<li><span>$ sed <span class="string">‘s#10#100#g’</span><span> example—–不论什么字符，紧跟着s命令的都被认为是新的分隔符，所以，&ldquo;#&rdquo;在这里是分隔符，代替了默认的&ldquo;/&rdquo;分隔符。表示把所有</span><span class="number">10</span><span>替换成</span><span class="number">100</span><span>。&nbsp; </span></span></li>
<li><span>选定行的范围：逗号&nbsp; </span></li>
<li><span>*&nbsp; </span></li>
<li><span>$ sed -n <span class="string">‘/test/,/check/p’</span><span> example—–所有在模板test和check所确定的范围内的行都被打印。&nbsp; </span></span></li>
<li><span>*&nbsp; </span></li>
<li><span>$ sed -n <span class="string">‘5,/^test/p’</span><span> example—–打印从第五行开始到第一个包含以test开始的行之间的所有行。&nbsp; </span></span></li>
<li><span>*&nbsp; </span></li>
<li><span>$ sed <span class="string">‘/test/,/check/s/$/sed test/‘</span><span> example—–对于模板test和west之间的行，每行的末尾用字符串sed test替换。&nbsp; </span></span></li>
<li><span>多点编辑：e命令&nbsp; </span></li>
<li><span>*&nbsp; </span></li>
<li><span>$ sed -e <span class="string">‘1,5d’</span><span> -e </span><span class="string">‘s/test/check/‘</span><span> example—–(-e)选项允许在同一行里执行多条命令。如例子所示，第一条命令删除</span><span class="number">1</span><span>至</span><span class="number">5</span><span>行，第二条命令用check替换test。命令的执 行顺序对结果有影响。如果两个命令都是替换命令，那么第一个替换命令将影响第二个替换命令的结果。&nbsp; </span></span></li>
<li><span>*&nbsp; </span></li>
<li><span>$ sed –expression=<span class="string">‘s/test/check/‘</span><span> –expression=</span><span class="string">‘/love/d’</span><span> example—–一个比-e更好的命令是–expression。它能给sed表达式赋值。&nbsp; </span></span></li>
<li><span>从文件读入：r命令&nbsp; </span></li>
<li><span>*&nbsp; </span></li>
<li><span>$ sed <span class="string">‘/test/r file’</span><span> example—–file里的内容被读进来，显示在与test匹配的行后面，如果匹配多行，则file的内容将显示在所有匹配行的下面。&nbsp; </span></span></li>
<li><span>写入文件：w命令&nbsp; </span></li>
<li><span>*&nbsp; </span></li>
<li><span>$ sed -n <span class="string">‘/test/w file’</span><span> example—–在example中所有包含test的行都被写入file里。&nbsp; </span></span></li>
<li><span>追加命令：a命令&nbsp; </span></li>
<li><span>*&nbsp; </span></li>
<li><span>$ sed <span class="string">‘/^test/a\—&gt;this is a example’</span><span> example&lt;—–</span><span class="string">‘this is a example’</span><span>被追加到以test开头的行后面，sed要求命令a后面有一个反斜杠。&nbsp; </span></span></li>
<li><span>插入：i命令&nbsp; </span></li>
<li><span>$ sed ‘/test/i\&nbsp; </span></li>
<li><span><span class="keyword">new</span><span> line&nbsp; </span></span></li>
<li><span>————————-‘ example&nbsp; </span></li>
<li><span>如果test被匹配，则把反斜杠后面的文本插入到匹配行的前面。&nbsp; </span></li>
<li><span>下一个：n命令&nbsp; </span></li>
<li><span>*&nbsp; </span></li>
<li><span>$ sed <span class="string">‘/test/{ n; s/aa/bb/; }’</span><span> example—–如果test被匹配，则移动到匹配行的下一行，替换这一行的aa，变为bb，并打印该行，然后继续。&nbsp; </span></span></li>
<li><span>变形：y命令&nbsp; </span></li>
<li><span>*&nbsp; </span></li>
<li><span>$ sed <span class="string">‘1,10y/abcde/ABCDE/‘</span><span> example—–把</span><span class="number">1</span><span>–</span><span class="number">10</span><span>行内所有abcde转变为大写，注意，正则表达式元字符不能使用这个命令。&nbsp; </span></span></li>
<li><span>退出：q命令&nbsp; </span></li>
<li><span>*&nbsp; </span></li>
<li><span>$ sed <span class="string">‘10q’</span><span> example—–打印完第</span><span class="number">10</span><span>行后，退出sed。&nbsp; </span></span></li>
<li><span>保持和获取：h命令和G命令&nbsp; </span></li>
<li><span>*&nbsp; </span></li>
<li><span>$ sed -e <span class="string">‘/test/h’</span><span> -e ‘$G example—–在sed处理文件的时候，每一行都被保存在一个叫模式空间的临时缓冲区中，除非行被删除或者输出被取消，否则所有被处理的行都将 打印在屏幕上。接着模式空间被清空，并存入新的一行等待处理。在这个例子里，匹配test的行被找到后，将存入模式空间，h命令将其复制并存入一个称为保 持缓存区的特殊缓冲区内。第二条语句的意思是，当到达最后一行后，G命令取出保持缓冲区的行，然后把它放回模式空间中，且追加到现在已经存在于模式空间中 的行的末尾。在这个例子中就是追加到最后一行。简单来说，任何包含test的行都被复制并追加到该文件的末尾。&nbsp; </span></span></li>
<li><span>保持和互换：h命令和x命令&nbsp; </span></li>
<li><span>*&nbsp; </span></li>
<li><span>$ sed -e <span class="string">‘/test/h’</span><span> -e </span><span class="string">‘/check/x’</span><span> example —–互换模式空间和保持缓冲区的内容。也就是把包含test与check的行互换。&nbsp; </span></span></li>
<li><span><span class="number">7</span><span>. 脚本&nbsp; </span></span></li>
<li><span>Sed脚本是一个sed的命令清单，启动Sed时以-f选项引导脚本文件名。Sed对于脚本中输入的命令非常挑剔，在命令的末尾不能有任何空白或文本，如果在一行中有多个命令，要用分号分隔。以#开头的行为注释行，且不能跨行。 </span></li>
</ul>
<p><span>转自<a href="http://www.iteye.com/topic/587673" target="_blank" rel="external">http://www.iteye.com/topic/587673</a></span></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuling07.github.io/2013/12/linux-sed.html" data-id="ciiy5f4so005yq1d0cvfqfl91" class="article-share-link">Share</a>
      
        <a href="http://liuling07.github.io/2013/12/linux-sed.html#ds-thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-mysql-my-ini" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/11/mysql-my-ini.html">MySQL配置文件my.ini参数注释说明</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2013/11/mysql-my-ini.html">
      <time datetime="2013-11-28T20:49:00.000Z" itemprop="datePublished">2013-11-29</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/后端/">后端</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>mysqld程序–目录和文件<br>basedir = path 使用给定目录作为根目录(安装目录)。<br>character-sets-dir = path 给出存放着字符集的目录。<br>datadir = path 从给定目录读取数据库文件。<br>pid-file = filename 为mysqld程序指定一个存放进程ID的文件(仅适用于UNIX/Linux系统); Init-V脚本需要使用这个文件里的进程ID结束mysqld进程。<br>socket = filename 为MySQL客户程序与服务器之间的本地通信指定一个套接字文件(仅适用于UNIX/Linux系统; 默认设置一般是/var/lib/mysql/mysql.sock文件)。<br>在Windows环境下，如果MySQL客户与服务器是通过命名管道进行通信的，–sock选项给出的将是该命名管道的名字(默认设置是MySQL)。<br>lower_case_table_name = 1/0 新目录和数据表的名字是否只允许使用小写字母; 这个选项在Windows环境下的默认设置是1(只允许使用小写字母)。</p>
<p>mysqld程序–语言设置<br>character-sets-server = name 新数据库或数据表的默认字符集。为了与MySQL的早期版本保持兼容，这个字符集也可以用–default-character-set选项给出; 但这个选项已经显得有点过时了。<br>collation-server = name 新数据库或数据表的默认排序方式。<br>lanuage = name 用指定的语言显示出错信息。</p>
<p>mysqld程序–通信、网络、信息安全<br>enable-named-pipes 允许Windows 2000/XP环境下的客户和服务器使用命名管道(named pipe)进行通信。这个命名管道的默认名字是MySQL，但可以用–socket选项来改变。<br>local-infile [=0] 允许/禁止使用LOAD DATA LOCAL语句来处理本地文件。<br>myisam-recover [=opt1, opt2, …] 在启动时自动修复所有受损的MyISAM数据表。这个选项的可取值有4种:DEFAULT、BACKUP、QUICK和FORCE; 它们与myisamchk程序的同名选项作用相同。<br>old-passwords 使用MySQL 3.23和4.0版本中的老算法来加密mysql数据库里的密码(默认使用MySQL 4.1版本开始引入的新加密算法)。<br>port = n 为MySQL程序指定一个TCP/IP通信端口(通常是3306端口)。<br>safe-user-create 只有在mysql.user数据库表上拥有INSERT权限的用户才能使用GRANT命令; 这是一种双保险机制(此用户还必须具备GRANT权限才能执行GRANT命令)。<br>shared-memory 允许使用内存(shared memory)进行通信(仅适用于Windows)。<br>shared-memory-base-name = name 给共享内存块起一个名字(默认的名字是MySQL)。<br>skip-grant-tables 不使用mysql数据库里的信息来进行访问控制(警告:这将允许用户任何用户去修改任何数据库)。<br>skip-host-cache 不使用高速缓存区来存放主机名和IP地址的对应关系。<br>skip-name-resovle 不把IP地址解析为主机名; 与访问控制(mysql.user数据表)有关的检查全部通过IP地址行进。<br>skip-networking 只允许通过一个套接字文件(Unix/Linux系统)或通过命名管道(Windows系统)进行本地连接，不允许ICP/IP连接; 这提高了安全性，但阻断了来自网络的外部连接和所有的Java客户程序(Java客户即使在本地连接里也使用TCP/IP)。<br>user = name mysqld程序在启动后将在给定UNIX/Linux账户下执行; mysqld必须从root账户启动才能在启动后切换到另一个账户下执行; mysqld_safe脚本将默认使用–user=mysql选项来启动mysqld程序。</p>
<p>mysqld程序–内存管理、优化、查询缓存区<br>bulk_insert_buffer_size = n 为一次插入多条新记录的INSERT命令分配的缓存区长度(默认设置是8M)。<br>key_buffer_size = n 用来存放索引区块的RMA值(默认设置是8M)。<br>join_buffer_size = n 在参加JOIN操作的数据列没有索引时为JOIN操作分配的缓存区长度(默认设置是128K)。<br>max_heap_table_size = n HEAP数据表的最大长度(默认设置是16M); 超过这个长度的HEAP数据表将被存入一个临时文件而不是驻留在内存里。<br>max_connections = n MySQL服务器同时处理的数据库连接的最大数量(默认设置是100)。<br>query_cache_limit = n 允许临时存放在查询缓存区里的查询结果的最大长度(默认设置是1M)。<br>query_cache_size = n 查询缓存区的最大长度(默认设置是0，不开辟查询缓存区)。<br>query_cache_type = 0/1/2 查询缓存区的工作模式:0, 禁用查询缓存区; 1，启用查询缓存区(默认设置); 2，”按需分配”模式，只响应SELECT SQL_CACHE命令。<br>read_buffer_size = n 为从数据表顺序读取数据的读操作保留的缓存区的长度(默认设置是128KB); 这个选项的设置值在必要时可以用SQL命令SET SESSION read_buffer_size = n命令加以改变。<br>read_rnd_buffer_size = n 类似于read_buffer_size选项，但针对的是按某种特定顺序(比如使用了ORDER BY子句的查询)输出的查询结果(默认设置是256K)。<br>sore_buffer = n 为排序操作分配的缓存区的长度(默认设置是2M); 如果这个缓存区太小，则必须创建一个临时文件来进行排序。<br>table_cache = n 同时打开的数据表的数量(默认设置是64)。<br>tmp_table_size = n 临时HEAP数据表的最大长度(默认设置是32M); 超过这个长度的临时数据表将被转换为MyISAM数据表并存入一个临时文件。</p>
<p>mysqld程序–日志<br>log [= file] 把所有的连接以及所有的SQL命令记入日志(通用查询日志); 如果没有给出file参数，MySQL将在数据库目录里创建一个hostname.log文件作为这种日志文件(hostname是服务器的主机名)。<br>log-slow-queries [= file] 把执行用时超过long_query_time变量值的查询命令记入日志(慢查询日志); 如果没有给出file参数，MySQL将在数据库目录里创建一个hostname-slow.log文件作为这种日志文件(hostname是服务器主机名)。<br>long_query_time = n 慢查询的执行用时上限(默认设置是10s)。<br>long_queries_not_using_indexs 把慢查询以及执行时没有使用索引的查询命令全都记入日志(其余同–log-slow-queries选项)。<br>log-bin [= filename] 把对数据进行修改的所有SQL命令(也就是INSERT、UPDATE和DELETE命令)以二进制格式记入日志(二进制变更日志，binary update log)。这种日志的文件名是filename.n或默认的hostname.n，其中n是一个6位数字的整数(日志文件按顺序编号)。<br>log-bin-index = filename 二进制日志功能的索引文件名。在默认情况下，这个索引文件与二进制日志文件的名字相同，但后缀名是.index而不是.nnnnnn。<br>max_binlog_size = n 二进制日志文件的最大长度(默认设置是1GB)。在前一个二进制日志文件里的信息量超过这个最大长度之前，MySQL服务器会自动提供一个新的二进制日志文件接续上。<br>binlog-do-db = dbname 只把给定数据库里的变化情况记入二进制日志文件，其他数据库里的变化情况不记载。如果需要记载多个数据库里的变化情况，就必须在配置文件使用多个本选项来设置，每个数据库一行。<br>binlog-ignore-db = dbname 不把给定数据库里的变化情况记入二进制日志文件。<br>sync_binlog = n 每经过n次日志写操作就把日志文件写入硬盘一次(对日志信息进行一次同步)。n=1是最安全的做法，但效率最低。默认设置是n=0，意思是由操作系统来负责二进制日志文件的同步工作。<br>log-update [= file] 记载出错情况的日志文件名(出错日志)。这种日志功能无法禁用。如果没有给出file参数，MySQL会使用hostname.err作为种日志文件的名字。</p>
<p>mysqld程序–镜像(主控镜像服务器)<br>server-id = n 给服务器分配一个独一无二的ID编号; n的取值范围是1~2的32次方启用二进制日志功能。<br>log-bin = name 启用二进制日志功能。这种日志的文件名是filename.n或默认的hostname.n，其中的n是一个6位数字的整数(日志文件顺序编号)。<br>binlog-do/ignore-db = dbname 只把给定数据库里的变化情况记入二进制日志文件/不把给定的数据库里的变化记入二进制日志文件。</p>
<p>mysqld程序–镜像(从属镜像服务器)<br>server-id = n 给服务器分配一个唯一的ID编号<br>log-slave-updates 启用从属服务器上的日志功能，使这台计算机可以用来构成一个镜像链(A-&gt;B-&gt;C)。<br>master-host = hostname 主控服务器的主机名或IP地址。如果从属服务器上存在mater.info文件(镜像关系定义文件)，它将忽略此选项。<br>master-user = replicusername 从属服务器用来连接主控服务器的用户名。如果从属服务器上存在mater.info文件，它将忽略此选项。<br>master-password = passwd 从属服务器用来连接主控服务器的密码。如果从属服务器上存在mater.info文件，它将忽略此选项。<br>master-port = n 从属服务器用来连接主控服务器的TCP/IP端口(默认设置是3306端口)。<br>master-connect-retry = n 如果与主控服务器的连接没有成功，则等待n秒(s)后再进行管理方式(默认设置是60s)。如果从属服务器存在mater.info文件，<br>它将忽略此选项。<br>master-ssl-xxx = xxx 对主、从服务器之间的SSL通信进行配置。<br>read-only = 0/1 0: 允许从属服务器独立地执行SQL命令(默认设置); 1: 从属服务器只能执行来自主控服务器的SQL命令。<br>read-log-purge = 0/1 1: 把处理完的SQL命令立刻从中继日志文件里删除(默认设置); 0: 不把处理完的SQL命令立刻从中继日志文件里删除。<br>replicate-do-table = dbname.tablename 与–replicate-do-table选项的含义和用法相同，但数据库和数据库表名字里允许出现通配符”%”<br>(例如: test%.%–对名字以”test”开头的所有数据库里的所以数据库表进行镜像处理)。<br>replicate-do-db = name 只对这个数据库进行镜像处理。<br>replicate-ignore-table = dbname.tablename 不对这个数据表进行镜像处理。<br>replicate-wild-ignore-table = dbn.tablen 不对这些数据表进行镜像处理。<br>replicate-ignore-db = dbname 不对这个数据库进行镜像处理。<br>replicate-rewrite-db = db1name &gt; db2name 把主控数据库上的db1name数据库镜像处理为从属服务器上的db2name数据库。<br>report-host = hostname 从属服务器的主机名; 这项信息只与SHOW SLAVE HOSTS命令有关–主控服务器可以用这条命令生成一份从属服务器的名单。<br>slave-compressed-protocol = 1 主、从服务器使用压缩格式进行通信–如果它们都支持这么做的话。<br>slave-skip-errors = n1, n2, …或all 即使发生出错代码为n1、n2等的错误，镜像处理工作也继续进行(即不管发生什么错误，镜像处理工作也继续进行)。<br>如果配置得当，从属服务器不应该在执行SQL命令时发生错误(在主控服务器上执行出错的SQL命令不会被发送到从属服务器上做镜像处理); 如果不使用<br>slave-skip-errors选项，从属服务器上的镜像工作就可能国为发生错误而中断，中断后需要有人工参与才能继续进行。</p>
<p>mysqld–InnoDB–基本设置、表空间文件<br>skip-innodb 不加载InnoDB数据表驱动程序–如果用不着InnoDB数据表，可以用这个选项节省一些内存。<br>innodb-file-per-table 为每一个新数据表创建一个表空间文件而不是把数据表都集中保存在中央表空间里(后者是默认设置)。该选项始见于MySQL 4.1。<br>innodb-open-file = n InnoDB数据表驱动程序最多可以同时打开的文件数(默认设置是300)。如果使用了innodb-file-per-table选项并且需要同时打开很多<br>数据表的话，这个数字很可能需要加大。<br>innodb_data_home_dir = p InnoDB主目录，所有与InnoDB数据表有关的目录或文件路径都相对于这个路径。在默认的情况下，这个主目录就是MySQL的数据目录。<br>innodb_data_file_path = ts 用来容纳InnoDB为数据表的表空间: 可能涉及一个以上的文件; 每一个表空间文件的最大长度都必须以字节(B)、兆字节(MB)或<br>千兆字节(GB)为单位给出; 表空间文件的名字必须以分号隔开; 最后一个表空间文件还可以带一个autoextend属性和一个最大长度(max:n)。<br>例如，ibdata1:1G; ibdata2:1G:autoextend:max:2G的意思是: 表空间文件ibdata1的最大长度是1GB，ibdata2的最大长度也是1G，但允许它扩充到2GB。<br>除文件名外，还可以用硬盘分区的设置名来定义表空间，此时必须给表空间的最大初始长度值加上newraw关键字做后缀，给表空间的最大扩充长度值加上<br>raw关键字做后缀(例如/dev/hdb1:20Gnewraw或/dev/hdb1:20Graw); MySQL 4.0及更高版本的默认设置是ibdata1:10M:autoextend。<br>innodb_autoextend_increment = n 带有autoextend属性的表空间文件每次加大多少兆字节(默认设置是8MB)。这个属性不涉及具体的数据表文件，那些文件的<br>增大速度相对是比较小的。<br>innodb_lock_wait_timeout = n 如果某个事务在等待n秒(s)后还没有获得所需要的资源，就使用ROLLBACK命令放弃这个事务。这项设置对于发现和处理未能被<br>InnoDB数据表驱动程序识别出来的死锁条件有着重要的意义。这个选项的默认设置是50s。<br>innodb_fast_shutdown 0/1 是否以最快的速度关闭InnoDB，默认设置是1，意思是不把缓存在INSERT缓存区的数据写入数据表，那些数据将在MySQL服务器下次<br>启动时再写入(这么做没有什么风险，因为INSERT缓存区是表空间的一个组成部分，数据不会丢失)。把这个选项设置为0反面危险，因为在计算机关闭时，<br>InnoDB驱动程序很可能没有足够的时间完成它的数据同步工作，操作系统也许会在它完成数据同步工作之前强行结束InnoDB，而这会导致数据不完整。</p>
<p>mysqld程序–InnoDB–日志<br>innodb_log_group_home_dir = p 用来存放InnoDB日志文件的目录路径(如ib_logfile0、ib_logfile1等)。在默认的情况下，InnoDB驱动程序将使用MySQL数据目<br>录作为自己保存日志文件的位置。<br>innodb_log_files_in_group = n 使用多少个日志文件(默认设置是2)。InnoDB数据表驱动程序将以轮转方式依次填写这些文件; 当所有的日志文件都写满以后，<br>之后的日志信息将写入第一个日志文件的最大长度(默认设置是5MB)。这个长度必须以MB(兆字节)或GB(千兆字节)为单位进行设置。<br>innodb_flush_log_at_trx_commit = 0/1/2 这个选项决定着什么时候把日志信息写入日志文件以及什么时候把这些文件物理地写(术语称为”同步”)到硬盘上。<br>设置值0的意思是每隔一秒写一次日志并进行同步，这可以减少硬盘写操作次数，但可能造成数据丢失; 设置值1(设置设置)的意思是在每执行完一条COMMIT<br>命令就写一次日志并进行同步，这可以防止数据丢失，但硬盘写操作可能会很频繁; 设置值2是一般折衷的办法，即每执行完一条COMMIT命令写一次日志，<br>每隔一秒进行一次同步。<br>innodb_flush_method = x InnoDB日志文件的同步办法(仅适用于UNIX/Linux系统)。这个选项的可取值有两种: fdatasync，用fsync()函数进行同步; O_DSYNC，<br>用O_SYNC()函数进行同步。<br>innodb_log_archive = 1 启用InnoDB驱动程序的archive(档案)日志功能，把日志信息写入ib_arch_log_n文件。启用这种日志功能在InnoDB与MySQL一起使用时没有<br>多大意义(启用MySQL服务器的二进制日志功能就足够用了)。</p>
<p>mysqld程序–InnoDB–缓存区的设置和优化<br>innodb_log_buffer_pool_size = n 为InnoDB数据表及其索引而保留的RAM内存量(默认设置是8MB)。这个参数对速度有着相当大的影响，如果计算机上只运行有<br>MySQL/InnoDB数据库服务器，就应该把全部内存的80%用于这个用途。<br>innodb_log_buffer_size = n 事务日志文件写操作缓存区的最大长度(默认设置是1MB)。<br>innodb_additional_men_pool_size = n 为用于内部管理的各种数据结构分配的缓存区最大长度(默认设置是1MB)。<br>innodb_file_io_threads = n I/O操作(硬盘写操作)的最大线程个数(默认设置是4)。<br>innodb_thread_concurrency = n InnoDB驱动程序能够同时使用的最大线程个数(默认设置是8)。</p>
<p>mysqld程序–其它选项<br>bind-address = ipaddr MySQL服务器的IP地址。如果MySQL服务器所在的计算机有多个IP地址，这个选项将非常重要。<br>default-storage-engine = type 新数据表的默认数据表类型(默认设置是MyISAM)。这项设置还可以通过–default-table-type选项来设置。<br>default-timezone = name 为MySQL服务器设置一个地理时区(如果它与本地计算机的地理时区不一样)。<br>ft_min_word_len = n 全文索引的最小单词长度工。这个选项的默认设置是4，意思是在创建全文索引时不考虑那些由3个或更少的字符构建单词。<br>Max-allowed-packet = n 客户与服务器之间交换的数据包的最大长度，这个数字至少应该大于客户程序将要处理的最大BLOB块的长度。这个选项的默认设置是1MB。<br>Sql-mode = model1, mode2, … MySQL将运行在哪一种SQL模式下。这个选项的作用是让MySQL与其他的数据库系统保持最大程度的兼容。这个选项的可取值包括<br>ansi、db2、oracle、no_zero_date、pipes_as_concat。</p>
<p>注意：如果在配置文件里给出的某个选项是mysqld无法识别的，MySQL服务器将不启动。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuling07.github.io/2013/11/mysql-my-ini.html" data-id="ciiy5f4ry004wq1d0ktbpmros" class="article-share-link">Share</a>
      
        <a href="http://liuling07.github.io/2013/11/mysql-my-ini.html#ds-thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-java-10times-abc" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/09/java-10times-abc.html">Java多线程：用三个线程控制循环输出10次ABC</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2013/09/java-10times-abc.html">
      <time datetime="2013-09-13T04:53:00.000Z" itemprop="datePublished">2013-09-13</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Java基础/">Java基础</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>题目：有A,B,C三个线程, A线程输出A, B线程输出B, C线程输出C，要求, 同时启动三个线程, 按顺序输出ABC, 循环10次。</p>
<p>解题思路：要按顺序输出ABC, 循环10次，就要控制三个线程同步工作，也就是说要让三个线程轮流输出，直到10个ABC全部输出则结束线程。这里用一个Lock对象来控制三个线程的同步。用一个int型变量state标识由那个线程输出。</p>
<p>&nbsp;</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.thread;<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.concurrent.locks.Lock;<br></span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.concurrent.locks.ReentrantLock;<br></span><span style="color: #008080;"> 5</span><br><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ABC {<br></span><span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">int</span> state = 0<span style="color: #000000;">;<br></span><span style="color: #008080;"> 8</span><br><span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {<br></span><span style="color: #008080;">10</span>         <span style="color: #0000ff;">final</span> Lock l = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ReentrantLock();<br></span><span style="color: #008080;">11</span><br><span style="color: #008080;">12</span>         Thread A = <span style="color: #0000ff;">new</span> Thread(<span style="color: #0000ff;">new</span><span style="color: #000000;"> Runnable(){<br></span><span style="color: #008080;">13</span> <span style="color: #000000;">            @Override<br></span><span style="color: #008080;">14</span>             <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> run() {<br></span><span style="color: #008080;">15</span>                 <span style="color: #0000ff;">while</span> (state&lt;=30<span style="color: #000000;">) {<br></span><span style="color: #008080;">16</span> <span style="color: #000000;">                    l.lock();<br></span><span style="color: #008080;">17</span>                     <span style="color: #0000ff;">if</span>(state%3==0<span style="color: #000000;">){<br></span><span style="color: #008080;">18</span>                         System.out.println(“A”<span style="color: #000000;">);<br></span><span style="color: #008080;">19</span>                         state ++<span style="color: #000000;">;<br></span><span style="color: #008080;">20</span> <span style="color: #000000;">                    }<br></span><span style="color: #008080;">21</span> <span style="color: #000000;">                    l.unlock();<br></span><span style="color: #008080;">22</span> <span style="color: #000000;">                }<br></span><span style="color: #008080;">23</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">24</span> <span style="color: #000000;">        });<br></span><span style="color: #008080;">25</span>         Thread B = <span style="color: #0000ff;">new</span> Thread(<span style="color: #0000ff;">new</span><span style="color: #000000;"> Runnable(){<br></span><span style="color: #008080;">26</span> <span style="color: #000000;">            @Override<br></span><span style="color: #008080;">27</span>             <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> run() {<br></span><span style="color: #008080;">28</span>                 <span style="color: #0000ff;">while</span> (state&lt;=30<span style="color: #000000;">) {<br></span><span style="color: #008080;">29</span> <span style="color: #000000;">                    l.lock();<br></span><span style="color: #008080;">30</span>                     <span style="color: #0000ff;">if</span>(state%3==1<span style="color: #000000;">){<br></span><span style="color: #008080;">31</span>                         System.out.println(“B”<span style="color: #000000;">);<br></span><span style="color: #008080;">32</span>                         state ++<span style="color: #000000;">;<br></span><span style="color: #008080;">33</span> <span style="color: #000000;">                    }<br></span><span style="color: #008080;">34</span> <span style="color: #000000;">                    l.unlock();<br></span><span style="color: #008080;">35</span> <span style="color: #000000;">                }<br></span><span style="color: #008080;">36</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">37</span> <span style="color: #000000;">        });<br></span><span style="color: #008080;">38</span>         Thread C = <span style="color: #0000ff;">new</span> Thread(<span style="color: #0000ff;">new</span><span style="color: #000000;"> Runnable(){<br><br></span><span style="color: #008080;">39</span> <span style="color: #000000;">            @Override<br></span><span style="color: #008080;">40</span>             <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> run() {<br></span><span style="color: #008080;">41</span>                 <span style="color: #0000ff;">while</span> (state&lt;=30<span style="color: #000000;">) {<br></span><span style="color: #008080;">42</span> <span style="color: #000000;">                    l.lock();<br></span><span style="color: #008080;">43</span>                     <span style="color: #0000ff;">if</span>(state%3==2<span style="color: #000000;">){<br></span><span style="color: #008080;">44</span>                         System.out.println(“C”<span style="color: #000000;">);<br></span><span style="color: #008080;">45</span>                         state ++<span style="color: #000000;">;<br></span><span style="color: #008080;">46</span> <span style="color: #000000;">                    }<br></span><span style="color: #008080;">47</span> <span style="color: #000000;">                    l.unlock();<br></span><span style="color: #008080;">48</span> <span style="color: #000000;">                }<br></span><span style="color: #008080;">49</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">50</span> <span style="color: #000000;">        });<br></span><span style="color: #008080;">51</span> <span style="color: #000000;">        A.start();<br></span><span style="color: #008080;">52</span> <span style="color: #000000;">        B.start();<br></span><span style="color: #008080;">53</span> <span style="color: #000000;">        C.start();<br></span><span style="color: #008080;">54</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">55</span><br><span style="color: #008080;">56</span> }</pre><br></div>

<p>运行结果：<br>A<br>B<br>C<br>A<br>B<br>C<br>A<br>B<br>C<br>A<br>B<br>C<br>A<br>B<br>C<br>A<br>B<br>C<br>A<br>B<br>C<br>A<br>B<br>C<br>A<br>B<br>C<br>A<br>B<br>C<br>A<br>B<br>C</p>
<p>&nbsp;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuling07.github.io/2013/09/java-10times-abc.html" data-id="ciiy5f4ux0099q1d053zzqpvg" class="article-share-link">Share</a>
      
        <a href="http://liuling07.github.io/2013/09/java-10times-abc.html#ds-thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/多线程/">多线程</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-centos-mysql-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/08/centos-mysql-install.html">CentOS中安装MySQL数据库</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2013/08/centos-mysql-install.html">
      <time datetime="2013-08-30T18:19:00.000Z" itemprop="datePublished">2013-08-31</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>1、首先下载MySQL的安装文件，我这里安装的是MySQL5.1.7版本的，</p>
<p>　　下载链接：<a href="http://pan.baidu.com/share/link?shareid=255483056&amp;uk=924063144" title="MySQL-client-5.1.7-0.i386.rpm" target="_blank" rel="external">http://pan.baidu.com/share/link?shareid=255483056&amp;uk=924063144</a></p>
<p>　　　　　　&nbsp;&nbsp; <a href="http://pan.baidu.com/share/link?shareid=269901909&amp;uk=924063144" title="MySQL-server-5.1.7-0.i386.rpm" target="_blank" rel="external">http://pan.baidu.com/share/link?shareid=269901909&amp;uk=924063144</a></p>
<p>2、安装MySQL数据库服务器</p>
<p>　　进入安装包所在文件夹，执行命令 rpm -ivh MySQL-server-5.1.7-0.i386.rpm 安装MySQL服务器。</p>
<p>　　如果报了与原先版本冲突的话，就执行rpm -qa|grep -i mysql命令，会显示已安装的Mysql版本,我的显示mysql-libs-5.1.61-4.el6.i686<br>这时如果有的话就强制删除：rpm -e –nodeps mysql-libs-5.1.61-4.el6.i686（因为有包依赖，所以要强制删除）</p>
<p>我的报错提示如下：</p>
<div class="cnblogs_code"><br><pre>MySQL-server-5.1.7-0<span style="color: #000000;">.i386.rpm<br>Preparing…                ########################################### [</span>100%<span style="color: #000000;">]<br>    file </span>/usr/share/mysql/charsets/README from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/Index.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/armscii8.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/ascii.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/cp1250.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/cp1251.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/cp1256.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/cp1257.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/cp850.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/cp852.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/cp866.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/dec8.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/geostd8.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/greek.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/hebrew.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/hp8.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/keybcs2.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/koi8r.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/koi8u.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/latin1.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/latin2.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/latin5.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/latin7.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/macce.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/macroman.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/charsets/swe7.xml from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/czech/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/danish/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/dutch/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/english/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/estonian/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/french/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/german/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/greek/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/hungarian/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/italian/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/japanese/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/korean/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/norwegian-ny/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/norwegian/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/polish/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/portuguese/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/romanian/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/russian/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/serbian/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/slovak/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/spanish/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/swedish/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4<span style="color: #000000;">.el6.i686<br>    file </span>/usr/share/mysql/ukrainian/errmsg.sys from install of MySQL-server-5.1.7-0.i386.rpm  conflicts with file from <span style="color: #0000ff;">package</span> mysql-libs-5.1.61-4.el6.i686</pre><br></div>

<p>这时候再执行rpm -ivh MySQL-server-5.1.7-0.i386.rpm安装即可安装成功。<br>我这里安装成功了，但是mysql服务无法启动，总是启动失败，后来百度了一下，是因为selinux的原因，只要将selinux关闭就OK了。<br>关闭selinux：vi /etc/selinux/config 将SELINUX=enforcing 改成SELINUX=disabled 然后重启<br>关闭selinux之后还是无法启动mysql服务，因为安装的mysql所有者是root，在安装mysql的时候会创建一个用户mysql，只要将/var/lib/mysql<br>的所有者改为mysql就OK了，执行命令chown -R mysql:mysql /var/lib/mysql<br>现在执行service mysql start终于可以启动mysql服务了。</p>
<p>&nbsp;</p>
<p>3.安装MySQL客户端<br>　　执行命令rpm -ivh MySQL-client-5.1.7-0.i386.rpm进行安装。</p>
<p>&nbsp;</p>
<p>4.安装成功</p>
<p>　　成功安装MySQL后将sql文件导入到数据库，步骤如下：</p>
<p>　　进入MYSQL Command Line Client<br>　　1、先创建数据库：create database test 注：test是创建数据库的名称<br>　　2、再切换到当前数据库：use test<br>　　3、再输入：. /root/test.sql 或 souce /root/test.sql</p>
<p>　　按照以上步骤就可以将备份的sql脚本导入到linux中的数据库中去。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuling07.github.io/2013/08/centos-mysql-install.html" data-id="ciiy5f4xl00dnq1d04k9yf9gp" class="article-share-link">Share</a>
      
        <a href="http://liuling07.github.io/2013/08/centos-mysql-install.html#ds-thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-hashmap-source" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/08/hashmap-source.html">HashMap源码剖析</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2013/08/hashmap-source.html">
      <time datetime="2013-08-22T04:21:00.000Z" itemprop="datePublished">2013-08-22</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Java基础/">Java基础</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>　　无论是在平时的练习还是项目当中，HashMap用的是非常的广，真可谓无处不在。平时用的时候只知道HashMap是用来存储键值对的，却不知道它的底层是如何实现的。</p>
<p><strong>一、HashMap概述</strong></p>
<p>　　HashMap基于哈希表的 <tt>Map</tt> 接口的实现。此实现提供所有可选的映射操作，并允许使用 <tt>null</tt> 值和 <tt>null</tt> 键。（除了不同步和允许使用 null 之外，<tt>HashMap</tt> 类与 <tt>Hashtable</tt> 大致相同。）此类不保证映射的顺序，特别是它不保证该顺序恒久不变。</p>
<p>　　值得注意的是HashMap不是线程安全的，如果想要线程安全的HashMap，可以通过Collections类的静态方法synchronizedMap获得线程安全的HashMap。</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> Map map = Collections.synchronizedMap(<span style="color: #0000ff;">new</span> HashMap());</pre><br></div>

<p><strong>二、HashMap的数据结构</strong></p>
<p><strong>　　</strong>HashMap的底层主要是基于数组和链表来实现的，它之所以有相当快的查询速度主要是因为它是通过计算散列码来决定存储的位置，能够很快的计算出对象所存储的位置。HashMap中主要是通过key的hashCode来计算hash值的，只要hashCode相同，计算出来的hash值就一样。如果存储的对象对多了，就有可能不同的对象所算出来的hash值是相同的，这就出现了所谓的hash冲突。学过数据结构的同学都知道，解决hash冲突的方法有很多，HashMap底层是通过链表来解决hash冲突的。<img src="http://www.liuling123.com/wp-content/uploads/2015/11/22174201-59ed2cd7c1604704971d66a87f3480b7.jpg" alt=""></p>
<p>　　<span style="font: 14px/25.2px Helvetica, Tahoma, Arial, sans-serif; text-align: left; color: #000000; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; font-size-adjust: none; font-stretch: normal; background-color: #ffffff; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">从上图中可以看出，</span><span style="font: 14px/25.2px Helvetica, Tahoma, Arial, sans-serif; text-align: left; color: #000000; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; font-size-adjust: none; font-stretch: normal; background-color: #ffffff; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">HashMap</span><span style="font: 14px/25.2px Helvetica, Tahoma, Arial, sans-serif; text-align: left; color: #000000; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; font-size-adjust: none; font-stretch: normal; background-color: #ffffff; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">底层就是一个数组结构，数组中存放的是一个Entry对象，如果产生的hash冲突，也就是说要存储的那个位置上面已经存储了对象了，这时候该位置存储的就是一个链表了。我们看看HashMap中Entry类的代码：</span></p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">class</span> Entry<k,v> <span style="color: #0000ff;">implements</span> Map.Entry<k,v><span style="color: #000000;"> {<br></span><span style="color: #008080;"> 2</span>         <span style="color: #0000ff;">final</span><span style="color: #000000;"> K key;<br></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">        V value;<br></span><span style="color: #008080;"> 4</span>         Entry<k,v><span style="color: #000000;"> next;<br></span><span style="color: #008080;"> 5</span>         <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> hash;<br></span><span style="color: #008080;"> 6</span><br><span style="color: #008080;"> 7</span>         <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;"> 8</span> <span style="color: #008000;">          Creates new entry.<br></span><span style="color: #008080;"> 9</span>          <span style="color: #008000;">*/</span><br><span style="color: #008080;">10</span>         Entry(<span style="color: #0000ff;">int</span> h, K k, V v, Entry<k,v><span style="color: #000000;"> n) {<br></span><span style="color: #008080;">11</span>             value =<span style="color: #000000;"> v;<br></span><span style="color: #008080;">12</span>             next = n; <span style="color: #008000;">//</span><span style="color: #008000;">hash值冲突后存放在链表的下一个</span><br><span style="color: #008080;">13</span>             key =<span style="color: #000000;"> k;<br></span><span style="color: #008080;">14</span>             hash =<span style="color: #000000;"> h;<br></span><span style="color: #008080;">15</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">16</span><br><span style="color: #008080;">17</span> <span style="color: #000000;">        ………<br></span><span style="color: #008080;">18</span>     }</k,v></k,v></k,v></k,v></pre><br></div>

<p><span style="font: 14px/25.2px Helvetica, Tahoma, Arial, sans-serif; text-align: left; color: #000000; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; font-size-adjust: none; font-stretch: normal; background-color: #ffffff; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">　　HashMap其实就是一个Entry数组，Entry对象中包含了键和值，其中next也是一个Entry对象，它就是用来处理hash冲突的，形成一个链表。</span></p>
<p>&nbsp;</p>
<p><strong>三、HashMap源码分析</strong></p>
<p><strong>　　</strong>先看看HashMap类中的一些关键属性：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> <span style="color: #0000ff;">transient</span> Entry[] table;<span style="color: #008000;">//</span><span style="color: #008000;">存储元素的实体数组</span><br><span style="color: #008080;">2</span><br><span style="color: #008080;">3</span> <span style="color: #0000ff;">transient</span> <span style="color: #0000ff;">int</span> size;<span style="color: #008000;">//</span><span style="color: #008000;">存放元素的个数</span><br><span style="color: #008080;">4</span><br><span style="color: #008080;">5</span> <span style="color: #0000ff;">int</span> threshold; <span style="color: #008000;">//</span><span style="color: #008000;">临界值   当实际大小超过临界值时，会进行扩容threshold = 加载因子*容量</span><br><span style="color: #008080;">6</span><br><span style="color: #008080;">7</span> <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">float</span> loadFactor; <span style="color: #008000;">//</span><span style="color: #008000;">加载因子</span><br><span style="color: #008080;">8</span><br><span style="color: #008080;">9</span> <span style="color: #0000ff;">transient</span> <span style="color: #0000ff;">int</span> modCount;<span style="color: #008000;">//</span><span style="color: #008000;">被修改的次数</span></pre><br></div>

<p>　　其中加载因子是表示Hsah表中元素的填满的程度.若:加载因子越大,填满的元素越多,好处是,空间利用率高了,但:冲突的机会加大了.反之,加载因子越小,填满的元素越少,<br>好处是:冲突的机会减小了,但:空间浪费多了.冲突的机会越大,则查找的成本越高.反之,查找的成本越小.因而,查找时间就越小.因此,必须在 “冲突的机会”与”空间利用率”之间寻找一种平衡与折衷. 这种平衡与折衷本质上是数据结构中有名的”时-空”矛盾的平衡与折衷.</p>
<p>　　如果机器内存足够，并且想要提高查询速度的话可以将加载因子设置小一点；相反如果机器内存紧张，并且对查询速度没有什么要求的话可以将加载因子设置大一点。不过一般我们都不用去设置它，让它取默认值0.75就好了。</p>
<p>　　下面看看HashMap的几个构造方法：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span>     <span style="color: #0000ff;">public</span> HashMap(<span style="color: #0000ff;">int</span> initialCapacity, <span style="color: #0000ff;">float</span><span style="color: #000000;"> loadFactor) {<br></span><span style="color: #008080;"> 2</span>         <span style="color: #008000;">//</span><span style="color: #008000;">确保数字合法</span><br><span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">if</span> (initialCapacity &lt; 0<span style="color: #000000;">)<br></span><span style="color: #008080;"> 4</span>             <span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span> IllegalArgumentException(“Illegal initial capacity: “ +<br><span style="color: #008080;"> 5</span> <span style="color: #000000;">                                               initialCapacity);<br></span><span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">if</span> (initialCapacity &gt;<span style="color: #000000;"> MAXIMUM_CAPACITY)<br></span><span style="color: #008080;"> 7</span>             initialCapacity =<span style="color: #000000;"> MAXIMUM_CAPACITY;<br></span><span style="color: #008080;"> 8</span>         <span style="color: #0000ff;">if</span> (loadFactor &lt;= 0 ||<span style="color: #000000;"> Float.isNaN(loadFactor))<br></span><span style="color: #008080;"> 9</span>             <span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span> IllegalArgumentException(“Illegal load factor: “ +<br><span style="color: #008080;">10</span> <span style="color: #000000;">                                               loadFactor);<br></span><span style="color: #008080;">11</span><br><span style="color: #008080;">12</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> Find a power of 2 &gt;= initialCapacity</span><br><span style="color: #008080;">13</span>         <span style="color: #0000ff;">int</span> capacity = 1;   <span style="color: #008000;">//</span><span style="color: #008000;">初始容量</span><br><span style="color: #008080;">14</span>         <span style="color: #0000ff;">while</span> (capacity &lt; initialCapacity)   <span style="color: #008000;">//</span><span style="color: #008000;">确保容量为2的n次幂，使capacity为大于initialCapacity的最小的2的n次幂</span><br><span style="color: #008080;">15</span>             capacity &lt;&lt;= 1<span style="color: #000000;">;<br></span><span style="color: #008080;">16</span><br><span style="color: #008080;">17</span>         <span style="color: #0000ff;">this</span>.loadFactor =<span style="color: #000000;"> loadFactor;<br></span><span style="color: #008080;">18</span>         threshold = (<span style="color: #0000ff;">int</span>)(capacity <em><span style="color: #000000;"> loadFactor);<br></span><span style="color: #008080;">19</span>         table = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Entry[capacity];<br></span><span style="color: #008080;">20</span> <span style="color: #000000;">        init();<br></span><span style="color: #008080;">21</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">22</span><br><span style="color: #008080;">23</span>     <span style="color: #0000ff;">public</span> HashMap(<span style="color: #0000ff;">int</span><span style="color: #000000;"> initialCapacity) {<br></span><span style="color: #008080;">24</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">(initialCapacity, DEFAULT_LOAD_FACTOR);<br></span><span style="color: #008080;">25</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">26</span><br><span style="color: #008080;">27</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> HashMap() {<br></span><span style="color: #008080;">28</span>         <span style="color: #0000ff;">this</span>.loadFactor =<span style="color: #000000;"> DEFAULT_LOAD_FACTOR;<br></span><span style="color: #008080;">29</span>         threshold = (<span style="color: #0000ff;">int</span>)(DEFAULT_INITIAL_CAPACITY </em><span style="color: #000000;"> DEFAULT_LOAD_FACTOR);<br></span><span style="color: #008080;">30</span>         table = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Entry[DEFAULT_INITIAL_CAPACITY];<br></span><span style="color: #008080;">31</span> <span style="color: #000000;">        init();<br></span><span style="color: #008080;">32</span>     }</pre><br></div>

<p>　　我们可以看到在构造HashMap的时候如果我们指定了加载因子和初始容量的话就调用第一个构造方法，否则的话就是用默认的。默认初始容量为16，默认加载因子为0.75。我们可以看到上面代码中13-15行，这段代码的作用是确保容量为2的n次幂，使capacity为大于initialCapacity的最小的2的n次幂，至于为什么要把容量设置为2的n次幂，我们等下再看。</p>
<p>　　下面看看HashMap存储数据的过程是怎样的，首先看看HashMap的put方法：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">public</span><span style="color: #000000;"> V put(K key, V value) {<br></span><span style="color: #008080;"> 2</span>         <span style="color: #0000ff;">if</span> (key == <span style="color: #0000ff;">null</span>) <span style="color: #008000;">//</span><span style="color: #008000;">如果键为null的话，调用putForNullKey(value)</span><br><span style="color: #008080;"> 3</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;"> putForNullKey(value);<br></span><span style="color: #008080;"> 4</span>         <span style="color: #0000ff;">int</span> hash = hash(key.hashCode());<span style="color: #008000;">//</span><span style="color: #008000;">根据键的hashCode计算hash码</span><br><span style="color: #008080;"> 5</span>         <span style="color: #0000ff;">int</span> i =<span style="color: #000000;"> indexFor(hash, table.length);<br></span><span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">for</span> (Entry<k,v> e = table[i]; e != <span style="color: #0000ff;">null</span>; e = e.next) { <span style="color: #008000;">//</span><span style="color: #008000;">处理冲突的，如果hash值相同，则在该位置用链表存储</span><br><span style="color: #008080;"> 7</span> <span style="color: #000000;">            Object k;<br></span><span style="color: #008080;"> 8</span>             <span style="color: #0000ff;">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) { <span style="color: #008000;">//</span><span style="color: #008000;">如果key相同则覆盖并返回旧值</span><br><span style="color: #008080;"> 9</span>                 V oldValue =<span style="color: #000000;"> e.value;<br></span><span style="color: #008080;">10</span>                 e.value =<span style="color: #000000;"> value;<br></span><span style="color: #008080;">11</span>                 e.recordAccess(<span style="color: #0000ff;">this</span><span style="color: #000000;">);<br></span><span style="color: #008080;">12</span>                 <span style="color: #0000ff;">return</span><span style="color: #000000;"> oldValue;<br></span><span style="color: #008080;">13</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">14</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">15</span><br><span style="color: #008080;">16</span>         modCount++<span style="color: #000000;">;<br></span><span style="color: #008080;">17</span> <span style="color: #000000;">        addEntry(hash, key, value, i);<br></span><span style="color: #008080;">18</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;<br></span><span style="color: #008080;">19</span>     }</k,v></pre><br></div>

<p>　　我们慢慢的来分析这个函数，第2和3行的作用就是处理key值为null的情况，我们看看putForNullKey(value)方法：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">private</span><span style="color: #000000;"> V putForNullKey(V value) {<br></span><span style="color: #008080;"> 2</span>         <span style="color: #0000ff;">for</span> (Entry<k,v> e = table[0]; e != <span style="color: #0000ff;">null</span>; e =<span style="color: #000000;"> e.next) {<br></span><span style="color: #008080;"> 3</span>             <span style="color: #0000ff;">if</span> (e.key == <span style="color: #0000ff;">null</span>) {   <span style="color: #008000;">//</span><span style="color: #008000;">如果有key为null的对象存在，则覆盖掉</span><br><span style="color: #008080;"> 4</span>                 V oldValue =<span style="color: #000000;"> e.value;<br></span><span style="color: #008080;"> 5</span>                 e.value =<span style="color: #000000;"> value;<br></span><span style="color: #008080;"> 6</span>                 e.recordAccess(<span style="color: #0000ff;">this</span><span style="color: #000000;">);<br></span><span style="color: #008080;"> 7</span>                 <span style="color: #0000ff;">return</span><span style="color: #000000;"> oldValue;<br></span><span style="color: #008080;"> 8</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;"> 9</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">10</span>         modCount++<span style="color: #000000;">;<br></span><span style="color: #008080;">11</span>         addEntry(0, <span style="color: #0000ff;">null</span>, value, 0); <span style="color: #008000;">//</span><span style="color: #008000;">如果键为null的话，则hash值为0</span><br><span style="color: #008080;">12</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;<br></span><span style="color: #008080;">13</span>     }</k,v></pre><br></div>

<p>　　注意：如果key为null的话，hash值为0，对象存储在数组中索引为0的位置。</p>
<p>　　我们再回去看看put方法中第4行，它是通过key的hashCode值计算hash码，下面是计算hash码的函数：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span>  <span style="color: #008000;">//</span><span style="color: #008000;">计算hash值的方法 通过键的hashCode来计算</span><br><span style="color: #008080;">2</span>     <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">int</span> hash(<span style="color: #0000ff;">int</span><span style="color: #000000;"> h) {<br></span><span style="color: #008080;">3</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> This function ensures that hashCodes that differ only by<br></span><span style="color: #008080;">4</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> constant multiples at each bit position have a bounded<br></span><span style="color: #008080;">5</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> number of collisions (approximately 8 at default load factor).</span><br><span style="color: #008080;">6</span>         h ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12<span style="color: #000000;">);<br></span><span style="color: #008080;">7</span>         <span style="color: #0000ff;">return</span> h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4<span style="color: #000000;">);<br></span><span style="color: #008080;">8</span>     }</pre><br></div>

<p>　　得到hash码之后就会通过hash码去计算出应该存储在数组中的索引，计算索引的函数如下：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span>     <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">int</span> indexFor(<span style="color: #0000ff;">int</span> h, <span style="color: #0000ff;">int</span> length) { <span style="color: #008000;">//</span><span style="color: #008000;">根据hash值和数组长度算出索引值</span><br><span style="color: #008080;">2</span>         <span style="color: #0000ff;">return</span> h &amp; (length-1);  <span style="color: #008000;">//</span><span style="color: #008000;">这里不能随便算取，用hash&amp;(length-1)是有原因的，这样可以确保算出来的索引是在数组大小范围内，不会超出</span><br><span style="color: #008080;">3</span>     }</pre><br></div>

<p><span><span><span>　　这个方法非常巧妙，它通过</span><span><span class="Apple-converted-space">&nbsp;</span>h &amp; (table.length -1)<span class="Apple-converted-space">&nbsp;</span></span><span>来得到该对象的保存位，而</span><span>HashMap</span><span>底层数组的长度总是</span><span><span class="Apple-converted-space">&nbsp;</span>2<span class="Apple-converted-space">&nbsp;</span></span><span>的</span><span>n<span class="Apple-converted-space">&nbsp;</span></span><span>次方，这是</span><span>HashMap</span><span>在速度上的优化。</span></span></span></p>
<p><span>当</span><span>length</span><span>总是</span><span><span class="Apple-converted-space">&nbsp;</span>2<span class="Apple-converted-space">&nbsp;</span></span><span>的</span><span>n</span><span>次方时，</span><span>h&amp; (length-1)</span><span>运算等价于对</span><span>length</span><span>取模，也就是</span><span>h%length</span><span>，但是</span><span>&amp;</span><span>比</span><span>%</span><span>具有更高的效率。</span></p>
<p><span><span>　　这看上去很简单，其实比较有玄机的，我们举个例子来说明：</span></span></p>
<p><span><span><span>　　假设数组长度分别为</span><span>15</span><span>和</span><span>16</span><span>，优化后的</span><span>hash</span><span>码分别为</span><span>8</span><span>和</span><span>9</span><span>，那么</span><span>&amp;</span><span style="font-size: 10.5pt;">运算后的结果如下：</span></span></span></p>
<p><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span>h &amp; (table.length-1)<span>&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;</span>hash<span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;</span>table.length-1</span></p>
<p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span><span>8 &amp; (15-1)</span><span>：</span><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span>0100<span class="Apple-converted-space">&nbsp;</span><span>&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span>&amp;&nbsp;<span>&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>1110&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span>=<span class="Apple-converted-space">&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;</span>0100</span></span></p>
<p><span><span>&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span><span>9 &amp; (15-1)</span><span>：</span><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span>0101<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span>&amp;<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>1110<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;</span>=<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span>0100</span></span></span></p>
<p><span><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span><span>———————————————————————————————————————–</span></span></span></span></p>
<p><span><span><span><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8 &amp; (16-1)</span><span>：</span><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span>0100<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span>&amp;<span class="Apple-converted-space">&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span>1111<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span>=<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span>0100</span></span></span></span></span></p>
<p><span><span><span><span><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 9 &amp; (16-1)</span><span>：</span><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span>0101<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span>&amp;<span class="Apple-converted-space">&nbsp;</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span>1111<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span>=<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span></span>0101</span></span></span></span></span></span></p>
<p><span><span><span><span><span><span><span><span style="font-family: Calibri;">&nbsp;&nbsp;</span></span></span></span></span></span></span></span></p>
<p><span><span><span><span><span><span><span>　　从上面的例子中可以看出：当它们和</span><span>15-1</span><span>（</span><span>1110</span><span>）</span><span>&ldquo;</span><span>与</span><span>&rdquo;</span><span>的时候，产生了相同的结果，也就是说它们会定位到数组中的同一个位置上去，这就产生了碰撞，</span><span>8</span><span>和</span><span>9</span><span>会被放到数组中的同一个位置上形成链表，那么查询的时候就需要遍历这个链</span><span><span class="Apple-converted-space">&nbsp;</span></span><span>表，得到</span><span>8</span><span>或者</span><span>9</span><span>，这样就降低了查询的效率。同时，我们也可以发现，当数组长度为</span><span>15</span><span>的时候，</span><span>hash</span><span>值会与</span><span>15-1</span><span>（</span><span>1110</span><span>）进行</span><span>&ldquo;</span><span>与</span><span>&rdquo;</span><span>，那么</span><span><span class="Apple-converted-space">&nbsp;</span></span><span>最后一位永远是</span><span>0</span><span>，而</span><span>0001</span><span>，</span><span>0011</span><span>，</span><span>0101</span><span>，</span><span>1001</span><span>，</span><span>1011</span><span>，</span><span>0111</span><span>，</span><span>1101</span><span>这几个位置永远都不能存放元素了，空间浪费相当大，更糟的是这种情况中，数组可以使用的位置比数组长度小了很多，这意味着进一步增加了碰撞的几率，减慢了查询的效率！而当数组长度为</span><span>16</span><span>时，即为</span><span>2</span><span>的</span><span>n</span><span>次方时，</span><span>2<sup>n</sup>-1</span><span>得到的二进制数的每个位上的值都为</span><span>1</span><span>，这使得在低位上</span><span>&amp;</span><span>时，得到的和原</span><span>hash</span><span>的低位相同，加之</span><span>hash(int h)</span><span>方法对</span><span>key</span><span>的</span><span>hashCode</span><span>的进一步优化，加入了高位计算，就使得只有相同的</span><span>hash</span><span>值的两个值才会被放到数组中的同一个位置上形成链表。</span></span></span></span></span></span></span></p>
<p><span><span><span><span><span><span><span><span class="Apple-converted-space">　　&nbsp;</span><span>所以说，当数组长度为</span><span>2</span><span>的</span><span>n</span><span>次幂的时候，不同的</span><span>key</span><span>算得得</span><span>index</span><span>相同的几率较小，那么数据在数组上分布就比较均匀，也就是说碰撞的几率小，相对的，查询的时候就不用遍历某个位置上的链表，这样查询效率也就较高了。</span></span></span></span></span></span></span></span></p>
<p><span><span><span><span><span><span><span><span>　　</span></span></span></span></span></span></span></span></p>
<p><span><span><span><span><span><span><span><span>　　上面说明了前面所说的HashMap容量总是取2的指数次幂的原因。下面我们继续回到put方法里面，前面已经计算出索引的值了，看到第6到14行，如果数组中该索引的位置的链表已经存在key相同的对象，则将其覆盖掉并返回原先的值。如果没有与key相同的键，则调用addEntry方法创建一个Entry对象，addEntry方法如下：</span></span></span></span></span></span></span></span></p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> <span style="color: #0000ff;">void</span> addEntry(<span style="color: #0000ff;">int</span> hash, K key, V value, <span style="color: #0000ff;">int</span><span style="color: #000000;"> bucketIndex) {<br></span><span style="color: #008080;">2</span>         Entry<k,v> e = table[bucketIndex]; <span style="color: #008000;">//</span><span style="color: #008000;">如果要加入的位置有值，将该位置原先的值设置为新entry的next,也就是新entry链表的下一个节点</span><br><span style="color: #008080;">3</span>         table[bucketIndex] = <span style="color: #0000ff;">new</span> Entry&lt;&gt;<span style="color: #000000;">(hash, key, value, e);<br></span><span style="color: #008080;">4</span>         <span style="color: #0000ff;">if</span> (size++ &gt;= threshold) <span style="color: #008000;">//</span><span style="color: #008000;">如果大于临界值就扩容</span><br><span style="color: #008080;">5</span>             resize(2 * table.length); <span style="color: #008000;">//</span><span style="color: #008000;">以2的倍数扩容</span><br><span style="color: #008080;">6</span>     }</k,v></pre><br></div>

<p>　　参数bucketIndex就是indexFor函数计算出来的索引值，第2行代码是取得数组中索引为bucketIndex的Entry对象，第3行就是用hash、key、value构建一个新的Entry对象放到索引为bucketIndex的位置，并且将该位置原先的对象设置为新对象的next构成链表。</p>
<p>　　第4行和第5行就是判断put后size是否达到了临界值threshold，如果达到了临界值就要进行扩容，HashMap扩容是扩为原来的两倍。resize()方法如下：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span>     <span style="color: #0000ff;">void</span> resize(<span style="color: #0000ff;">int</span><span style="color: #000000;"> newCapacity) {<br></span><span style="color: #008080;"> 2</span>         Entry[] oldTable =<span style="color: #000000;"> table;<br></span><span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">int</span> oldCapacity =<span style="color: #000000;"> oldTable.length;<br></span><span style="color: #008080;"> 4</span>         <span style="color: #0000ff;">if</span> (oldCapacity ==<span style="color: #000000;"> MAXIMUM_CAPACITY) {<br></span><span style="color: #008080;"> 5</span>             threshold =<span style="color: #000000;"> Integer.MAX_VALUE;<br></span><span style="color: #008080;"> 6</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;">;<br></span><span style="color: #008080;"> 7</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;"> 8</span><br><span style="color: #008080;"> 9</span>         Entry[] newTable = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Entry[newCapacity];<br></span><span style="color: #008080;">10</span>         transfer(newTable);<span style="color: #008000;">//</span><span style="color: #008000;">用来将原先table的元素全部移到newTable里面</span><br><span style="color: #008080;">11</span>         table = newTable;  <span style="color: #008000;">//</span><span style="color: #008000;">再将newTable赋值给table</span><br><span style="color: #008080;">12</span>         threshold = (<span style="color: #0000ff;">int</span>)(newCapacity * loadFactor);<span style="color: #008000;">//</span><span style="color: #008000;">重新计算临界值</span><br><span style="color: #008080;">13</span>     }</pre><br></div>

<p>　　扩容是需要进行数组复制的，上面代码中第10行为复制数组，复制数组是<span style="font: 14px/25.2px Helvetica, Tahoma, Arial, sans-serif; text-align: left; color: #000000; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; font-size-adjust: none; font-stretch: normal; background-color: #ffffff; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">非常消耗性能的操作，所以如果我们已经预知</span><span style="font: 14px/25.2px Helvetica, Tahoma, Arial, sans-serif; text-align: left; color: #000000; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; font-size-adjust: none; font-stretch: normal; background-color: #ffffff; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">HashMap</span><span style="font: 14px/25.2px Helvetica, Tahoma, Arial, sans-serif; text-align: left; color: #000000; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; font-size-adjust: none; font-stretch: normal; background-color: #ffffff; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">中元素的个数，那么预设元素的个数能够有效的提高</span><span style="font: 14px/25.2px Helvetica, Tahoma, Arial, sans-serif; text-align: left; color: #000000; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; font-size-adjust: none; font-stretch: normal; background-color: #ffffff; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">HashMap</span><span style="font: 14px/25.2px Helvetica, Tahoma, Arial, sans-serif; text-align: left; color: #000000; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; font-size-adjust: none; font-stretch: normal; background-color: #ffffff; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">的性能。</span></p>
<p><span style="font: 14px/25.2px Helvetica, Tahoma, Arial, sans-serif; text-align: left; color: #000000; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; font-size-adjust: none; font-stretch: normal; background-color: #ffffff; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">　　</span></p>
<p><span style="font: 14px/25.2px Helvetica, Tahoma, Arial, sans-serif; text-align: left; color: #000000; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; font-size-adjust: none; font-stretch: normal; background-color: #ffffff; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">　　总结：以前对HashMap和HashTable的区别总是要死记，而且容易忘记。分析完源码之后他们之前的区别都知道了，连细微的区别都能够清楚，而且是记忆深刻。所以研究一下源码，学习一下别人的设计思路可以学到很多东西的。</span></p>
<p>&nbsp;</p>
<p>参考资料：<a href="http://zhangshixi.iteye.com/blog/672697#comments" target="_blank" rel="external">http://zhangshixi.iteye.com/blog/672697#comments</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuling07.github.io/2013/08/hashmap-source.html" data-id="ciiy5f4vn00amq1d00119ejb0" class="article-share-link">Share</a>
      
        <a href="http://liuling07.github.io/2013/08/hashmap-source.html#ds-thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-list-concurrentmodificationexception" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/08/list-concurrentmodificationexception.html">使用迭代器遍历List的时候修改List报ConcurrentModificationException异常原因分析</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2013/08/list-concurrentmodificationexception.html">
      <time datetime="2013-08-21T03:20:00.000Z" itemprop="datePublished">2013-08-21</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Java基础/">Java基础</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>　　在使用Iterator来迭代遍历List的时候如果修改该List对象，则会报java.util.ConcurrentModificationException异常，下面看一个例子演示：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.others;<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.ArrayList;<br></span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Iterator;<br></span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;<br></span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.concurrent.CopyOnWriteArrayList;<br></span><span style="color: #008080;"> 7</span><br><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> ArrayListTest {<br></span><span style="color: #008080;"> 9</span><br><span style="color: #008080;">10</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {<br></span><span style="color: #008080;">11</span>         List<string> list = <span style="color: #0000ff;">new</span> ArrayList<string><span style="color: #000000;">();<br></span><span style="color: #008080;">12</span>         <span style="color: #008000;">//</span><span style="color: #008000;">CopyOnWriteArrayList<string> list = new CopyOnWriteArrayList<string>();</string></string></span><br><span style="color: #008080;">13</span>         list.add(“a”<span style="color: #000000;">);<br></span><span style="color: #008080;">14</span>         list.add(“b”<span style="color: #000000;">);<br></span><span style="color: #008080;">15</span>         list.add(“c”<span style="color: #000000;">);<br></span><span style="color: #008080;">16</span>         list.add(“d”<span style="color: #000000;">);<br></span><span style="color: #008080;">17</span>         list.add(“e”<span style="color: #000000;">);<br></span><span style="color: #008080;">18</span>         Iterator iterator =<span style="color: #000000;"> list.iterator();<br></span><span style="color: #008080;">19</span>         <span style="color: #0000ff;">while</span><span style="color: #000000;">(iterator.hasNext()){<br></span><span style="color: #008080;">20</span>             String str =<span style="color: #000000;"> (String) iterator.next();<br></span><span style="color: #008080;">21</span>             <span style="color: #0000ff;">if</span>(str.equals(“c”<span style="color: #000000;">)){<br></span><span style="color: #008080;">22</span> <span style="color: #000000;">                list.remove(str);<br></span><span style="color: #008080;">23</span>             }<span style="color: #0000ff;">else</span><span style="color: #000000;">{<br></span><span style="color: #008080;">24</span> <span style="color: #000000;">                System.out.println(str);<br></span><span style="color: #008080;">25</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">26</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">27</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">28</span><br><span style="color: #008080;">29</span> }</string></string></pre><br></div>

<p>　　结果为：</p>
<div class="cnblogs_code"><br><pre><span style="color: #000000;">a<br>b<br>Exception in thread </span>“main”<span style="color: #000000;"> java.util.ConcurrentModificationException<br>    at java.util.ArrayList$Itr.checkForComodification(ArrayList.java:</span>819<span style="color: #000000;">)<br>    at java.util.ArrayList$Itr.next(ArrayList.java:</span>791<span style="color: #000000;">)<br>    at com.others.ArrayListTest.main(ArrayListTest.java:</span>20)</pre><br></div>

<p>&nbsp;</p>
<p>　　当调用list的iterator()方法的时候，返回的是一个Itr对象（实现了Iterator接口）：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> <span style="color: #0000ff;">public</span> Iterator<e><span style="color: #000000;"> iterator() {<br></span><span style="color: #008080;">2</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> Itr();<br></span><span style="color: #008080;">3</span>     }</e></pre><br></div>

<p>　　我们看一下Itr这个类：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">class</span> Itr <span style="color: #0000ff;">implements</span> Iterator<e><span style="color: #000000;"> {<br></span><span style="color: #008080;"> 2</span>         <span style="color: #0000ff;">int</span> cursor;       <span style="color: #008000;">//</span><span style="color: #008000;"> index of next element to return</span><br><span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">int</span> lastRet = -1; <span style="color: #008000;">//</span><span style="color: #008000;"> index of last element returned; -1 if no such</span><br><span style="color: #008080;"> 4</span>         <span style="color: #0000ff;">int</span> expectedModCount = modCount; <span style="color: #008000;">//</span><span style="color: #008000;">刚创建迭代对象的时候List的modCount</span><br><span style="color: #008080;"> 5</span><br><span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> hasNext() {<br></span><span style="color: #008080;"> 7</span>             <span style="color: #0000ff;">return</span> cursor !=<span style="color: #000000;"> size;<br></span><span style="color: #008080;"> 8</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;"> 9</span><br><span style="color: #008080;">10</span>         @SuppressWarnings(“unchecked”<span style="color: #000000;">)<br></span><span style="color: #008080;">11</span>         <span style="color: #0000ff;">public</span><span style="color: #000000;"> E next() {<br></span><span style="color: #008080;">12</span>             checkForComodification(); <span style="color: #008000;">//</span><span style="color: #008000;">每调用一次next()函数都会调用checkForComodification方法判断一次</span><br><span style="color: #008080;">13</span>             <span style="color: #0000ff;">int</span> i =<span style="color: #000000;"> cursor;<br></span><span style="color: #008080;">14</span>             <span style="color: #0000ff;">if</span> (i &gt;=<span style="color: #000000;"> size)<br></span><span style="color: #008080;">15</span>                 <span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> NoSuchElementException();<br></span><span style="color: #008080;">16</span>             Object[] elementData = ArrayList.<span style="color: #0000ff;">this</span><span style="color: #000000;">.elementData;<br></span><span style="color: #008080;">17</span>             <span style="color: #0000ff;">if</span> (i &gt;=<span style="color: #000000;"> elementData.length)<br></span><span style="color: #008080;">18</span>                 <span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> ConcurrentModificationException();<br></span><span style="color: #008080;">19</span>             cursor = i + 1<span style="color: #000000;">;<br></span><span style="color: #008080;">20</span>             <span style="color: #0000ff;">return</span> (E) elementData[lastRet =<span style="color: #000000;"> i];<br></span><span style="color: #008080;">21</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">22</span><br><span style="color: #008080;">23</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> remove() {<br></span><span style="color: #008080;">24</span>             <span style="color: #0000ff;">if</span> (lastRet &lt; 0<span style="color: #000000;">)<br></span><span style="color: #008080;">25</span>                 <span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> IllegalStateException();<br></span><span style="color: #008080;">26</span> <span style="color: #000000;">            checkForComodification();<br></span><span style="color: #008080;">27</span><br><span style="color: #008080;">28</span>             <span style="color: #0000ff;">try</span><span style="color: #000000;"> {<br></span><span style="color: #008080;">29</span>                 ArrayList.<span style="color: #0000ff;">this</span><span style="color: #000000;">.remove(lastRet);<br></span><span style="color: #008080;">30</span>                 cursor =<span style="color: #000000;"> lastRet;<br></span><span style="color: #008080;">31</span>                 lastRet = -1<span style="color: #000000;">;<br></span><span style="color: #008080;">32</span>                 expectedModCount =<span style="color: #000000;"> modCount;<br></span><span style="color: #008080;">33</span>             } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IndexOutOfBoundsException ex) {<br></span><span style="color: #008080;">34</span>                 <span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> ConcurrentModificationException();<br></span><span style="color: #008080;">35</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">36</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">37</span>         <span style="color: #008000;">//</span><span style="color: #008000;">此方法用来判断创建迭代对象的时候List的modCount与现在List的modCount是否一样，不一样的话就报ConcurrentModificationException异常</span><br><span style="color: #008080;">38</span>         <span style="color: #0000ff;">final</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> checkForComodification() {<br></span><span style="color: #008080;">39</span>             <span style="color: #0000ff;">if</span> (modCount !=<span style="color: #000000;"> expectedModCount)<br></span><span style="color: #008080;">40</span>                 <span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> ConcurrentModificationException();<br></span><span style="color: #008080;">41</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">42</span>     }</e></pre><br></div>

<p>　　List对象有一个成员变量modCount，它代表该List对象被修改的次数，每对List对象修改一次，modCount都会加1.</p>
<p>　　Itr类里有一个成员变量expectedModCount，它的值为创建Itr对象的时候List的modCount值。用此变量来检验在迭代过程中List对象是否被修改了，如果被修改了则抛出java.util.ConcurrentModificationException异常。在每次调用Itr对象的next()方法的时候都会调用<span style="font: 14px/19px 'Lucida Grande', Verdana, Arial, sans-serif; text-align: left; color: #000000; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; orphans: 2; widows: 2; font-size-adjust: none; font-stretch: normal; background-color: #ffffff; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">checkForComodification()</span>方法进行一次检验，<span style="font: 14px/19px 'Lucida Grande', Verdana, Arial, sans-serif; text-align: left; color: #000000; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; orphans: 2; widows: 2; font-size-adjust: none; font-stretch: normal; background-color: #ffffff; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">checkForComodification()方法中做的工作就是比较expectedModCount&nbsp;和modCount的值是否相等，如果不相等，就认为还有其他对象正在对当前的List进行操作，那个就会抛出ConcurrentModificationException异常。</span></p>
<p><span style="font: 14px/19px 'Lucida Grande', Verdana, Arial, sans-serif; text-align: left; color: #000000; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; orphans: 2; widows: 2; font-size-adjust: none; font-stretch: normal; background-color: #ffffff; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">　　我们再来分析一下上面那个例子，当例子程序执行到22行的时候，将list对象里面的&ldquo;c”删除了，同时list对象的modCount值加1，但是Itr对象的expectedModCount没有变，他们肯定是不相等了。等再一次执行next()方法的时候调用了<span style="font: 14px/19px 'Lucida Grande', Verdana, Arial, sans-serif; text-align: left; color: #000000; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; orphans: 2; widows: 2; font-size-adjust: none; font-stretch: normal; background-color: #ffffff; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">checkForComodification()</span>方法，这时候就抛出异常了。</span></p>
<p><span style="font: 14px/19px 'Lucida Grande', Verdana, Arial, sans-serif; text-align: left; color: #000000; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; orphans: 2; widows: 2; font-size-adjust: none; font-stretch: normal; background-color: #ffffff; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">　　我们再将上面那个例子稍微改动一下：将21行改为if(str.equals(“d”)){，即删除&rdquo;d”这个元素。运行结果如下：</span></p>
<p><span style="font: 14px/19px 'Lucida Grande', Verdana, Arial, sans-serif; text-align: left; color: #000000; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; orphans: 2; widows: 2; font-size-adjust: none; font-stretch: normal; background-color: #ffffff; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">a</span></p>
<p><span style="font: 14px/19px 'Lucida Grande', Verdana, Arial, sans-serif; text-align: left; color: #000000; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; orphans: 2; widows: 2; font-size-adjust: none; font-stretch: normal; background-color: #ffffff; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">b</span></p>
<p><span style="font: 14px/19px 'Lucida Grande', Verdana, Arial, sans-serif; text-align: left; color: #000000; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; orphans: 2; widows: 2; font-size-adjust: none; font-stretch: normal; background-color: #ffffff; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">c</span></p>
<p><span style="font: 14px/19px 'Lucida Grande', Verdana, Arial, sans-serif; text-align: left; color: #000000; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; float: none; display: inline !important; white-space: normal; orphans: 2; widows: 2; font-size-adjust: none; font-stretch: normal; background-color: #ffffff; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;">　　这时却没有报异常了，但是&ldquo;e”却没有输出来，这是为什么呢？原因很简单，我们看到Itr的hashNext()方法：</span></p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> hasNext() {<br></span><span style="color: #008080;">2</span>             <span style="color: #0000ff;">return</span> cursor !=<span style="color: #000000;"> size;<br></span><span style="color: #008080;">3</span>         }</pre><br></div>

<p>　　它是通过Itr的对象的cursor与List对象的size值来判断是否还有未迭代的对象，当遍历完&ldquo;d”的时候cursor=4，删除&rdquo;d”的时候，List对象的size就会减1，size首先为5，后来变为4，这时候cursor和size是相等的，hasNext()方法返回的是false，就认为遍历结束了，所以删除以后没有进去执行next()方法了，就没有抛出异常了，当然”e”也没有输出来。</p>
<p>　　为了避免这种异常，我们可以使用CopyOnWriteArrayList来代替ArrayList，CopyOnWriteArrayList支持并发访问，所以同时进行迭代和修改是没有问题的。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuling07.github.io/2013/08/list-concurrentmodificationexception.html" data-id="ciiy5f4sl005uq1d0dlmaomnd" class="article-share-link">Share</a>
      
        <a href="http://liuling07.github.io/2013/08/list-concurrentmodificationexception.html#ds-thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/解决方案/">解决方案</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/4/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/6/">Next &raquo;</a>
      </nav>
    </section>
      
        <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新博文</h3>
    <div class="widget">
      <ul id="recent-post" class="no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/人生感悟/">人生感悟</a></p>
              <p class="item-title"><a href="/2015/12/say-bye-to-my-2015.html" class="title">Say bye to my 2015</a></p>
              <p class="item-date"><time datetime="2015-12-25T09:25:10.000Z" itemprop="datePublished">2015-12-25</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/Android/">Android</a></p>
              <p class="item-title"><a href="/2015/12/mvp-pattern-android.html" class="title">MVP模式在Android项目中的使用</a></p>
              <p class="item-date"><time datetime="2015-12-23T14:16:04.000Z" itemprop="datePublished">2015-12-23</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/Android/">Android</a></p>
              <p class="item-title"><a href="/2015/12/intent-resolving-in-android-m.html" class="title">【译文】Android M中Intent的解析</a></p>
              <p class="item-date"><time datetime="2015-12-04T06:52:06.000Z" itemprop="datePublished">2015-12-04</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/Android/">Android</a></p>
              <p class="item-title"><a href="/2015/12/performance-listviews.html" class="title">【译文】高性能ListViews</a></p>
              <p class="item-date"><time datetime="2015-12-02T10:22:14.000Z" itemprop="datePublished">2015-12-02</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/Android/">Android</a></p>
              <p class="item-title"><a href="/2015/11/android-multi-photo-picker.html" class="title">Android带多选功能的PhotoPicker</a></p>
              <p class="item-date"><time datetime="2015-11-21T07:46:03.000Z" itemprop="datePublished">2015-11-21</time></p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">博文分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Framework/">Framework</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hadoop/">Hadoop</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JNI-amp-NDK/">JNI&amp;NDK</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java基础/">Java基础</a><span class="category-list-count">35</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NoSQL/">NoSQL</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/人生感悟/">人生感悟</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/其他技术/">其他技术</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/后端/">后端</a><span class="category-list-count">29</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构和算法/">数据结构和算法</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><span class="category-list-count">7</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/AsyncTask/" style="font-size: 11.54px;">AsyncTask</a> <a href="/tags/LruCache/" style="font-size: 10px;">LruCache</a> <a href="/tags/MVP/" style="font-size: 10px;">MVP</a> <a href="/tags/NoSQL/" style="font-size: 13.08px;">NoSQL</a> <a href="/tags/android/" style="font-size: 18.46px;">android</a> <a href="/tags/android-studio/" style="font-size: 10px;">android studio</a> <a href="/tags/c/" style="font-size: 10px;">c++</a> <a href="/tags/camera/" style="font-size: 10px;">camera</a> <a href="/tags/framework/" style="font-size: 10.77px;">framework</a> <a href="/tags/hadoop/" style="font-size: 14.62px;">hadoop</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/jni/" style="font-size: 13.08px;">jni</a> <a href="/tags/linux/" style="font-size: 16.15px;">linux</a> <a href="/tags/mysql/" style="font-size: 11.54px;">mysql</a> <a href="/tags/redis/" style="font-size: 13.08px;">redis</a> <a href="/tags/spring/" style="font-size: 10.77px;">spring</a> <a href="/tags/sqlite/" style="font-size: 10px;">sqlite</a> <a href="/tags/web后端/" style="font-size: 19.23px;">web后端</a> <a href="/tags/内存缓存/" style="font-size: 10px;">内存缓存</a> <a href="/tags/前端/" style="font-size: 13.85px;">前端</a> <a href="/tags/反射/" style="font-size: 10px;">反射</a> <a href="/tags/图片选择/" style="font-size: 10.77px;">图片选择</a> <a href="/tags/多线程/" style="font-size: 17.69px;">多线程</a> <a href="/tags/布局/" style="font-size: 12.31px;">布局</a> <a href="/tags/布局优化/" style="font-size: 10.77px;">布局优化</a> <a href="/tags/开源/" style="font-size: 10.77px;">开源</a> <a href="/tags/断点续传/" style="font-size: 11.54px;">断点续传</a> <a href="/tags/科学上网/" style="font-size: 10px;">科学上网</a> <a href="/tags/自定义控件/" style="font-size: 10px;">自定义控件</a> <a href="/tags/解决方案/" style="font-size: 16.92px;">解决方案</a> <a href="/tags/设计模式/" style="font-size: 15.38px;">设计模式</a> <a href="/tags/译文/" style="font-size: 10.77px;">译文</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">博文归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">March 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">November 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">September 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">August 2013</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">May 2013</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">November 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">August 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">July 2012</a><span class="archive-list-count">8</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap widget-list">
    <h3 class="widget-title">友情链接</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a target="_blank" href="http://blog.daimajia.com">代码家</a>
          </li>
        
          <li>
            <a target="_blank" href="http://www.trinea.cn">Trinea</a>
          </li>
        
          <li>
            <a target="_blank" href="https://www.aswifter.com">APP开发者</a>
          </li>
        
          <li>
            <a target="_blank" href="http://blog.seoui.com">笑松小站</a>
          </li>
        
          <li>
            <a target="_blank" href="http://www.apkfuns.com">舞影凌风</a>
          </li>
        
          <li>
            <a target="_blank" href="http://www.ttfde.org">TTF的家园</a>
          </li>
        
          <li>
            <a target="_blank" href="http://rocko.xyz">Rocko&#39;s blog</a>
          </li>
        
          <li>
            <a target="_blank" href="http://www.93sec.cc">教程资源网</a>
          </li>
        
      </ul>
    </div>
  </div>


  
  <div id="toTop" class="fa fa-chevron-up"></div>
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2000 - 2016 Lauren<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    

<script type="text/javascript">
  var duoshuoQuery = {short_name:"liuling07"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>





 <script src="//ajax.lug.ustc.edu.cn/ajax/libs/jquery/2.1.3/jquery.min.js"></script>




  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>