<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>残剑博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Hexo theme - Icarus">
<meta property="og:type" content="website">
<meta property="og:title" content="残剑博客">
<meta property="og:url" content="http://liuling07.github.io/page/12/index.html">
<meta property="og:site_name" content="残剑博客">
<meta property="og:description" content="Hexo theme - Icarus">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="残剑博客">
<meta name="twitter:description" content="Hexo theme - Icarus">
  
  
    <link rel="icon" href="favicon.png">
  
  
 <link href='//fonts.lug.ustc.edu.cn/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
 <link href="//fonts.lug.ustc.edu.cn/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">


  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css" type="text/css">
  

  

  
</head>
<body>
  <div id="container">
    <header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="/" id="logo"><i class="logo" style="background-image: url(/css/images/logo.png)"></i><span class="site-title">残剑博客</span></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/.">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/categories">Categories</a>
        
          <a class="main-nav-link" href="/tags">Tags</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      
        <nav id="sub-nav">
          <div class="profile" id="profile-nav">
            <a id="profile-anchor" href="javascript:;"><img class="avatar" src="/css/images/protrait.jpg"><i class="fa fa-caret-down"></i></a>
          </div>
        </nav>
      
      <div id="search-form-wrap">
        
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="sitesearch" value="http://liuling07.github.io"></form>
        
      </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tr>
        
          <td><a class="main-nav-link" href="/.">Home</a></td>
        
          <td><a class="main-nav-link" href="/archives">Archives</a></td>
        
          <td><a class="main-nav-link" href="/categories">Categories</a></td>
        
          <td><a class="main-nav-link" href="/tags">Tags</a></td>
        
          <td><a class="main-nav-link" href="/about">About</a></td>
        
        <td>
          
            <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="http://liuling07.github.io"></form>
          
        </td>
      </tr>
    </table>
  </div>
</header>

    <div class="outer">
      
        <aside id="profile">
  <div class="inner profile-inner">
    <div class="base-info profile-block">
      <img id="avatar" src="/css/images/protrait.jpg">
      <h2 id="name">Lauren</h2>
      <h3 id="title">Android Developer</h3>
      <span id="location"><i class="fa fa-map-marker"></i>Shenzhen, China</span>
      <a id="follow" href="https://github.com/liuling07">FOLLOW</a>
    </div>
    <div class="article-info profile-block">
      <div class="article-info-block">
        135
        <span>posts</span>
      </div>
      <div class="article-info-block">
        32
        <span>tags</span>
      </div>
    </div>
    
    <div class="contact-info profile-block">
      <table class="contact-list">
        <tr>
          
          <td><a href="https://github.com/liuling07" target="_blank" title="github"><i class="fa fa-github"></i></a></td>
          
          <td><a href="http://weibo.com/LaurenLiuling/" target="_blank" title="weibo"><i class="fa fa-weibo"></i></a></td>
          
          <td><a href="https://plus.google.com/u/0/107098505138563589748/" target="_blank" title="google-plus"><i class="fa fa-google-plus"></i></a></td>
          
          <td><a href="http://stackoverflow.com/users/5629327/lauren-liuling" target="_blank" title="stack-overflow"><i class="fa fa-stack-overflow"></i></a></td>
          
          <td><a href="https://twitter.com/lauren_liuLing/" target="_blank" title="twitter"><i class="fa fa-twitter"></i></a></td>
          
          <td><a href="https://www.facebook.com/lauren.liuling/" target="_blank" title="facebook"><i class="fa fa-facebook"></i></a></td>
          
          <td><a href="/atom.xml" target="_blank" title="rss"><i class="fa fa-rss"></i></a></td>
          
        </tr>
      </table>
    </div>
    
    
  </div>
</aside>

      
      <section id="main">
      <article id="post-jquery-ajax" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/02/jquery-ajax.html">详细解读Jquery各Ajax函数：$.get(),$.post(),$.ajax(),$.getJSON()</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2013/02/jquery-ajax.html">
      <time datetime="2013-02-07T00:46:00.000Z" itemprop="datePublished">2013-02-07</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/前端/">前端</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>一，$.get(url,[data],[callback])</p>
<p>说明：url为请求地址，data为请求数据的列表(是可选的，也可以将要传的参数写在url里面)，callback为请求成功后的回调函数，该函数接受两个参数，第一个为服务器返回的数据，第二个参数为服务器的状态，是可选参数。而其中，服务器返回数据的格式其实是字符串形势，并不是我们想要的json数据格式，在此引用只是为了对比说明。</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> $.get(“data.php”,$(“#firstName.val()”),<span style="color: #0000ff;">function</span><span style="color: #000000;">(data){<br></span><span style="color: #008080;">2</span><br><span style="color: #008080;">3</span> 　　$(“#getResponse”).html(data); }<span style="color: #008000;">//</span><span style="color: #008000;">返回的data是字符串类型</span><br><span style="color: #008080;">4</span><br><span style="color: #008080;">5</span> );</pre><br></div>

<p>&nbsp;</p>
<p>二，$.post(url,[data],[callback],[type])</p>
<p>说明：这个函数跟$.get()参数差不多，多了一个type参数，type为返回的数据类型，可以是html,xml,json等类型，如果我们设置这个参数为：json，那么返回的格式则是json格式的，如果没有设置，就 和$.get()返回的格式一样，都是字符串的。</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> $.post(“emp.do?p=getAllEmp”,{id:deptId,x:Math.random()},<span style="color: #0000ff;">function</span><span style="color: #000000;">(data){<br></span><span style="color: #008080;">2</span>             <span style="color: #0000ff;">var</span> arry = eval(“(“+data+”)”);<span style="color: #008000;">//</span><span style="color: #008000;">去引号，将json字符串去引号编程json类型数组，也可以在$.post函数后面加一个参数”json”，指定接收的数据为json类型的</span><br><span style="color: #008080;">3</span>             <span style="color: #0000ff;">for</span>(<span style="color: #0000ff;">var</span> i=0;i<arry.length;i++<span style="color: #000000;">){<br><span style="color: #008080;">4</span>                 <span style="color: #0000ff;">var</span> op = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Option(arry[i].empName,arry[i].empId);<br></span><span style="color: #008080;">5</span>                 document.getElementById(“emp”<span style="color: #000000;">).options.add(op);<br></span><span style="color: #008080;">6</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">7</span>         });</arry.length;i++<span></pre><br></div>

<p>也可以写成下面这样，返回的就是json类型数组了，就不要难过去引号了，可以直接遍历。</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> $.post(“emp.do?p=getAllEmp”,{id:deptId,x:Math.random()},<span style="color: #0000ff;">function</span><span style="color: #000000;">(arry){<br></span><span style="color: #008080;">2</span>             <span style="color: #0000ff;">for</span>(<span style="color: #0000ff;">var</span> i=0;i<arry.length;i++<span style="color: #000000;">){<br><span style="color: #008080;">3</span>                 <span style="color: #0000ff;">var</span> op = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Option(arry[i].empName,arry[i].empId);<br></span><span style="color: #008080;">4</span>                 document.getElementById(“emp”<span style="color: #000000;">).options.add(op);<br></span><span style="color: #008080;">5</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">6</span>         },”json”);</arry.length;i++<span></pre><br></div>

<p>三，$.ajax(opiton)</p>
<p>说明：$.ajax()这个函数功能强大，可以对ajax进行许多精确的控制，需要详细说明的请参照相关资料</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> <span style="color: #000000;">$.ajax({<br></span><span style="color: #008080;">2</span> 　　url: “ajax/ajax_selectPicType.jsp”<span style="color: #000000;">,<br></span><span style="color: #008080;">3</span> 　　data:{Full:”fu”<span style="color: #000000;">},<br></span><span style="color: #008080;">4</span> 　　type: “POST”<span style="color: #000000;">,<br></span><span style="color: #008080;">5</span> 　　dataType:’json’<span style="color: #000000;">,<br></span><span style="color: #008080;">6</span> 　　<span style="color: #000000;">success:CallBack,<br></span><span style="color: #008080;">7</span> 　　error:<span style="color: #0000ff;">function</span><span style="color: #000000;">(er){<br></span><span style="color: #008080;">8</span> 　　<span style="color: #000000;">BackErr(er);}<br></span><span style="color: #008080;">9</span> });</pre><br></div>

<p>四，$.getJSON(url,[data],[callback])</p>
<p>说明:$.getJSON(url,[data],[callback])函数没有type参数，返回的是json类型的，不需要转换。</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> $.getJSON(“dep.do?p=getAllDep”,{x:Math.random()},<span style="color: #0000ff;">function</span><span style="color: #000000;">(arry){<br></span><span style="color: #008080;">2</span>             <span style="color: #0000ff;">for</span>(<span style="color: #0000ff;">var</span> i=0;i<arry.length;i++<span style="color: #000000;">){<br><span style="color: #008080;">3</span>                 <span style="color: #0000ff;">var</span> op = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Option(arry[i].deptName,arry[i].deptId);<br></span><span style="color: #008080;">4</span>                 document.getElementById(“dep”<span style="color: #000000;">).options.add(op);<br></span><span style="color: #008080;">5</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">6</span>         });</arry.length;i++<span></pre><br></div>

<p>&nbsp;</p>
<p>jquery的其他一些函数：</p>
<p>载入静态页面</p>
<p>load( url, [data], [callback] );<br>url (String) 请求的HTML页的URL地址<br>data (Map)(可选参数) 发送至服务器的 key/value 数据<br>callback (Callback) (可选参数) 请求完成时(不需要是success的)的回调函数</p>
<p>load()方法可以轻松载入静态页面内容到指定jQuery对象。<br>$(‘#ajax-div’).load(‘data.html’);</p>
<p>这样，data.html的内容将被载入到ID为ajax-div的DOM对象之内。你甚至可以通过制定ID来实现载入部分内容的Ajax操作，如：</p>
<p>$(‘#ajax-div’).load(‘data.html#my-section’);<br>实现GET和POST方法 </p>
<p>get( url, [data], [callback] )<br>url (String) 发送请求的URL地址.<br>data (Map)(可选参数) 要发送给服务器的数据，以 Key/value 的键值对形式表示，会做为QueryString附加到请求URL中<br>callback (Callback) (可选参数) 载入成功时回调函数(只有当Response的返回状态是success才是调用该方法)</p>
<p>很显然这是一个专门实现GET方式的函数，使用起来也相当的简单<br>$.get(‘login.jsp’, {<br>&nbsp;&nbsp; id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : ‘Robin’,<br>&nbsp;&nbsp; password: ‘123456’,<br>&nbsp;&nbsp; gate&nbsp;&nbsp;&nbsp; : ‘index’<br>&nbsp; }, function(data, status) {<br>&nbsp;&nbsp; //data为返回对象，status为请求的状态<br>&nbsp;&nbsp; alert(data);<br>&nbsp;&nbsp; //此时假设服务器脚本会返回一段文字”你好，Robin！”，<br>那么浏览器就会弹出对话框显示该段文字<br>&nbsp;&nbsp; alert(status);<br>&nbsp;&nbsp; //结果为success, error等等，但这里是成功时才能运行的函数<br>&nbsp; });</p>
<p>&nbsp;</p>
<p>post( url, [data], [callback], [type] )</p>
<p>url (String) 发送请求的URL地址.<br>data (Map)(可选参数) 要发送给服务器的数据，以 Key/value 的键值对形式表示<br>callback (Callback) (可选参数) 载入成功时回调函数(只有当Response的返回状态是success才是调用该方法)<br>type (String) (可选参数) 请求数据的类型，xml,text,json等</p>
<p>同样是jQuery提供的一个简便函数，其实用法<br>&nbsp;<br>$.post(‘regsiter.jsp’, {<br>&nbsp;&nbsp; id:’Robin’,<br>&nbsp;&nbsp; password: ‘123456’,<br>&nbsp;&nbsp; type:’user’<br>&nbsp; },function(data, status) {<br>&nbsp;&nbsp; alert(data);<br>&nbsp; }, “json”);</p>
<p>&nbsp;</p>
<p>事件驱动的脚本载入函数：getScript()</p>
<p>getScript( url, [callback] )<br>url (String) 待载入 JS 文件地址<br>callback (Function) (可选) 成功载入后回调函数</p>
<p>getScript()函数可以远程载入JavaScript脚本并且执行。这个函数可以跨 域载入JS文件（神奇&hellip;&hellip;？！）。这个函数的意义是巨大 的，它可以很大程度的缩减页面初次载入的代码量，因为你可以根据用户的交互来载入相应的JS文件，而不必在页面初始化的时候全部载入。<br>&nbsp;<br>$.getScript(‘ajaxEvent.js’, function() {<br>&nbsp;&nbsp; alert(“Scripts Loaded!”);<br>&nbsp;&nbsp; //载入ajaxEvent.js，并且在成功载入后显示对话框提示。<br>&nbsp; });</p>
<p>&nbsp;</p>
<p>构建数据通讯的桥梁：getJSON()</p>
<p>getJSON(url,[data],[callback])<br>url (String) 发送请求地址<br>data (Map) (可选) 待发送 Key/value 参数<br>callback (Function) (可选) 载入成功时回调函数。</p>
<p>JSON是一种理想的数据传输格式，它能够很好的融合与JavaScript或其他宿主语 言，并且可以被JS直接使用。使用JSON相比传统的通过 GET、POST直接发送&rdquo;裸体&rdquo;数据，在结构上更为合理，也更为安全。至于jQuery的getJSON()函数，只是设置了JSON参数的 ajax()函数的一个简化版本。这个函数也是可以跨域使用的，相比get()、post()有一定优势。另外这个函数可以通过把请求url写 成&rdquo;myurl?callback=X&rdquo;这种格式，让程序执行回调函数X。</p>
<p>$.getJSON(‘feed.jsp’,{<br>&nbsp;&nbsp; request: images,<br>&nbsp;&nbsp; id:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 001,<br>&nbsp;&nbsp; size:&nbsp;&nbsp;&nbsp; large<br>&nbsp;&nbsp; }, function(json) {<br>&nbsp;&nbsp;&nbsp; alert(json.images[0].link);<br>&nbsp;&nbsp;&nbsp; //此处json就是远程传回的json对象，假设其格式如下：<br>&nbsp;&nbsp;&nbsp; //{‘images’ : [<br>&nbsp;&nbsp;&nbsp; // {link: images/001.jpg, x :100, y : 100},<br>&nbsp;&nbsp;&nbsp; // {link: images/002.jpg, x : 200, y 200:}<br>&nbsp;&nbsp;&nbsp; //]};<br>&nbsp;&nbsp; }<br>&nbsp;);</p>
<p>&nbsp;</p>
<p>更底层的ajax()函数<br>虽然get()和post()函数非常简洁易用，但是对于更复杂的一些设计需求还是无法实现，比如在ajax发送的不同时段做出不同的动作等。jQuery提供一个更为具体的函数：ajax()。</p>
<p>ajax( options )<br>ajax()提供了一大票参数，所以可以实现相当复杂的功能。 </p>
<p>参数名 类型 描述<br>url String (默认: 当前页地址) 发送请求的地址。<br>type String (默认: &ldquo;GET&rdquo;) 请求方式 (&ldquo;POST&rdquo; 或 &ldquo;GET&rdquo;)， 默认为 &ldquo;GET&rdquo;。<br>注意：其它 HTTP 请求方法，如 PUT 和 DELETE 也可以使用，但仅部分浏览器支持。<br>timeout Number 设置请求超时时间（毫秒）。此设置将覆盖全局设置。<br>async Boolean (默认: true) 默认设置下，所有请求均为异步请求。<br>如果需要发送同步请求，请将此选项设置为 false。<br>注意，同步请求将锁住浏览器，用户其它操作必须等待请求完成才可以执行。<br>beforeSend Function 发送请求前可修改 XMLHttpRequest 对象的函数，如添加自定义 HTTP 头。</p>
<p>XMLHttpRequest 对象是唯一的参数。</p>
<p>function (XMLHttpRequest) {<br>this; // the options for this ajax request<br>}</p>
<p>&nbsp;<br>cache Boolean (默认: true) jQuery 1.2 新功能，设置为 false 将不会从浏览器缓存中加载请求信息。<br>complete Function 请求完成后回调函数 (请求成功或失败时均调用)。</p>
<p>参数： XMLHttpRequest 对象，成功信息字符串。</p>
<p>function (XMLHttpRequest, textStatus) {<br>this; // the options for this ajax request<br>}</p>
<p>&nbsp;<br>contentType String (默认: &ldquo;application/x-www-form-urlencoded&rdquo;) 发送信息至服务器时内容编码类型。默认值适合大多数应用场合。<br>data Object,<br>String 发送到服务器的数据。将自动转换为请求字符串格式。GET 请求中将附加在 URL 后。<br>查看 processData 选项说明以禁止此自动转换。必须为 Key/Value 格式。<br>如果为数组，jQuery 将自动为不同值对应同一个名称。<br>如 {foo:[“bar1”, “bar2”]} 转换为 &lsquo;&amp;foo=bar1&amp;foo=bar2&prime;。<br>dataType String 预期服务器返回的数据类型。如果不指定，jQuery 将自动根据 HTTP 包 MIME 信息<br>返回 responseXML 或 responseText，并作为回调函数参数传递，可用值: </p>
<p>&ldquo;xml&rdquo;: 返回 XML 文档，可用 jQuery 处理。</p>
<p>&ldquo;html&rdquo;: 返回纯文本 HTML 信息；包含 script 元素。</p>
<p>&ldquo;script&rdquo;: 返回纯文本 JavaScript 代码。不会自动缓存结果。</p>
<p>&ldquo;json&rdquo;: 返回 JSON 数据 。</p>
<p>&ldquo;jsonp&rdquo;: JSONP 格式。使用 JSONP 形式调用函数时，</p>
<p>如 &ldquo;myurl?callback=?&rdquo; jQuery 将自动替换 ? 为正确的函数名，以执行回调函数。<br>&nbsp;<br>error Function (默认: 自动判断 (xml 或 html)) 请求失败时将调用此方法。 </p>
<p>这个方法有三个参数：XMLHttpRequest 对象，错误信息，（可能）捕获的错误对象。</p>
<p>function (XMLHttpRequest, textStatus, errorThrown) {<br>// 通常情况下textStatus和errorThown只有其中一个有值<br>this; // the options for this ajax request<br>}</p>
<p>&nbsp;<br>global Boolean (默认: true) 是否触发全局 AJAX 事件。设置为 false 将不会触发全局 AJAX 事件， </p>
<p>如 ajaxStart 或 ajaxStop 。可用于控制不同的Ajax事件<br>&nbsp;<br>ifModified Boolean (默认: false) 仅在服务器数据改变时获取新数据。 </p>
<p>使用 HTTP 包 Last-Modified 头信息判断。<br>&nbsp;<br>processData Boolean (默认: true) 默认情况下，发送的数据将被转换为对象(技术上讲并非字符串) </p>
<p>以配合默认内容类型 &ldquo;application/x-www-form-urlencoded&rdquo;。</p>
<p>如果要发送 DOM 树信息或其它不希望转换的信息，请设置为 false。<br>&nbsp;<br>success Function 请求成功后回调函数。这个方法有两个参数：服务器返回数据，返回状态</p>
<p>function (data, textStatus) {<br>// data could be xmlDoc, jsonObj, html, text, etc…<br>this;<br>&nbsp;// the options for this ajax request<br>}</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>你 可以指定xml、script、html、json作为其数据类型，可以为beforeSend、error、sucess、complete等状态设置 处理函数，众多其它参数也可以订完完全全定义用户的Ajax体验。下面的例子中，我们用ajax()来调用一个XML文档：</p>
<p>$.ajax({<br>&nbsp;&nbsp;&nbsp; url: ‘doc.xml’,<br>&nbsp;&nbsp;&nbsp; type: ‘GET’,<br>&nbsp;&nbsp;&nbsp; dataType: ‘xml’,<br>&nbsp;&nbsp;&nbsp; timeout: 1000,<br>&nbsp;&nbsp;&nbsp; error: function(){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alert(‘Error loading XML document’);<br>&nbsp;&nbsp;&nbsp; },<br>&nbsp;&nbsp;&nbsp; success: function(xml){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alert(xml);<br>&nbsp; //此处xml就是XML的jQuery对象了，你可以用find()、next()或XPath等方法在里面寻找节点，<br>和用jQuery操作HTML对象没有区别<br>&nbsp;&nbsp;&nbsp; }<br>});</p>
<p>进一步了解AJAX事件<br>前面讨论的一些方法都有自己的事件处理机制，从页面整体来说，都只能说是局部函数。jQuery提供了AJAX全局函数的定义，以满足特殊的需求。下面是jQuery提供的所有函数（按照触发顺序排列如下）：</p>
<p>ajaxStart<br>(全局事件) 开始新的Ajax请求，并且此时没有其他ajax请求正在进行<br>beforeSend<br>(局部事件) 当一个Ajax请求开始时触发。如果需要，你可以在这里设置XMLHttpRequest对象<br>ajaxSend<br>(全局事件) 请求开始前触发的全局事件<br>success<br>(局部事件) 请求成功时触发。即服务器没有返回错误，返回的数据也没有错误<br>ajaxSuccess<br>全局事件全局的请求成功<br>error<br>(局部事件) 仅当发生错误时触发。你无法同时执行success和error两个回调函数<br>ajaxError<br>全局事件全局的发生错误时触发<br>complete<br>(局部事件) 不管你请求成功还是失败，即便是同步请求，你都能在请求完成时触发这个事件<br>ajaxComplete<br>全局事件全局的请求完成时触发<br>ajaxStop<br>(全局事件) 当没有Ajax正在进行中的时候，触发<br>局部事件在之前的函数中都有介绍，我们主要来看看全局事件。对某个对象进行全局事件监听，那么全局中的AJAX动作，都会对其产生影响。比如，当页面在进行AJAX操作时，ID为&rdquo;loading&rdquo;的DIV就显示出来：</p>
<p>&nbsp;<br>$(“#loading”).ajaxStart(function(){<br>&nbsp;&nbsp; $(this).show();<br>&nbsp;});</p>
<p>&nbsp;</p>
<p>全局事件也可以帮助你编写全局的错误相应和成功相应，而不需要为每个AJAX请求独立设置。有必要指出，全局事件的参数是很有用的。除了 ajaxStart、ajaxOptions，其他事件均有event, XMLHttpRequest, ajaxOptions三个参数。第一个参数即事件本身；第二个是XHR对象；第三个是你传递的ajax参数对象。在一个对象里显示全局的AJAX情况：</p>
<p>$(“#msg”).beforeSend(function(e,xhr,o) {<br>&nbsp;$(this).html(“正在请求”+o.url);<br>&nbsp;}).ajaxSuccess(function(e,xhr,o) {<br>&nbsp;$(this).html(o.url+”请求成功”);<br>&nbsp;}).ajaxError(function(e,xhr,o) {<br>&nbsp;$(this).html(o.url+”请求失败”);<br>});</p>
<p>&nbsp;</p>
<p>很显然，第三个参数也可以帮助你传递你在AJAX事件里加入的自定义参数。 在单个AJAX请求时，你可以将global的值设为false，以将此请求独立于AJAX的全局事件。</p>
<p>&nbsp;<br>$.ajax({<br>&nbsp;&nbsp; url: “request.jsp”,<br>&nbsp;&nbsp; global: false,<br>&nbsp;&nbsp; // 禁用全局Ajax事件.<br>&nbsp;});</p>
<p>&nbsp;</p>
<p>如果你想为全局AJAX设置参数，你会用上ajaxSetup()函数。例如，将所有AJAX请求都传递到request.php，；禁用全局方法；强制用POST方法传递：</p>
<p>$.ajaxSetup({<br>&nbsp; url: “request.jsp”,<br>&nbsp; global: false,<br>&nbsp; type: “POST”<br>});</p>
<p>&nbsp;</p>
<p>一些你不得不知道的方法<br>写AJAX肯定离不开从页面获取相应的值。在这里简单列举一些方法：</p>
<p>val()<br>val()函数可以返回表单组建的值，例如任何种类input的值。配合选择符操作，你可以轻易获取选项组、输入框、按钮等元素的值。</p>
<p>$(“input[name=’info’]:text”).val();<br>//返回名字为info的文本框的值<br>$(“input[name=’pass’]:password”).val();<br>//返回名字为pass的密码框的值<br>$(“input[name=’save’]:radio”).val();<br>//返回名字为save的单选项的值<br>//以此类推</p>
<p>&nbsp;</p>
<p>serialize()</p>
<p>serialize函数可以帮你把表单对象的所有值都转换为字符串序列。如果你要写GET格式的请求，这个就非常方便了。<br>serializeArray()<br>和serialize()类似，只不过它返回的是JSON对象。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuling07.github.io/2013/02/jquery-ajax.html" data-id="ciiy5f4th006zq1d03n5fo9wt" class="article-share-link">Share</a>
      
        <a href="http://liuling07.github.io/2013/02/jquery-ajax.html#ds-thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-net-sf-json-jsonexception" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/02/net-sf-json-jsonexception.html">net.sf.json.JSONException: There is a cycle in the hierarchy!错误解决方案</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2013/02/net-sf-json-jsonexception.html">
      <time datetime="2013-02-07T00:22:00.000Z" itemprop="datePublished">2013-02-07</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/后端/">后端</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>　　使用hibernate容易出现该问题，主要是由于pojo类属性存在级联关系。比如说员工和部门，在员工表里面有部门属性，而在部门表里面有个员工集合，这样就存在了嵌套引用的问题了，就会抛出这个异常。</p>
<p>　　解决方法很简单，在将每个对象转为json对象的时候用setExcludes函数将级联的属性去除掉就可以了，如下面：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #008000;">//</span><span style="color: #008000;">得到所有部门<br></span><span style="color: #008080;"> 2</span>     <span style="color: #008000;">//</span><span style="color: #008000;">返回json对象字符串</span><br><span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String getAllDep(){<br></span><span style="color: #008080;"> 4</span>         List list =<span style="color: #000000;"> deptDAO.findAll();<br></span><span style="color: #008080;"> 5</span>         JsonConfig config = <span style="color: #0000ff;">new</span><span style="color: #000000;"> JsonConfig();<br></span><span style="color: #008080;"> 6</span>         config.setExcludes(<span style="color: #0000ff;">new</span> String[]{“emps”});<span style="color: #008000;">//</span><span style="color: #008000;">除去emps属性</span><br><span style="color: #008080;"> 7</span>         String json =<span style="color: #000000;"> JSONArray.fromObject(list, config).toString();<br></span><span style="color: #008080;"> 8</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> json;<br></span><span style="color: #008080;"> 9</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">10</span><br><span style="color: #008080;">11</span>     <span style="color: #008000;">//</span><span style="color: #008000;">得到所有员工</span><br><span style="color: #008080;">12</span>     <span style="color: #0000ff;">public</span> String getAllEmp(<span style="color: #0000ff;">int</span><span style="color: #000000;"> id){<br></span><span style="color: #008080;">13</span>         List list = empDAO.findByProperty(“dept.deptId”<span style="color: #000000;">, id);<br></span><span style="color: #008080;">14</span>         JsonConfig config = <span style="color: #0000ff;">new</span><span style="color: #000000;"> JsonConfig();<br></span><span style="color: #008080;">15</span>         config.setExcludes(<span style="color: #0000ff;">new</span> String[]{“dept”});<span style="color: #008000;">//</span><span style="color: #008000;">除去dept属性</span><br><span style="color: #008080;">16</span>         String json =<span style="color: #000000;"> JSONArray.fromObject(list, config).toString();<br></span><span style="color: #008080;">17</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> json;<br></span><span style="color: #008080;">18</span>     }</pre><br></div>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p>异常代码如下：</p>
<div class="cnblogs_code"><br><pre>严重: Servlet.service() <span style="color: #0000ff;">for</span><span style="color: #000000;"> servlet springMVC threw exception<br>net.sf.json.JSONException: There is a cycle in the hierarchy</span>!<span style="color: #000000;"><br>    at net.sf.json.util.CycleDetectionStrategy$StrictCycleDetectionStrategy.handleRepeatedReferenceAsObject(CycleDetectionStrategy.java:</span>97<span style="color: #000000;">)<br>    at net.sf.json.JSONObject._fromBean(JSONObject.java:</span>857<span style="color: #000000;">)<br>    at net.sf.json.JSONObject.fromObject(JSONObject.java:</span>192<span style="color: #000000;">)<br>    at net.sf.json.JSONObject._processValue(JSONObject.java:</span>2774<span style="color: #000000;">)<br>    at net.sf.json.JSONObject._setInternal(JSONObject.java:</span>2798<span style="color: #000000;">)<br>    at net.sf.json.JSONObject.setValue(JSONObject.java:</span>1507<span style="color: #000000;">)<br>    at net.sf.json.JSONObject._fromBean(JSONObject.java:</span>940<span style="color: #000000;">)<br>    at net.sf.json.JSONObject.fromObject(JSONObject.java:</span>192<span style="color: #000000;">)<br>    at net.sf.json.JSONArray._processValue(JSONArray.java:</span>2557<span style="color: #000000;">)<br>    at net.sf.json.JSONArray.processValue(JSONArray.java:</span>2588<span style="color: #000000;">)<br>    at net.sf.json.JSONArray.addValue(JSONArray.java:</span>2575<span style="color: #000000;">)<br>    at net.sf.json.JSONArray._fromCollection(JSONArray.java:</span>1082<span style="color: #000000;">)<br>    at net.sf.json.JSONArray.fromObject(JSONArray.java:</span>145<span style="color: #000000;">)<br>    at net.sf.json.JSONObject._processValue(JSONObject.java:</span>2749<span style="color: #000000;">)<br>    at net.sf.json.JSONObject._setInternal(JSONObject.java:</span>2798<span style="color: #000000;">)<br>    at net.sf.json.JSONObject.setValue(JSONObject.java:</span>1507<span style="color: #000000;">)<br>    at net.sf.json.JSONObject._fromBean(JSONObject.java:</span>940<span style="color: #000000;">)<br>    at net.sf.json.JSONObject.fromObject(JSONObject.java:</span>192<span style="color: #000000;">)<br>    at net.sf.json.JSONArray._processValue(JSONArray.java:</span>2557<span style="color: #000000;">)<br>    at net.sf.json.JSONArray.processValue(JSONArray.java:</span>2588<span style="color: #000000;">)<br>    at net.sf.json.JSONArray.addValue(JSONArray.java:</span>2575<span style="color: #000000;">)<br>    at net.sf.json.JSONArray._fromCollection(JSONArray.java:</span>1082<span style="color: #000000;">)<br>    at net.sf.json.JSONArray.fromObject(JSONArray.java:</span>145<span style="color: #000000;">)<br>    at com.service.EmpService.getAllDep(EmpService.java:</span>31<span style="color: #000000;">)<br>    at com.service.EmpService$$FastClassByCGLIB$$fef4bb53.invoke(</span><generated><span style="color: #000000;">)<br>    at net.sf.cglib.proxy.MethodProxy.invoke(MethodProxy.java:</span>149<span style="color: #000000;">)<br>    at org.springframework.aop.framework.Cglib2AopProxy$CglibMethodInvocation.invokeJoinpoint(Cglib2AopProxy.java:</span>700<span style="color: #000000;">)<br>    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:</span>149<span style="color: #000000;">)<br>    at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:</span>106<span style="color: #000000;">)<br>    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:</span>171<span style="color: #000000;">)<br>    at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:</span>89<span style="color: #000000;">)<br>    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:</span>171<span style="color: #000000;">)<br>    at org.springframework.aop.framework.Cglib2AopProxy$DynamicAdvisedInterceptor.intercept(Cglib2AopProxy.java:</span>635<span style="color: #000000;">)<br>    at com.service.EmpService$$EnhancerByCGLIB$$8fce1d77.getAllDep(</span><generated><span style="color: #000000;">)<br>    at com.action.DepAction.getAllDept(DepAction.java:</span>22<span style="color: #000000;">)<br>    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br>    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:</span>57<span style="color: #000000;">)<br>    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:</span>43<span style="color: #000000;">)<br>    at java.lang.reflect.Method.invoke(Method.java:</span>601<span style="color: #000000;">)<br>    at org.springframework.web.bind.annotation.support.HandlerMethodInvoker.doInvokeMethod(HandlerMethodInvoker.java:</span>413<span style="color: #000000;">)<br>    at org.springframework.web.bind.annotation.support.HandlerMethodInvoker.invokeHandlerMethod(HandlerMethodInvoker.java:</span>134<span style="color: #000000;">)<br>    at org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.invokeHandlerMethod(AnnotationMethodHandlerAdapter.java:</span>310<span style="color: #000000;">)<br>    at org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.handle(AnnotationMethodHandlerAdapter.java:</span>297<span style="color: #000000;">)<br>    at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:</span>875<span style="color: #000000;">)<br>    at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:</span>809<span style="color: #000000;">)<br>    at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:</span>571<span style="color: #000000;">)<br>    at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:</span>501<span style="color: #000000;">)<br>    at javax.servlet.http.HttpServlet.service(HttpServlet.java:</span>690<span style="color: #000000;">)<br>    at javax.servlet.http.HttpServlet.service(HttpServlet.java:</span>803<span style="color: #000000;">)<br>    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:</span>290<span style="color: #000000;">)<br>    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:</span>206<span style="color: #000000;">)<br>    at org.springframework.orm.hibernate3.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:</span>198<span style="color: #000000;">)<br>    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:</span>76<span style="color: #000000;">)<br>    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:</span>235<span style="color: #000000;">)<br>    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:</span>206<span style="color: #000000;">)<br>    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:</span>230<span style="color: #000000;">)<br>    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:</span>175<span style="color: #000000;">)<br>    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:</span>128<span style="color: #000000;">)<br>    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:</span>104<span style="color: #000000;">)<br>    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:</span>109<span style="color: #000000;">)<br>    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:</span>261<span style="color: #000000;">)<br>    at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:</span>844<span style="color: #000000;">)<br>    at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:</span>581<span style="color: #000000;">)<br>    at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:</span>447<span style="color: #000000;">)<br>    at java.lang.Thread.run(Thread.java:</span>722)</generated></generated></pre><br></div>

<p>&nbsp;</p>
<p>&nbsp;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuling07.github.io/2013/02/net-sf-json-jsonexception.html" data-id="ciiy5f4rw004sq1d0zrdisncw" class="article-share-link">Share</a>
      
        <a href="http://liuling07.github.io/2013/02/net-sf-json-jsonexception.html#ds-thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web后端/">web后端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/解决方案/">解决方案</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-springmvc-use" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/02/springmvc-use.html">使用springMVC的详细步骤</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2013/02/springmvc-use.html">
      <time datetime="2013-02-06T20:27:00.000Z" itemprop="datePublished">2013-02-07</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/后端/">后端</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>　　使用springMVC也可以代替struts2，当然只是代替业务分发的功能，struts2的一些其他功能它是没有的，不然要struts2有什么用。<br>　　下面我用springMVC代替struts2去整合hibernate实现简单的员工查询功能。<br>　　使用springMVC有两个配置文件需要配置，一个是applicationContext.xml、另一个是web.xml，在applicationContext.xml里面配置事务管理器以及属性注入等。web.xml里面要添加一个springMVC的servlet的注册和映射(DispatcherServlet)，这个servlet是springMVC的核心控制器，专门处理各个请求的，然后根据相应的参数分发给相应的业务控制器处理，业务控制器处理完之后就会返回一字符串给核心控制器，核心控制器再根据该字符串重定向或者转发到相应的页面。还必须给该核心控制器建一个配置文件，其形式为：核心控制器servlet名-servlet.xml,如springMVC-servlet.xml.该配置文件放在WEB-INF下面。<br>&nbsp;applicationContext.xml的内容如下：</p>
<div class="cnblogs_code"><br><pre><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version=”1.0” encoding=”UTF-8”</span><span style="color: #0000ff;">?&gt;</span><br><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">beans </span><span style="color: #ff0000;">xmlns</span><span style="color: #0000ff;">=”<a href="http://www.springframework.org/schema/beans" target="_blank" rel="external">http://www.springframework.org/schema/beans</a>“</span><span style="color: #ff0000;"><br>    xmlns:xsi</span><span style="color: #0000ff;">=”<a href="http://www.w3.org/2001/XMLSchema-instance" target="_blank" rel="external">http://www.w3.org/2001/XMLSchema-instance</a>“</span><span style="color: #ff0000;"><br>    xmlns:util</span><span style="color: #0000ff;">=”<a href="http://www.springframework.org/schema/util" target="_blank" rel="external">http://www.springframework.org/schema/util</a>“</span><span style="color: #ff0000;"><br>    xmlns:p</span><span style="color: #0000ff;">=”<a href="http://www.springframework.org/schema/p" target="_blank" rel="external">http://www.springframework.org/schema/p</a>“</span><span style="color: #ff0000;"><br>    xmlns:aop</span><span style="color: #0000ff;">=”<a href="http://www.springframework.org/schema/aop" target="_blank" rel="external">http://www.springframework.org/schema/aop</a>“</span><span style="color: #ff0000;"><br>    xmlns:tx</span><span style="color: #0000ff;">=”<a href="http://www.springframework.org/schema/tx" target="_blank" rel="external">http://www.springframework.org/schema/tx</a>“</span><span style="color: #ff0000;"><br>    xmlns:context</span><span style="color: #0000ff;">=”<a href="http://www.springframework.org/schema/context" target="_blank" rel="external">http://www.springframework.org/schema/context</a>“</span><span style="color: #ff0000;"><br>    xsi:schemaLocation</span><span style="color: #0000ff;">=”<br>    <a href="http://www.springframework.org/schema/beans" target="_blank" rel="external">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans-2.0.xsd" target="_blank" rel="external">http://www.springframework.org/schema/beans/spring-beans-2.0.xsd</a><br>    <a href="http://www.springframework.org/schema/util" target="_blank" rel="external">http://www.springframework.org/schema/util</a> <a href="http://www.springframework.org/schema/util/spring-util-2.0.xsd" target="_blank" rel="external">http://www.springframework.org/schema/util/spring-util-2.0.xsd</a><br>    <a href="http://www.springframework.org/schema/tx" target="_blank" rel="external">http://www.springframework.org/schema/tx</a> <a href="http://www.springframework.org/schema/tx/spring-tx-2.0.xsd" target="_blank" rel="external">http://www.springframework.org/schema/tx/spring-tx-2.0.xsd</a><br>    <a href="http://www.springframework.org/schema/aop" target="_blank" rel="external">http://www.springframework.org/schema/aop</a> <a href="http://www.springframework.org/schema/aop/spring-aop-2.0.xsd" target="_blank" rel="external">http://www.springframework.org/schema/aop/spring-aop-2.0.xsd</a><br>      <a href="http://www.springframework.org/schema/context" target="_blank" rel="external">http://www.springframework.org/schema/context</a><br>    <a href="http://www.springframework.org/schema/context/spring-context-2.5.xsd" target="_blank" rel="external">http://www.springframework.org/schema/context/spring-context-2.5.xsd</a>“</span><span style="color: #0000ff;">&gt;</span><br><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”sessionFactory”</span><span style="color: #ff0000;"><br>        class</span><span style="color: #0000ff;">=”org.springframework.orm.hibernate3.LocalSessionFactoryBean”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”configLocation”</span><span style="color: #ff0000;"><br>            value</span><span style="color: #0000ff;">=”classpath:hibernate.cfg.xml”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span><br><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”DeptDAO”</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">=”com.dao.DeptDAO”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”sessionFactory”</span><span style="color: #0000ff;">&gt;</span><br>            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">ref </span><span style="color: #ff0000;">bean</span><span style="color: #0000ff;">=”sessionFactory”</span> <span style="color: #0000ff;">/&gt;</span><br>        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”EmpDAO”</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">=”com.dao.EmpDAO”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”sessionFactory”</span><span style="color: #0000ff;">&gt;</span><br>            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">ref </span><span style="color: #ff0000;">bean</span><span style="color: #0000ff;">=”sessionFactory”</span> <span style="color: #0000ff;">/&gt;</span><br>        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”empService”</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">=”com.service.EmpService”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”deptDAO”</span><span style="color: #ff0000;"> ref</span><span style="color: #0000ff;">=”DeptDAO”</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”empDAO”</span><span style="color: #ff0000;"> ref</span><span style="color: #0000ff;">=”EmpDAO”</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span><br><br>    <span style="color: #008000;"><!--</span><span style="color: #008000;"> 事务管理器 </span><span style="color: #008000;">--></span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">bean </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”transactionManager”</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">=”org.springframework.orm.hibernate3.HibernateTransactionManager”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”sessionFactory”</span><span style="color: #ff0000;"> ref</span><span style="color: #0000ff;">=”sessionFactory”</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">property</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">bean</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #008000;"><!--</span><span style="color: #008000;"> 事务属性 </span><span style="color: #008000;">--></span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">tx:advice </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”mytx”</span><span style="color: #ff0000;"> transaction-manager</span><span style="color: #0000ff;">=”transactionManager”</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">tx:attributes</span><span style="color: #0000ff;">&gt;</span><br>            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">tx:method </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”<em>“</em></span><span style="color: #0000ff;">/&gt;</span><br>        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">tx:attributes</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">tx:advice</span><span style="color: #0000ff;">&gt;</span><br>    <span style="color: #008000;"><!--</span><span style="color: #008000;"> 织入 </span><span style="color: #008000;">--></span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">aop:config</span><span style="color: #0000ff;">&gt;</span><br>        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">aop:advisor </span><span style="color: #ff0000;">advice-ref</span><span style="color: #0000ff;">=”mytx”</span><span style="color: #ff0000;"> pointcut</span><span style="color: #0000ff;">=”execution( com.service.<em>.</em>(..))”</span><span style="color: #0000ff;">/&gt;</span><br>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">aop:config</span><span style="color: #0000ff;">&gt;</span><br><br><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">beans</span><span style="color: #0000ff;">&gt;</span></pre><br></div>

<p>web.xml的内容如下：</p>
<div class="cnblogs_code"><br><pre><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version=”1.0” encoding=”UTF-8”</span><span style="color: #0000ff;">?&gt;</span><br><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">web-app </span><span style="color: #ff0000;">version</span><span style="color: #0000ff;">=”2.5”</span><span style="color: #ff0000;"> xmlns</span><span style="color: #0000ff;">=”<a href="http://java.sun.com/xml/ns/javaee" target="_blank" rel="external">http://java.sun.com/xml/ns/javaee</a>“</span><span style="color: #ff0000;"><br> xmlns:xsi</span><span style="color: #0000ff;">=”<a href="http://www.w3.org/2001/XMLSchema-instance" target="_blank" rel="external">http://www.w3.org/2001/XMLSchema-instance</a>“</span><span style="color: #ff0000;"> xsi:schemaLocation</span><span style="color: #0000ff;">=”<a href="http://java.sun.com/xml/ns/javaee" target="_blank" rel="external">http://java.sun.com/xml/ns/javaee</a>   <a href="http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" target="_blank" rel="external">http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd</a>“</span><span style="color: #0000ff;">&gt;</span><br> <span style="color: #008000;"><!--</span><span style="color: #008000;"> 指定另一个配置的路径 </span><span style="color: #008000;">--></span><br> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">context-param</span><span style="color: #0000ff;">&gt;</span><br>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">param-name</span><span style="color: #0000ff;">&gt;</span>contextConfigLocation<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">param-name</span><span style="color: #0000ff;">&gt;</span><br>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">param-value</span><span style="color: #0000ff;">&gt;</span>/WEB-INF/classes/app<em>.xml<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">param-value</span><span style="color: #0000ff;">&gt;</span><br> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">context-param</span><span style="color: #0000ff;">&gt;</span><br> <span style="color: #008000;"><!--</span><span style="color: #008000;"> 控制session开关的过滤器 </span><span style="color: #008000;">--></span><br> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">filter</span><span style="color: #0000ff;">&gt;</span><br>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">filter-name</span><span style="color: #0000ff;">&gt;</span>openSession<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">filter-name</span><span style="color: #0000ff;">&gt;</span><br>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">filter-class</span><span style="color: #0000ff;">&gt;</span>org.springframework.orm.hibernate3.support.OpenSessionInViewFilter<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">filter-class</span><span style="color: #0000ff;">&gt;</span><br> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">filter</span><span style="color: #0000ff;">&gt;</span><br> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">filter-mapping</span><span style="color: #0000ff;">&gt;</span><br>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">filter-name</span><span style="color: #0000ff;">&gt;</span>openSession<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">filter-name</span><span style="color: #0000ff;">&gt;</span><br>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">url-pattern</span><span style="color: #0000ff;">&gt;</span>/</em><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">url-pattern</span><span style="color: #0000ff;">&gt;</span><br> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">filter-mapping</span><span style="color: #0000ff;">&gt;</span><br> <span style="color: #008000;"><!--</span><span style="color: #008000;"> 加载applicationContext.xml </span><span style="color: #008000;">--></span><br> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">listener</span><span style="color: #0000ff;">&gt;</span><br>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">listener-class</span><span style="color: #0000ff;">&gt;</span>org.springframework.web.context.ContextLoaderListener<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">listener-class</span><span style="color: #0000ff;">&gt;</span><br> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">listener</span><span style="color: #0000ff;">&gt;</span><br> <span style="color: #008000;"><!--</span><span style="color: #008000;"> springMVC 注册和映射 </span><span style="color: #008000;">--></span><br> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet</span><span style="color: #0000ff;">&gt;</span><br>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet-name</span><span style="color: #0000ff;">&gt;</span>springMVC<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet-name</span><span style="color: #0000ff;">&gt;</span><br>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet-class</span><span style="color: #0000ff;">&gt;</span>org.springframework.web.servlet.DispatcherServlet<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet-class</span><span style="color: #0000ff;">&gt;</span><br> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet</span><span style="color: #0000ff;">&gt;</span><br> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet-mapping</span><span style="color: #0000ff;">&gt;</span><br>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">servlet-name</span><span style="color: #0000ff;">&gt;</span>springMVC<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet-name</span><span style="color: #0000ff;">&gt;</span><br>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">url-pattern</span><span style="color: #0000ff;">&gt;</span>*.do<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">url-pattern</span><span style="color: #0000ff;">&gt;</span><br> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">servlet-mapping</span><span style="color: #0000ff;">&gt;</span><br> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">welcome-file-list</span><span style="color: #0000ff;">&gt;</span><br>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span>index.jsp<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">welcome-file</span><span style="color: #0000ff;">&gt;</span><br> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">welcome-file-list</span><span style="color: #0000ff;">&gt;</span><br> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">login-config</span><span style="color: #0000ff;">&gt;</span><br>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">auth-method</span><span style="color: #0000ff;">&gt;</span>BASIC<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">auth-method</span><span style="color: #0000ff;">&gt;</span><br> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">login-config</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">web-app</span><span style="color: #0000ff;">&gt;</span></pre><br></div>

<p>springMVC-servlet.xml的内容如下：</p>
<div class="cnblogs_code"><br><pre><span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version=”1.0” encoding=”UTF-8”</span><span style="color: #0000ff;">?&gt;</span><br><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">beans </span><span style="color: #ff0000;">xmlns</span><span style="color: #0000ff;">=”<a href="http://www.springframework.org/schema/beans" target="_blank" rel="external">http://www.springframework.org/schema/beans</a>“</span><span style="color: #ff0000;"><br>    xmlns:xsi</span><span style="color: #0000ff;">=”<a href="http://www.w3.org/2001/XMLSchema-instance" target="_blank" rel="external">http://www.w3.org/2001/XMLSchema-instance</a>“</span><span style="color: #ff0000;"><br>    xmlns:util</span><span style="color: #0000ff;">=”<a href="http://www.springframework.org/schema/util" target="_blank" rel="external">http://www.springframework.org/schema/util</a>“</span><span style="color: #ff0000;"><br>    xmlns:p</span><span style="color: #0000ff;">=”<a href="http://www.springframework.org/schema/p" target="_blank" rel="external">http://www.springframework.org/schema/p</a>“</span><span style="color: #ff0000;"><br>    xmlns:aop</span><span style="color: #0000ff;">=”<a href="http://www.springframework.org/schema/aop" target="_blank" rel="external">http://www.springframework.org/schema/aop</a>“</span><span style="color: #ff0000;"><br>    xmlns:tx</span><span style="color: #0000ff;">=”<a href="http://www.springframework.org/schema/tx" target="_blank" rel="external">http://www.springframework.org/schema/tx</a>“</span><span style="color: #ff0000;"><br>    xmlns:context</span><span style="color: #0000ff;">=”<a href="http://www.springframework.org/schema/context" target="_blank" rel="external">http://www.springframework.org/schema/context</a>“</span><span style="color: #ff0000;"><br>    xsi:schemaLocation</span><span style="color: #0000ff;">=”<br>    <a href="http://www.springframework.org/schema/beans" target="_blank" rel="external">http://www.springframework.org/schema/beans</a> <a href="http://www.springframework.org/schema/beans/spring-beans-2.0.xsd" target="_blank" rel="external">http://www.springframework.org/schema/beans/spring-beans-2.0.xsd</a><br>    <a href="http://www.springframework.org/schema/util" target="_blank" rel="external">http://www.springframework.org/schema/util</a> <a href="http://www.springframework.org/schema/util/spring-util-2.0.xsd" target="_blank" rel="external">http://www.springframework.org/schema/util/spring-util-2.0.xsd</a><br>    <a href="http://www.springframework.org/schema/tx" target="_blank" rel="external">http://www.springframework.org/schema/tx</a> <a href="http://www.springframework.org/schema/tx/spring-tx-2.0.xsd" target="_blank" rel="external">http://www.springframework.org/schema/tx/spring-tx-2.0.xsd</a><br>    <a href="http://www.springframework.org/schema/aop" target="_blank" rel="external">http://www.springframework.org/schema/aop</a> <a href="http://www.springframework.org/schema/aop/spring-aop-2.0.xsd" target="_blank" rel="external">http://www.springframework.org/schema/aop/spring-aop-2.0.xsd</a><br>      <a href="http://www.springframework.org/schema/context" target="_blank" rel="external">http://www.springframework.org/schema/context</a><br>    <a href="http://www.springframework.org/schema/context/spring-context-2.5.xsd" target="_blank" rel="external">http://www.springframework.org/schema/context/spring-context-2.5.xsd</a>“</span><span style="color: #0000ff;">&gt;</span><br><br>    <span style="color: #008000;"><!--</span><span style="color: #008000;"> 指定自动扫描路径 </span><span style="color: #008000;">--></span><br>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">context:component-scan </span><span style="color: #ff0000;">base-package</span><span style="color: #0000ff;">=”com.action”</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">context:component-scan</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">beans</span><span style="color: #0000ff;">&gt;</span> </pre><br></div>

<p>EmpAction类代码如下：</p>
<div class="cnblogs_code"><br><pre><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.action;<br><br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;<br><br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletRequest;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletResponse;<br><br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.beans.factory.annotation.Autowired;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.stereotype.Controller;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.bind.annotation.RequestMapping;<br><br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.service.EmpService;<br><br>@Controller<br>@RequestMapping(</span>“/emp.do”<span style="color: #000000;">)<br></span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> EmpAction {<br>    @Autowired<br>    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> EmpService empService;<br><br>    @RequestMapping(params</span>=”p=getAll”<span style="color: #000000;">)<br>    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> String getAll(HttpServletRequest request,HttpServletResponse response){<br>        List list </span>=<span style="color: #000000;"> empService.getAllEmp();<br>        request.setAttribute(</span>“list”<span style="color: #000000;">, list);<br>        </span><span style="color: #0000ff;">return</span> “/WEB-INF/view/show.jsp”<span style="color: #000000;">;<br>    }<br><br>}</span></pre><br></div>

<p>@Controller指该方法是一个业务控制器；@RequestMapping(“/emp.do”)是指请求emp.do则核心控制器就会分发给该业务控制器去处理；<br>@RequestMapping(params=”p=getAll”)是指当请求参数为p=getAll时调用业务控制器的这个方法;将”/WEB-INF/view/show.jsp”返回给核心控制器，核心控制器再转发到WEB-INF/view/show.jsp页面去显示所有员工信息。</p>
<p>springMVC与struts2的区别：<br>1. 机制：spring mvc的入口是servlet，而struts2是filter，这样就导致了二者的机制不同。 </p>
<p>2. 性能：spring会稍微比struts快。spring mvc是基于方法的设计，而sturts是基于类，每次发一次请求都会实例一个action，每个action都会被注入属性，而spring基于方法，粒度更细，但要小心把握像在servlet控制数据一样。spring3 mvc是方法级别的拦截，拦截到方法后根据参数上的注解，把request数据注入进去，在spring3 mvc中，一个方法对应一个request上下文。而struts2框架是类级别的拦截，每次来了请求就创建一个Action，然后调用setter getter方法把request中的数据注入；struts2实际上是通过setter getter方法与request打交道的；struts2中，一个Action对象对应一个request上下文。 </p>
<p>3. 参数传递：struts是在接受参数的时候，可以用属性来接受参数，这就说明参数是让多个方法共享的。 </p>
<p>4. 设计思想上：struts更加符合oop的编程思想， spring就比较谨慎，在servlet上扩展。 </p>
<p>5. intercepter的实现机制：struts有以自己的interceptor机制，spring mvc用的是独立的AOP方式。这样导致struts的配置文件量还是比spring mvc大，虽然struts的配置能继承，所以我觉得论使用上来讲，spring mvc使用更加简洁，开发效率Spring MVC确实比struts2高。spring mvc是方法级别的拦截，一个方法对应一个request上下文，而方法同时又跟一个url对应，所以说从架构本身上spring3 mvc就容易实现restful url。struts2是类级别的拦截，一个类对应一个request上下文；实现restful url要费劲，因为struts2 action的一个方法可以对应一个url；而其类属性却被所有方法共享，这也就无法用注解或其他方式标识其所属方法了。spring3 mvc的方法之间基本上独立的，独享request response数据，请求数据通过参数获取，处理结果通过ModelMap交回给框架方法之间不共享变量，而struts2搞的就比较乱，虽然方法之间也是独立的，但其所有Action变量是共享的，这不会影响程序运行，却给我们编码，读程序时带来麻烦。 </p>
<p>6. 另外，spring3 mvc的验证也是一个亮点，支持JSR303，处理ajax的请求更是方便，只需一个注解@ResponseBody ，然后直接返回响应文本即可。 </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuling07.github.io/2013/02/springmvc-use.html" data-id="ciiy5f4pm001aq1d0pcozok15" class="article-share-link">Share</a>
      
        <a href="http://liuling07.github.io/2013/02/springmvc-use.html#ds-thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web后端/">web后端</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-nosuchmethoderror-asm" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/02/nosuchmethoderror-asm.html">java.lang.NoSuchMethodError: org.objectweb.asm.ClassVisitor.visit(IILjava/lang/String;Ljava/lang/String;[Ljava/lang/String;Ljava/lang/String;)V错误解决方案</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2013/02/nosuchmethoderror-asm.html">
      <time datetime="2013-02-06T19:43:00.000Z" itemprop="datePublished">2013-02-07</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/后端/">后端</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>解决方案：</p>
<p>　　java.lang.NoSuchMethodError: org.objectweb.asm.ClassVisitor.visit(IILjava/lang/String;Ljava/lang/String;[Ljava/lang/String;Ljava/lang/String;)V错误是hibernate+spring的一个金典的错误。这个问题主要是由于spring与hibernate导jar包的冲突问题，只要将asm-2.2.3.jar包给删掉就可以了。</p>
<p>详细错误信息如下：</p>
<div class="cnblogs_code"><br><pre><span style="color: #800080;">2013</span>-<span style="color: #800080;">02</span>-<span style="color: #800080;">07</span> <span style="color: #800080;">11</span>:<span style="color: #800080;">27</span>:<span style="color: #800080;">45</span><span style="color: #000000;">  Context initialization failed<br>org.springframework.beans.factory.BeanCreationException: Error creating bean with name </span><span style="color: #800000;">‘</span><span style="color: #800000;">sessionFactory</span><span style="color: #800000;">‘</span> defined <span style="color: #0000ff;">in</span> ServletContext resource [/WEB-INF/classes/applicationContext.xml]: Invocation of init method failed; nested exception <span style="color: #0000ff;">is</span> java.lang.NoSuchMethodError: org.objectweb.asm.ClassVisitor.visit(IILjava/lang/String;Ljava/lang/String;[Ljava/lang/String;Ljava/lang/<span style="color: #000000;">String;)V<br>    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:</span><span style="color: #800080;">1336</span><span style="color: #000000;">)<br>    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:</span><span style="color: #800080;">471</span><span style="color: #000000;">)<br>    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory$</span><span style="color: #800080;">1</span>.run(AbstractAutowireCapableBeanFactory.java:<span style="color: #800080;">409</span><span style="color: #000000;">)<br>    at java.security.AccessController.doPrivileged(Native Method)<br>    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:</span><span style="color: #800080;">380</span><span style="color: #000000;">)<br>    at org.springframework.beans.factory.support.AbstractBeanFactory$</span><span style="color: #800080;">1</span>.getObject(AbstractBeanFactory.java:<span style="color: #800080;">264</span><span style="color: #000000;">)<br>    at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:</span><span style="color: #800080;">220</span><span style="color: #000000;">)<br>    at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:</span><span style="color: #800080;">261</span><span style="color: #000000;">)<br>    at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:</span><span style="color: #800080;">185</span><span style="color: #000000;">)<br>    at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:</span><span style="color: #800080;">164</span><span style="color: #000000;">)<br>    at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:</span><span style="color: #800080;">423</span><span style="color: #000000;">)<br>    at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:</span><span style="color: #800080;">729</span><span style="color: #000000;">)<br>    at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:</span><span style="color: #800080;">381</span><span style="color: #000000;">)<br>    at org.springframework.web.context.ContextLoader.createWebApplicationContext(ContextLoader.java:</span><span style="color: #800080;">255</span><span style="color: #000000;">)<br>    at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:</span><span style="color: #800080;">199</span><span style="color: #000000;">)<br>    at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:</span><span style="color: #800080;">45</span><span style="color: #000000;">)<br>    at org.apache.catalina.core.StandardContext.listenerStart(StandardContext.java:</span><span style="color: #800080;">3827</span><span style="color: #000000;">)<br>    at org.apache.catalina.core.StandardContext.start(StandardContext.java:</span><span style="color: #800080;">4334</span><span style="color: #000000;">)<br>    at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:</span><span style="color: #800080;">791</span><span style="color: #000000;">)<br>    at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:</span><span style="color: #800080;">771</span><span style="color: #000000;">)<br>    at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:</span><span style="color: #800080;">525</span><span style="color: #000000;">)<br>    at org.apache.catalina.startup.HostConfig.deployDirectory(HostConfig.java:</span><span style="color: #800080;">920</span><span style="color: #000000;">)<br>    at org.apache.catalina.startup.HostConfig.deployDirectories(HostConfig.java:</span><span style="color: #800080;">883</span><span style="color: #000000;">)<br>    at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:</span><span style="color: #800080;">492</span><span style="color: #000000;">)<br>    at org.apache.catalina.startup.HostConfig.start(HostConfig.java:</span><span style="color: #800080;">1138</span><span style="color: #000000;">)<br>    at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:</span><span style="color: #800080;">311</span><span style="color: #000000;">)<br>    at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:</span><span style="color: #800080;">117</span><span style="color: #000000;">)<br>    at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:</span><span style="color: #800080;">1053</span><span style="color: #000000;">)<br>    at org.apache.catalina.core.StandardHost.start(StandardHost.java:</span><span style="color: #800080;">719</span><span style="color: #000000;">)<br>    at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:</span><span style="color: #800080;">1045</span><span style="color: #000000;">)<br>    at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:</span><span style="color: #800080;">443</span><span style="color: #000000;">)<br>    at org.apache.catalina.core.StandardService.start(StandardService.java:</span><span style="color: #800080;">516</span><span style="color: #000000;">)<br>    at org.apache.catalina.core.StandardServer.start(StandardServer.java:</span><span style="color: #800080;">710</span><span style="color: #000000;">)<br>    at org.apache.catalina.startup.Catalina.start(Catalina.java:</span><span style="color: #800080;">566</span><span style="color: #000000;">)<br>    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br>    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:</span><span style="color: #800080;">57</span><span style="color: #000000;">)<br>    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:</span><span style="color: #800080;">43</span><span style="color: #000000;">)<br>    at java.lang.reflect.Method.invoke(Method.java:</span><span style="color: #800080;">601</span><span style="color: #000000;">)<br>    at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:</span><span style="color: #800080;">288</span><span style="color: #000000;">)<br>    at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:</span><span style="color: #800080;">413</span><span style="color: #000000;">)<br>Caused by: java.lang.NoSuchMethodError: org.objectweb.asm.ClassVisitor.visit(IILjava</span>/lang/String;Ljava/lang/String;[Ljava/lang/String;Ljava/lang/<span style="color: #000000;">String;)V<br>    at net.sf.cglib.core.ClassEmitter.begin_class(ClassEmitter.java:</span><span style="color: #800080;">77</span><span style="color: #000000;">)<br>    at net.sf.cglib.core.KeyFactory$Generator.generateClass(KeyFactory.java:</span><span style="color: #800080;">173</span><span style="color: #000000;">)<br>    at net.sf.cglib.core.DefaultGeneratorStrategy.generate(DefaultGeneratorStrategy.java:</span><span style="color: #800080;">25</span><span style="color: #000000;">)<br>    at net.sf.cglib.core.AbstractClassGenerator.create(AbstractClassGenerator.java:</span><span style="color: #800080;">216</span><span style="color: #000000;">)<br>    at net.sf.cglib.core.KeyFactory$Generator.create(KeyFactory.java:</span><span style="color: #800080;">145</span><span style="color: #000000;">)<br>    at net.sf.cglib.core.KeyFactory.create(KeyFactory.java:</span><span style="color: #800080;">117</span><span style="color: #000000;">)<br>    at net.sf.cglib.core.KeyFactory.create(KeyFactory.java:</span><span style="color: #800080;">108</span><span style="color: #000000;">)<br>    at net.sf.cglib.core.KeyFactory.create(KeyFactory.java:</span><span style="color: #800080;">104</span><span style="color: #000000;">)<br>    at net.sf.cglib.proxy.Enhancer.</span><clinit>(Enhancer.java:<span style="color: #800080;">69</span><span style="color: #000000;">)<br>    at org.hibernate.proxy.pojo.cglib.CGLIBLazyInitializer.getProxyFactory(CGLIBLazyInitializer.java:</span><span style="color: #800080;">117</span><span style="color: #000000;">)<br>    at org.hibernate.proxy.pojo.cglib.CGLIBProxyFactory.postInstantiate(CGLIBProxyFactory.java:</span><span style="color: #800080;">43</span><span style="color: #000000;">)<br>    at org.hibernate.tuple.entity.PojoEntityTuplizer.buildProxyFactory(PojoEntityTuplizer.java:</span><span style="color: #800080;">162</span><span style="color: #000000;">)<br>    at org.hibernate.tuple.entity.AbstractEntityTuplizer.</span><init>(AbstractEntityTuplizer.java:<span style="color: #800080;">135</span><span style="color: #000000;">)<br>    at org.hibernate.tuple.entity.PojoEntityTuplizer.</span><init>(PojoEntityTuplizer.java:<span style="color: #800080;">55</span><span style="color: #000000;">)<br>    at org.hibernate.tuple.entity.EntityEntityModeToTuplizerMapping.</span><init>(EntityEntityModeToTuplizerMapping.java:<span style="color: #800080;">56</span><span style="color: #000000;">)<br>    at org.hibernate.tuple.entity.EntityMetamodel.</span><init>(EntityMetamodel.java:<span style="color: #800080;">295</span><span style="color: #000000;">)<br>    at org.hibernate.persister.entity.AbstractEntityPersister.</span><init>(AbstractEntityPersister.java:<span style="color: #800080;">434</span><span style="color: #000000;">)<br>    at org.hibernate.persister.entity.SingleTableEntityPersister.</span><init>(SingleTableEntityPersister.java:<span style="color: #800080;">109</span><span style="color: #000000;">)<br>    at org.hibernate.persister.PersisterFactory.createClassPersister(PersisterFactory.java:</span><span style="color: #800080;">55</span><span style="color: #000000;">)<br>    at org.hibernate.impl.SessionFactoryImpl.</span><init>(SessionFactoryImpl.java:<span style="color: #800080;">226</span><span style="color: #000000;">)<br>    at org.hibernate.cfg.Configuration.buildSessionFactory(Configuration.java:</span><span style="color: #800080;">1294</span><span style="color: #000000;">)<br>    at org.springframework.orm.hibernate3.LocalSessionFactoryBean.newSessionFactory(LocalSessionFactoryBean.java:</span><span style="color: #800080;">814</span><span style="color: #000000;">)<br>    at org.springframework.orm.hibernate3.LocalSessionFactoryBean.buildSessionFactory(LocalSessionFactoryBean.java:</span><span style="color: #800080;">732</span><span style="color: #000000;">)<br>    at org.springframework.orm.hibernate3.AbstractSessionFactoryBean.afterPropertiesSet(AbstractSessionFactoryBean.java:</span><span style="color: #800080;">211</span><span style="color: #000000;">)<br>    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:</span><span style="color: #800080;">1367</span><span style="color: #000000;">)<br>    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:</span><span style="color: #800080;">1333</span><span style="color: #000000;">)<br>    … </span><span style="color: #800080;">39</span><span style="color: #000000;"> more<br>二月 </span><span style="color: #800080;">07</span>, <span style="color: #800080;">2013</span> <span style="color: #800080;">11</span>:<span style="color: #800080;">27</span>:<span style="color: #800080;">45</span><span style="color: #000000;"> 上午 org.apache.catalina.core.StandardContext listenerStart<br>严重: Exception sending context initialized </span><span style="color: #0000ff;">event</span> to listener instance of <span style="color: #0000ff;">class</span><span style="color: #000000;"> org.springframework.web.context.ContextLoaderListener<br>org.springframework.beans.factory.BeanCreationException: Error creating bean with name </span><span style="color: #800000;">‘</span><span style="color: #800000;">sessionFactory</span><span style="color: #800000;">‘</span> defined <span style="color: #0000ff;">in</span> ServletContext resource [/WEB-INF/classes/applicationContext.xml]: Invocation of init method failed; nested exception <span style="color: #0000ff;">is</span> java.lang.NoSuchMethodError: org.objectweb.asm.ClassVisitor.visit(IILjava/lang/String;Ljava/lang/String;[Ljava/lang/String;Ljava/lang/<span style="color: #000000;">String;)V<br>    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:</span><span style="color: #800080;">1336</span><span style="color: #000000;">)<br>    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:</span><span style="color: #800080;">471</span><span style="color: #000000;">)<br>    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory$</span><span style="color: #800080;">1</span>.run(AbstractAutowireCapableBeanFactory.java:<span style="color: #800080;">409</span><span style="color: #000000;">)<br>    at java.security.AccessController.doPrivileged(Native Method)<br>    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:</span><span style="color: #800080;">380</span><span style="color: #000000;">)<br>    at org.springframework.beans.factory.support.AbstractBeanFactory$</span><span style="color: #800080;">1</span>.getObject(AbstractBeanFactory.java:<span style="color: #800080;">264</span><span style="color: #000000;">)<br>    at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:</span><span style="color: #800080;">220</span><span style="color: #000000;">)<br>    at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:</span><span style="color: #800080;">261</span><span style="color: #000000;">)<br>    at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:</span><span style="color: #800080;">185</span><span style="color: #000000;">)<br>    at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:</span><span style="color: #800080;">164</span><span style="color: #000000;">)<br>    at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:</span><span style="color: #800080;">423</span><span style="color: #000000;">)<br>    at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:</span><span style="color: #800080;">729</span><span style="color: #000000;">)<br>    at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:</span><span style="color: #800080;">381</span><span style="color: #000000;">)<br>    at org.springframework.web.context.ContextLoader.createWebApplicationContext(ContextLoader.java:</span><span style="color: #800080;">255</span><span style="color: #000000;">)<br>    at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:</span><span style="color: #800080;">199</span><span style="color: #000000;">)<br>    at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:</span><span style="color: #800080;">45</span><span style="color: #000000;">)<br>    at org.apache.catalina.core.StandardContext.listenerStart(StandardContext.java:</span><span style="color: #800080;">3827</span><span style="color: #000000;">)<br>    at org.apache.catalina.core.StandardContext.start(StandardContext.java:</span><span style="color: #800080;">4334</span><span style="color: #000000;">)<br>    at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:</span><span style="color: #800080;">791</span><span style="color: #000000;">)<br>    at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:</span><span style="color: #800080;">771</span><span style="color: #000000;">)<br>    at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:</span><span style="color: #800080;">525</span><span style="color: #000000;">)<br>    at org.apache.catalina.startup.HostConfig.deployDirectory(HostConfig.java:</span><span style="color: #800080;">920</span><span style="color: #000000;">)<br>    at org.apache.catalina.startup.HostConfig.deployDirectories(HostConfig.java:</span><span style="color: #800080;">883</span><span style="color: #000000;">)<br>    at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:</span><span style="color: #800080;">492</span><span style="color: #000000;">)<br>    at org.apache.catalina.startup.HostConfig.start(HostConfig.java:</span><span style="color: #800080;">1138</span><span style="color: #000000;">)<br>    at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:</span><span style="color: #800080;">311</span><span style="color: #000000;">)<br>    at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:</span><span style="color: #800080;">117</span><span style="color: #000000;">)<br>    at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:</span><span style="color: #800080;">1053</span><span style="color: #000000;">)<br>    at org.apache.catalina.core.StandardHost.start(StandardHost.java:</span><span style="color: #800080;">719</span><span style="color: #000000;">)<br>    at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:</span><span style="color: #800080;">1045</span><span style="color: #000000;">)<br>    at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:</span><span style="color: #800080;">443</span><span style="color: #000000;">)<br>    at org.apache.catalina.core.StandardService.start(StandardService.java:</span><span style="color: #800080;">516</span><span style="color: #000000;">)<br>    at org.apache.catalina.core.StandardServer.start(StandardServer.java:</span><span style="color: #800080;">710</span><span style="color: #000000;">)<br>    at org.apache.catalina.startup.Catalina.start(Catalina.java:</span><span style="color: #800080;">566</span><span style="color: #000000;">)<br>    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br>    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:</span><span style="color: #800080;">57</span><span style="color: #000000;">)<br>    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:</span><span style="color: #800080;">43</span><span style="color: #000000;">)<br>    at java.lang.reflect.Method.invoke(Method.java:</span><span style="color: #800080;">601</span><span style="color: #000000;">)<br>    at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:</span><span style="color: #800080;">288</span><span style="color: #000000;">)<br>    at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:</span><span style="color: #800080;">413</span><span style="color: #000000;">)<br>Caused by: java.lang.NoSuchMethodError: org.objectweb.asm.ClassVisitor.visit(IILjava</span>/lang/String;Ljava/lang/String;[Ljava/lang/String;Ljava/lang/<span style="color: #000000;">String;)V<br>    at net.sf.cglib.core.ClassEmitter.begin_class(ClassEmitter.java:</span><span style="color: #800080;">77</span><span style="color: #000000;">)<br>    at net.sf.cglib.core.KeyFactory$Generator.generateClass(KeyFactory.java:</span><span style="color: #800080;">173</span><span style="color: #000000;">)<br>    at net.sf.cglib.core.DefaultGeneratorStrategy.generate(DefaultGeneratorStrategy.java:</span><span style="color: #800080;">25</span><span style="color: #000000;">)<br>    at net.sf.cglib.core.AbstractClassGenerator.create(AbstractClassGenerator.java:</span><span style="color: #800080;">216</span><span style="color: #000000;">)<br>    at net.sf.cglib.core.KeyFactory$Generator.create(KeyFactory.java:</span><span style="color: #800080;">145</span><span style="color: #000000;">)<br>    at net.sf.cglib.core.KeyFactory.create(KeyFactory.java:</span><span style="color: #800080;">117</span><span style="color: #000000;">)<br>    at net.sf.cglib.core.KeyFactory.create(KeyFactory.java:</span><span style="color: #800080;">108</span><span style="color: #000000;">)<br>    at net.sf.cglib.core.KeyFactory.create(KeyFactory.java:</span><span style="color: #800080;">104</span><span style="color: #000000;">)<br>    at net.sf.cglib.proxy.Enhancer.</span><clinit>(Enhancer.java:<span style="color: #800080;">69</span><span style="color: #000000;">)<br>    at org.hibernate.proxy.pojo.cglib.CGLIBLazyInitializer.getProxyFactory(CGLIBLazyInitializer.java:</span><span style="color: #800080;">117</span><span style="color: #000000;">)<br>    at org.hibernate.proxy.pojo.cglib.CGLIBProxyFactory.postInstantiate(CGLIBProxyFactory.java:</span><span style="color: #800080;">43</span><span style="color: #000000;">)<br>    at org.hibernate.tuple.entity.PojoEntityTuplizer.buildProxyFactory(PojoEntityTuplizer.java:</span><span style="color: #800080;">162</span><span style="color: #000000;">)<br>    at org.hibernate.tuple.entity.AbstractEntityTuplizer.</span><init>(AbstractEntityTuplizer.java:<span style="color: #800080;">135</span><span style="color: #000000;">)<br>    at org.hibernate.tuple.entity.PojoEntityTuplizer.</span><init>(PojoEntityTuplizer.java:<span style="color: #800080;">55</span><span style="color: #000000;">)<br>    at org.hibernate.tuple.entity.EntityEntityModeToTuplizerMapping.</span><init>(EntityEntityModeToTuplizerMapping.java:<span style="color: #800080;">56</span><span style="color: #000000;">)<br>    at org.hibernate.tuple.entity.EntityMetamodel.</span><init>(EntityMetamodel.java:<span style="color: #800080;">295</span><span style="color: #000000;">)<br>    at org.hibernate.persister.entity.AbstractEntityPersister.</span><init>(AbstractEntityPersister.java:<span style="color: #800080;">434</span><span style="color: #000000;">)<br>    at org.hibernate.persister.entity.SingleTableEntityPersister.</span><init>(SingleTableEntityPersister.java:<span style="color: #800080;">109</span><span style="color: #000000;">)<br>    at org.hibernate.persister.PersisterFactory.createClassPersister(PersisterFactory.java:</span><span style="color: #800080;">55</span><span style="color: #000000;">)<br>    at org.hibernate.impl.SessionFactoryImpl.</span><init>(SessionFactoryImpl.java:<span style="color: #800080;">226</span><span style="color: #000000;">)<br>    at org.hibernate.cfg.Configuration.buildSessionFactory(Configuration.java:</span><span style="color: #800080;">1294</span><span style="color: #000000;">)<br>    at org.springframework.orm.hibernate3.LocalSessionFactoryBean.newSessionFactory(LocalSessionFactoryBean.java:</span><span style="color: #800080;">814</span><span style="color: #000000;">)<br>    at org.springframework.orm.hibernate3.LocalSessionFactoryBean.buildSessionFactory(LocalSessionFactoryBean.java:</span><span style="color: #800080;">732</span><span style="color: #000000;">)<br>    at org.springframework.orm.hibernate3.AbstractSessionFactoryBean.afterPropertiesSet(AbstractSessionFactoryBean.java:</span><span style="color: #800080;">211</span><span style="color: #000000;">)<br>    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:</span><span style="color: #800080;">1367</span><span style="color: #000000;">)<br>    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:</span><span style="color: #800080;">1333</span><span style="color: #000000;">)<br>    … </span><span style="color: #800080;">39</span> more</init></init></init></init></init></init></init></clinit></init></init></init></init></init></init></init></clinit></pre><br></div>

<p>&nbsp;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuling07.github.io/2013/02/nosuchmethoderror-asm.html" data-id="ciiy5f4ru004oq1d0fba3m4rk" class="article-share-link">Share</a>
      
        <a href="http://liuling07.github.io/2013/02/nosuchmethoderror-asm.html#ds-thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web后端/">web后端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/解决方案/">解决方案</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-dom4j-xml" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/02/dom4j-xml.html">dom4j解析xml文件</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2013/02/dom4j-xml.html">
      <time datetime="2013-02-05T07:21:00.000Z" itemprop="datePublished">2013-02-05</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/后端/">后端</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>一、利用dom4j创建一个内容如下的xml文件SqlMapConfig.xml</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;?</span><span style="color: #ff00ff;">xml version=”1.0” encoding=”UTF-8” </span><span style="color: #0000ff;">?&gt;</span><br><span style="color: #008080;"> 2</span> <span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE configuration PUBLIC “-//ibatis.apache.org//DTD Config 3.0//EN”<br></span><span style="color: #008080;"> 3</span> <span style="color: #ff00ff;">                       “ibatis-3-config.dtd”</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">configuration</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;"> 5</span>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">environments </span><span style="color: #ff0000;">default</span><span style="color: #0000ff;">=”development”</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;"> 6</span>       <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">environment </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">=”MySQL”</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;"> 7</span>          <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">transactionManager </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">=”JDBC”</span><span style="color: #0000ff;">&gt;</span>123<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">transactionManager</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;"> 8</span>          <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">dataSource </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">=”POOLED”</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;"> 9</span>              <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”driver”</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">=”com.mysql.jdbc.Driver”</span><span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">10</span>              <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”url”</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">=”jdbc:mysql://127.0.0.1:3306/test”</span><span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">11</span>              <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”username”</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">=”root”</span><span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">12</span>              <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">property </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">=”password”</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">=”admin”</span><span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">13</span>          <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">dataSource</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">14</span>       <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">environment</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">15</span>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">environments</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">16</span><br><span style="color: #008080;">17</span>    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">mappers</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">18</span>       <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">mapper </span><span style="color: #ff0000;">resource</span><span style="color: #0000ff;">=”com/pojo/sql/DepMap.xml”</span><span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">19</span>       <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">mapper </span><span style="color: #ff0000;">resource</span><span style="color: #0000ff;">=”com/pojo/sql/EmpMap.xml”</span><span style="color: #0000ff;">/&gt;</span><br><span style="color: #008080;">20</span>    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">mappers</span><span style="color: #0000ff;">&gt;</span><br><span style="color: #008080;">21</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">configuration</span><span style="color: #0000ff;">&gt;</span></pre><br></div>

<p>步骤：<br>&nbsp;1.创建一个输出流，指定创建的SqlMapConfig.xml文件的位置——-OutputStream<br>&nbsp;&nbsp;&nbsp; OutputStream os = new FileOutputStream(“d:/SqlMapConfig.xml”);<br>&nbsp;2.创建一个xml编写器——-XMLWriter<br>&nbsp;&nbsp;&nbsp; XMLWriter writer = new XMLWriter(os,OutputFormat.createPrettyPrint());<br>&nbsp;&nbsp;&nbsp; 这里os是前面新建的一个输出流，OutputFormat.createPrettyPrint()是指定输出的格式的，这里代表内容缩进。<br>&nbsp;3.创建xml文档——-Document、DocumentHelper<br>&nbsp;&nbsp;&nbsp; Document document = DocumentHelper.createDocument();<br>&nbsp;4.创建里面的所有结点元素——-Elemenet<br>&nbsp;&nbsp;&nbsp; Element configuration = document.addElement(“configuration”);<br>&nbsp;&nbsp;&nbsp;…………..<br>&nbsp;&nbsp;&nbsp; 新建结点元素的形式是：Element 子结点 = 父节点.addElement(“子结点名”);<br>&nbsp;&nbsp;&nbsp; 给结点元素添加属性是：结点.addAttribute(“属性名”, “属性值”);<br>&nbsp;5.保存xml<br>&nbsp;&nbsp;&nbsp; writer.write(document);<br>代码如下：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> CreateXML {<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span>     <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;"> 4</span> <span style="color: #008000;">      </span><span style="color: #808080;">@param</span><span style="color: #008000;"> args<br></span><span style="color: #008080;"> 5</span> <span style="color: #008000;">     <em> </em></span><span style="color: #808080;">@throws</span><span style="color: #008000;"> IOException<br></span><span style="color: #008080;"> 6</span>      <span style="color: #008000;">/</span><br><span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> main(String[] args) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> IOException {<br></span><span style="color: #008080;"> 8</span>         <span style="color: #008000;">//</span><span style="color: #008000;">创建一个输出流，指定创建的xml文件的位置</span><br><span style="color: #008080;"> 9</span>         OutputStream os = <span style="color: #0000ff;">new</span> FileOutputStream(“d:/SqlMapConfig.xml”<span style="color: #000000;">);<br></span><span style="color: #008080;">10</span><br><span style="color: #008080;">11</span>         XMLWriter writer = <span style="color: #0000ff;">new</span><span style="color: #000000;"> XMLWriter(os,OutputFormat.createPrettyPrint());<br></span><span style="color: #008080;">12</span><br><span style="color: #008080;">13</span>         <span style="color: #008000;">//</span><span style="color: #008000;">创建Document</span><br><span style="color: #008080;">14</span>         Document document =<span style="color: #000000;"> DocumentHelper.createDocument();<br></span><span style="color: #008080;">15</span><br><span style="color: #008080;">16</span>         Element configuration = document.addElement(“configuration”<span style="color: #000000;">);<br></span><span style="color: #008080;">17</span><br><span style="color: #008080;">18</span>         Element environments = configuration.addElement(“environments”<span style="color: #000000;">);<br></span><span style="color: #008080;">19</span>         environments.addAttribute(“default”, “development”<span style="color: #000000;">);<br></span><span style="color: #008080;">20</span><br><span style="color: #008080;">21</span>         Element environment = environments.addElement(“environment”<span style="color: #000000;">);<br></span><span style="color: #008080;">22</span>         environment.addAttribute(“id”, “MySQL”<span style="color: #000000;">);<br></span><span style="color: #008080;">23</span>         Element transactionManager = environment.addElement(“transactionManager”<span style="color: #000000;">);<br></span><span style="color: #008080;">24</span>         transactionManager.addAttribute(“type”, “JDBC”<span style="color: #000000;">);<br></span><span style="color: #008080;">25</span>         transactionManager.setText(“123”<span style="color: #000000;">);<br></span><span style="color: #008080;">26</span><br><span style="color: #008080;">27</span>         Element dataSource = environment.addElement(“dataSource”<span style="color: #000000;">);<br></span><span style="color: #008080;">28</span>         dataSource.addAttribute(“type”, “POOLED”<span style="color: #000000;">);<br></span><span style="color: #008080;">29</span>         Element driver = dataSource.addElement(“property”<span style="color: #000000;">);<br></span><span style="color: #008080;">30</span>         driver.addAttribute(“name”, “driver”<span style="color: #000000;">);<br></span><span style="color: #008080;">31</span>         driver.addAttribute(“value”, “com.mysql.jdbc.Driver”<span style="color: #000000;">);<br></span><span style="color: #008080;">32</span>         Element url = dataSource.addElement(“property”<span style="color: #000000;">);<br></span><span style="color: #008080;">33</span>         url.addAttribute(“name”, “url”<span style="color: #000000;">);<br></span><span style="color: #008080;">34</span>         url.addAttribute(“value”, “jdbc:mysql://127.0.0.1:3306/test”<span style="color: #000000;">);<br></span><span style="color: #008080;">35</span>         Element username = dataSource.addElement(“property”<span style="color: #000000;">);<br></span><span style="color: #008080;">36</span>         username.addAttribute(“name”, “username”<span style="color: #000000;">);<br></span><span style="color: #008080;">37</span>         username.addAttribute(“value”, “root”<span style="color: #000000;">);<br></span><span style="color: #008080;">38</span>         Element password = dataSource.addElement(“property”<span style="color: #000000;">);<br></span><span style="color: #008080;">39</span>         password.addAttribute(“name”, “password”<span style="color: #000000;">);<br></span><span style="color: #008080;">40</span>         password.addAttribute(“value”, “admin”<span style="color: #000000;">);<br></span><span style="color: #008080;">41</span><br><span style="color: #008080;">42</span>         Element mappers = configuration.addElement(“mappers”<span style="color: #000000;">);<br></span><span style="color: #008080;">43</span>         Element mapper1 = mappers.addElement(“mapper”<span style="color: #000000;">);<br></span><span style="color: #008080;">44</span>         mapper1.addAttribute(“resource”, “com/pojo/sql/DepMap.xml”<span style="color: #000000;">);<br></span><span style="color: #008080;">45</span>         Element mapper2 = mappers.addElement(“mapper”<span style="color: #000000;">);<br></span><span style="color: #008080;">46</span>         mapper2.addAttribute(“resource”, “com/pojo/sql/EmpMap.xml”<span style="color: #000000;">);<br></span><span style="color: #008080;">47</span>         <span style="color: #008000;">//</span><span style="color: #008000;">保存xml</span><br><span style="color: #008080;">48</span> <span style="color: #000000;">        writer.write(document);<br></span><span style="color: #008080;">49</span> <span style="color: #000000;">        writer.close();<br></span><span style="color: #008080;">50</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">51</span> }</pre><br></div>

<p>二、查找xml文件的内容<br>&nbsp;&nbsp;&nbsp; 查找xml文件内容有两种情况，第一种就是查找出所有同名的结点元素然后遍历、第二种就是直接找到某个结点元素<br>&nbsp;&nbsp;&nbsp; 比如遍历SqlMapConfig.xml,将driver、url、username、password的值读取出来就有两种方法，代码如下<br>方法一：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> GetNodes {<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span>     <span style="color: #008000;">/<em>*</em></span><span style="color: #008000;">方法一：<br></span><span style="color: #008080;"> 4</span> <span style="color: #008000;">      遍历新建的xml,将driver、url、username、password的值读取出来<br></span><span style="color: #008080;"> 5</span> <span style="color: #008000;">     <em> </em></span><span style="color: #808080;">@param</span><span style="color: #008000;"> args<br></span><span style="color: #008080;"> 6</span> <span style="color: #008000;">      </span><span style="color: #808080;">@throws</span><span style="color: #008000;"> IOException<br></span><span style="color: #008080;"> 7</span> <span style="color: #008000;">     <em> </em></span><span style="color: #808080;">@throws</span><span style="color: #008000;"> DocumentException<br></span><span style="color: #008080;"> 8</span>      <span style="color: #008000;">/</span><br><span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> main(String[] args) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> IOException, DocumentException {<br></span><span style="color: #008080;">10</span>         SAXReader reader = <span style="color: #0000ff;">new</span><span style="color: #000000;"> SAXReader();<br></span><span style="color: #008080;">11</span>         Document document = reader.read(“d:/SqlMapConfig.xml”<span style="color: #000000;">);<br></span><span style="color: #008080;">12</span>         List<element> elements = document.selectNodes(“/configuration/environments/environment/dataSource/property”<span style="color: #000000;">);<br></span><span style="color: #008080;">13</span>         String driver = “”<span style="color: #000000;">;<br></span><span style="color: #008080;">14</span>         String url = “”<span style="color: #000000;">;<br></span><span style="color: #008080;">15</span>         String username = “”<span style="color: #000000;">;<br></span><span style="color: #008080;">16</span>         String password = “”<span style="color: #000000;">;<br></span><span style="color: #008080;">17</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (Element e : elements) {<br></span><span style="color: #008080;">18</span>             String name = e.attributeValue(“name”<span style="color: #000000;">);<br></span><span style="color: #008080;">19</span>             String value = e.attributeValue(“value”<span style="color: #000000;">);<br></span><span style="color: #008080;">20</span>             <span style="color: #0000ff;">if</span>(“driver”<span style="color: #000000;">.equals(name)){<br></span><span style="color: #008080;">21</span>                 driver =<span style="color: #000000;"> value;<br></span><span style="color: #008080;">22</span>             }<span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(“url”<span style="color: #000000;">.equals(name)){<br></span><span style="color: #008080;">23</span>                 url =<span style="color: #000000;"> value;<br></span><span style="color: #008080;">24</span>             }<span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(“username”<span style="color: #000000;">.equals(name)){<br></span><span style="color: #008080;">25</span>                 username =<span style="color: #000000;"> value;<br></span><span style="color: #008080;">26</span>             }<span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(“password”<span style="color: #000000;">.equals(name)){<br></span><span style="color: #008080;">27</span>                 password =<span style="color: #000000;"> value;<br></span><span style="color: #008080;">28</span> <span style="color: #000000;">            }<br></span><span style="color: #008080;">29</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">30</span>         System.out.println(“driver:”+driver+”,url:”+url+”,username:”+username+”,password:”+<span style="color: #000000;">password);<br></span><span style="color: #008080;">31</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">32</span> }</element></pre><br></div>

<p>　　这里List<element> elements = document.selectNodes(“/configuration/environments/environment/dataSource/property”)是指将名为property的结点元素全部找出来，用一个List接收。<br>方法二：</element></p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> GetNodes1 {<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span>     <span style="color: #008000;">/<em>*</em></span><span style="color: #008000;">方法二：<br></span><span style="color: #008080;"> 4</span> <span style="color: #008000;">      将driver、url、username、password的值读取出来<br></span><span style="color: #008080;"> 5</span> <span style="color: #008000;">     <em> </em></span><span style="color: #808080;">@param</span><span style="color: #008000;"> args<br></span><span style="color: #008080;"> 6</span> <span style="color: #008000;">      </span><span style="color: #808080;">@throws</span><span style="color: #008000;"> IOException<br></span><span style="color: #008080;"> 7</span> <span style="color: #008000;">     <em> </em></span><span style="color: #808080;">@throws</span><span style="color: #008000;"> DocumentException<br></span><span style="color: #008080;"> 8</span>      <span style="color: #008000;">/</span><br><span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> main(String[] args) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> IOException, DocumentException {<br></span><span style="color: #008080;">10</span>         SAXReader reader = <span style="color: #0000ff;">new</span><span style="color: #000000;"> SAXReader();<br></span><span style="color: #008080;">11</span>         Document document = reader.read(“d:/SqlMapConfig.xml”<span style="color: #000000;">);<br></span><span style="color: #008080;">12</span>         Element driverElement = (Element)document.selectSingleNode(“/configuration/environments/environment/dataSource/property[@name=’driver’]”<span style="color: #000000;">);<br></span><span style="color: #008080;">13</span>         Element urlElement = (Element)document.selectSingleNode(“/configuration/environments/environment/dataSource/property[@name=’url’]”<span style="color: #000000;">);<br></span><span style="color: #008080;">14</span>         Element usernameElement = (Element)document.selectSingleNode(“/configuration/environments/environment/dataSource/property[@name=’username’]”<span style="color: #000000;">);<br></span><span style="color: #008080;">15</span>         Element passwordElement = (Element)document.selectSingleNode(“/configuration/environments/environment/dataSource/property[@name=’password’]”<span style="color: #000000;">);<br></span><span style="color: #008080;">16</span>         String driver = driverElement.attributeValue(“value”<span style="color: #000000;">);<br></span><span style="color: #008080;">17</span>         String url = urlElement.attributeValue(“value”<span style="color: #000000;">);<br></span><span style="color: #008080;">18</span>         String username = usernameElement.attributeValue(“value”<span style="color: #000000;">);<br></span><span style="color: #008080;">19</span>         String password = passwordElement.attributeValue(“value”<span style="color: #000000;">);<br></span><span style="color: #008080;">20</span><br><span style="color: #008080;">21</span>         System.out.println(“driver:”+driver+”,url:”+url+”,username:”+username+”,password:”+<span style="color: #000000;">password);<br></span><span style="color: #008080;">22</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">23</span> }</pre><br></div>

<p>　　这种方法就没有遍历了，就是直接将要查找的结点找出来，用selectSingleNode()函数。这里的[@name=’driver’]是指名找到哪一个property结点，相当于一个键值对，表示找有name=”driver”属性的property结点。<br>形式为[@属性名=’属性值’]。</p>
<p>三、修改XML文件<br>&nbsp;&nbsp;&nbsp; 步骤：<br>&nbsp;&nbsp;&nbsp; 1.读取要修改的xml文件<br>&nbsp;&nbsp;&nbsp; 2.查找到要修改的结点<br>&nbsp;&nbsp;&nbsp; 3.保存<br>代码如下：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> UpdateNode {<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span>     <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;"> 4</span> <span style="color: #008000;">      修改密码为123456<br></span><span style="color: #008080;"> 5</span> <span style="color: #008000;">     <em> </em></span><span style="color: #808080;">@param</span><span style="color: #008000;"> args<br></span><span style="color: #008080;"> 6</span> <span style="color: #008000;">      </span><span style="color: #808080;">@throws</span><span style="color: #008000;"> DocumentException<br></span><span style="color: #008080;"> 7</span> <span style="color: #008000;">     <em> </em></span><span style="color: #808080;">@throws</span><span style="color: #008000;"> IOException<br></span><span style="color: #008080;"> 8</span>      <span style="color: #008000;">/</span><br><span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> main(String[] args) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> DocumentException, IOException {<br></span><span style="color: #008080;">10</span>         <span style="color: #008000;">//</span><span style="color: #008000;">读取并修改</span><br><span style="color: #008080;">11</span>         SAXReader reader = <span style="color: #0000ff;">new</span><span style="color: #000000;"> SAXReader();<br></span><span style="color: #008080;">12</span>         Document document = reader.read(“d:/SqlMapConfig.xml”<span style="color: #000000;">);<br></span><span style="color: #008080;">13</span>         Element passwordElement = (Element)document.selectSingleNode(“/configuration/environments/environment/dataSource/property[@name=’password’]”<span style="color: #000000;">);<br></span><span style="color: #008080;">14</span>         passwordElement.addAttribute(“value”, “123456”<span style="color: #000000;">);<br></span><span style="color: #008080;">15</span>         <span style="color: #008000;">//</span><span style="color: #008000;">保存</span><br><span style="color: #008080;">16</span>         OutputStream os = <span style="color: #0000ff;">new</span> FileOutputStream(“d:/SqlMapConfig.xml”<span style="color: #000000;">);<br></span><span style="color: #008080;">17</span>         XMLWriter writer = <span style="color: #0000ff;">new</span><span style="color: #000000;"> XMLWriter(os,OutputFormat.createPrettyPrint());<br></span><span style="color: #008080;">18</span> <span style="color: #000000;">        writer.write(document);<br></span><span style="color: #008080;">19</span> <span style="color: #000000;">        writer.close();<br></span><span style="color: #008080;">20</span> <span style="color: #000000;">        os.close();<br></span><span style="color: #008080;">21</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">22</span><br><span style="color: #008080;">23</span> }</pre><br></div>

<p>四、删除XML文件的某个结点元素<br>　　删除和修改一样，也是要先找到要删除的结点，然后删除之，最后保存修改过的文件。删除结点的形式为：父节点.remove(子节点);<br>代码如下：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> DeleteNode {<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span>     <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;"> 4</span> <span style="color: #008000;">      删除密码结点<br></span><span style="color: #008080;"> 5</span> <span style="color: #008000;">     <em> </em></span><span style="color: #808080;">@param</span><span style="color: #008000;"> args<br></span><span style="color: #008080;"> 6</span> <span style="color: #008000;">      </span><span style="color: #808080;">@throws</span><span style="color: #008000;"> DocumentException<br></span><span style="color: #008080;"> 7</span> <span style="color: #008000;">     <em> </em></span><span style="color: #808080;">@throws</span><span style="color: #008000;"> IOException<br></span><span style="color: #008080;"> 8</span>      <span style="color: #008000;">/</span><br><span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> main(String[] args) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> DocumentException, IOException {<br></span><span style="color: #008080;">10</span>         <span style="color: #008000;">//</span><span style="color: #008000;">找到结点并删除</span><br><span style="color: #008080;">11</span>         SAXReader reader = <span style="color: #0000ff;">new</span><span style="color: #000000;"> SAXReader();<br></span><span style="color: #008080;">12</span>         Document document = reader.read(“d:/SqlMapConfig.xml”<span style="color: #000000;">);<br></span><span style="color: #008080;">13</span>         Element passwordElement = (Element) document.selectSingleNode(“/configuration/environments/environment/dataSource/property[@name=’password’]”<span style="color: #000000;">);<br></span><span style="color: #008080;">14</span> <span style="color: #000000;">        passwordElement.getParent().remove(passwordElement);<br></span><span style="color: #008080;">15</span><br><span style="color: #008080;">16</span>         <span style="color: #008000;">//</span><span style="color: #008000;">保存</span><br><span style="color: #008080;">17</span>         OutputStream os = <span style="color: #0000ff;">new</span> FileOutputStream(“d:/SqlMapConfig.xml”<span style="color: #000000;">);<br></span><span style="color: #008080;">18</span>         XMLWriter writer = <span style="color: #0000ff;">new</span><span style="color: #000000;"> XMLWriter(os,OutputFormat.createPrettyPrint());<br></span><span style="color: #008080;">19</span> <span style="color: #000000;">        writer.write(document);<br></span><span style="color: #008080;">20</span> <span style="color: #000000;">        writer.close();<br></span><span style="color: #008080;">21</span> <span style="color: #000000;">        os.close();<br></span><span style="color: #008080;">22</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">23</span> }</pre><br></div>

<p>&nbsp;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuling07.github.io/2013/02/dom4j-xml.html" data-id="ciiy5f4wb00bsq1d0fr4gxfor" class="article-share-link">Share</a>
      
        <a href="http://liuling07.github.io/2013/02/dom4j-xml.html#ds-thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web后端/">web后端</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-design-partten-factory" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/02/design-partten-factory.html">抽象工厂之更换皮肤</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2013/02/design-partten-factory.html">
      <time datetime="2013-02-04T01:43:00.000Z" itemprop="datePublished">2013-02-04</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/设计模式/">设计模式</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>　　工厂工厂，顾名思义就是生产产品的加工厂。抽象工厂模式是所有形态的工厂模式中最为抽象和最具一般性的一种形态。抽象工厂模式是指当有多个抽象角色时，使用的一种工厂模式。抽象工厂模式可以向客户端提供一个接口，使客户端在不必指定产品的具体的情况下，创建多个产品族中的产品对象。</p>
<p>　　工厂模式在实际应用中用的非常多，比如说大家用的QQ的换皮肤功能，就是应用工厂模式实现的。只要选中某个皮肤，整个界面风格都改变了，包括背景图、按钮、界面风格等。下面我就用工厂模式来实现简单的换皮肤功能。</p>
<p>　　假如一套皮肤有背景图片、界面和按钮，这些我们叫做抽象产品，比如说背景图片有红色风格背景图片、蓝色风格背景图片，界面也有红色风格界面和蓝色风格界面，界面也一样。首先我们建立这些抽象产品：</p>
<p>BackGround.java</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">abstract</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Background {<br></span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">abstract</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> showBgPic();<br></span><span style="color: #008080;">3</span> }</pre><br></div>

<p>Button.java</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">abstract</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Button {<br></span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">abstract</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onclick();<br></span><span style="color: #008080;">3</span> }</pre><br></div>

<p>QQFrame.java</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">abstract</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> QQFrame {<br></span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">abstract</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> printColor();<br></span><span style="color: #008080;">3</span> }</pre><br></div>

<p>然后建立具体产品，如建立一个红色风格的皮肤，则需要建立红色风格的背景图片、红色风格的界面、红色风格的按钮。代码如下</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #000000;">BlueBackground.java<br></span><span style="color: #008080;"> 2</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> BlueBackground <span style="color: #0000ff;">extends</span><span style="color: #000000;"> Background {<br></span><span style="color: #008080;"> 3</span><br><span style="color: #008080;"> 4</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> showBgPic() {<br></span><span style="color: #008080;"> 6</span>         System.out.println(“蓝色的背景图片….”<span style="color: #000000;">);<br></span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;"> 8</span><br><span style="color: #008080;"> 9</span> <span style="color: #000000;">}<br></span><span style="color: #008080;">10</span><br><span style="color: #008080;">11</span> <span style="color: #000000;">BlueButton.java<br></span><span style="color: #008080;">12</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> BlueButton <span style="color: #0000ff;">extends</span><span style="color: #000000;"> Button {<br></span><span style="color: #008080;">13</span><br><span style="color: #008080;">14</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">15</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> onclick() {<br></span><span style="color: #008080;">16</span>         System.out.println(“蓝色风格的按钮被按下”<span style="color: #000000;">);<br></span><span style="color: #008080;">17</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">18</span><br><span style="color: #008080;">19</span> <span style="color: #000000;">}<br></span><span style="color: #008080;">20</span><br><span style="color: #008080;">21</span> <span style="color: #000000;">BlueFrame.java<br></span><span style="color: #008080;">22</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> BlueFrame <span style="color: #0000ff;">extends</span><span style="color: #000000;"> QQFrame {<br></span><span style="color: #008080;">23</span><br><span style="color: #008080;">24</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">25</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> printColor() {<br></span><span style="color: #008080;">26</span>         System.out.println(“蓝色的界面风格”<span style="color: #000000;">);<br></span><span style="color: #008080;">27</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">28</span><br><span style="color: #008080;">29</span> }</pre><br></div>

<p>&nbsp;</p>
<p>&nbsp;然后建立抽象工厂SkinFactory,抽象工厂包括创建背景图片、创建界面、创建按钮的抽象方法，代码如下：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">abstract</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> SkinFactory {<br></span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">abstract</span><span style="color: #000000;"> Background createBackground();<br></span><span style="color: #008080;">3</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">abstract</span><span style="color: #000000;"> Button createButton();<br></span><span style="color: #008080;">4</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">abstract</span><span style="color: #000000;"> QQFrame createFrame();<br></span><span style="color: #008080;">5</span> }</pre><br></div>

<p>写好抽象工厂之后就可以写具体的工厂了，比如说BlueSkinFactory，具体工厂要继承抽象工厂SkinFactory，并实现其的抽象方法。代码如下：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> BlueSkinFactory <span style="color: #0000ff;">extends</span><span style="color: #000000;"> SkinFactory {<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> Background createBackground() {<br></span><span style="color: #008080;"> 5</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> TODO Auto-generated method stub</span><br><span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> BlueBackground();<br></span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;"> 8</span><br><span style="color: #008080;"> 9</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">10</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> Button createButton() {<br></span><span style="color: #008080;">11</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> TODO Auto-generated method stub</span><br><span style="color: #008080;">12</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> BlueButtom();<br></span><span style="color: #008080;">13</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">14</span><br><span style="color: #008080;">15</span> <span style="color: #000000;">    @Override<br></span><span style="color: #008080;">16</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> QQFrame createFrame() {<br></span><span style="color: #008080;">17</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> TODO Auto-generated method stub</span><br><span style="color: #008080;">18</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> BlueFrame();<br></span><span style="color: #008080;">19</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">20</span><br><span style="color: #008080;">21</span> }</pre><br></div>

<p>&nbsp;</p>
<p>最后写一个测试类，代码如下：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Test {<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span>     <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;"> 4</span> <span style="color: #008000;">      </span><span style="color: #808080;">@param</span><span style="color: #008000;"> args<br></span><span style="color: #008080;"> 5</span>      <span style="color: #008000;">*/</span><br><span style="color: #008080;"> 6</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {<br></span><span style="color: #008080;"> 7</span>         SkinFactory skinFactory = <span style="color: #0000ff;">new</span><span style="color: #000000;"> BlueSkinFactory();<br></span><span style="color: #008080;"> 8</span>         Background background = skinFactory.createBackground();<span style="color: #008000;">//</span><span style="color: #008000;">以后需要换皮肤只需改这一句</span><br><span style="color: #008080;"> 9</span>         Button button =<span style="color: #000000;"> skinFactory.createButton();<br></span><span style="color: #008080;">10</span>         QQFrame frame =<span style="color: #000000;"> skinFactory.createFrame();<br></span><span style="color: #008080;">11</span> <span style="color: #000000;">        background.showBgPic();<br></span><span style="color: #008080;">12</span> <span style="color: #000000;">        button.onclick();<br></span><span style="color: #008080;">13</span> <span style="color: #000000;">        frame.printColor();<br></span><span style="color: #008080;">14</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">15</span><br><span style="color: #008080;">16</span> }</pre><br></div>

<p>&nbsp;</p>
<p>　　这样就实现了简单的换皮肤功能了。如果需要换皮肤，则只要将具体工厂换一个就好了，比如说将SkinFactory skinFactory = new BlueSkinFactory()改成SkinFactory skinFactory = new RedSkinFactory() （不过首先要建立具体产品和具体的工厂）.其他代码都无需改动，这样就很好的实现了可扩展性。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuling07.github.io/2013/02/design-partten-factory.html" data-id="ciiy5f4wl00cbq1d0pg0rv3oy" class="article-share-link">Share</a>
      
        <a href="http://liuling07.github.io/2013/02/design-partten-factory.html#ds-thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/设计模式/">设计模式</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-struts-file-download" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/02/struts-file-download.html">struts实现文件下载</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2013/02/struts-file-download.html">
      <time datetime="2013-02-03T07:27:00.000Z" itemprop="datePublished">2013-02-03</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/后端/">后端</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>　　今天学习了如何用struts实现文件下载的功能，可以将服务器的文件下载到客户端。</p>
<p>　　其实不用struts也可以实现下载，可以直接用一个链接，href里面写文件的目录。如：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> <a href="/download/123.rar">123.rar</a></pre><br></div>

<p>　　这种方法简单，不过它只能下载压缩文件，而其他一些文件如文本文件、图片等都会直接在页面上面显示出来而不会下载到客户端，所以此方法不可取。</p>
<p>　　下面介绍另一种方法，也就是用struts实现文件的下载。首先，在WebRoot目录下面建一个文件夹download，可以将文件上传到这个目录下面。下载文件也从该目录下面下载。然后新建一个TestAction类,代码如下(struts的配置这里就不讲了)：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> TestAction <span style="color: #0000ff;">extends</span><span style="color: #000000;"> ActionSupport{<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">public</span> String fileLoad() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> IOException{<br></span><span style="color: #008080;"> 4</span>         String fileName = ServletActionContext.getRequest().getParameter(“fileName”<span style="color: #000000;">);<br></span><span style="color: #008080;"> 5</span>         <span style="color: #008000;">//</span><span style="color: #008000;">要处理中文乱码问题</span><br><span style="color: #008080;"> 6</span>         fileName = <span style="color: #0000ff;">new</span> String(fileName.getBytes(“iso8859-1”),”utf-8”<span style="color: #000000;">);<br></span><span style="color: #008080;"> 7</span>         <span style="color: #008000;">//</span><span style="color: #008000;">要下载的哪个文件</span><br><span style="color: #008080;"> 8</span>         String path = ServletActionContext.getServletContext().getRealPath(“/“);<span style="color: #008000;">//</span><span style="color: #008000;">得到项目的根目录</span><br><span style="color: #008080;"> 9</span>         InputStream is = <span style="color: #0000ff;">new</span> FileInputStream(path+”/download/“+<span style="color: #000000;">fileName);<br></span><span style="color: #008080;">10</span><br><span style="color: #008080;">11</span>         <span style="color: #008000;">//</span><span style="color: #008000;">下载到哪里？客户端</span><br><span style="color: #008080;">12</span>         HttpServletResponse response =<span style="color: #000000;"> ServletActionContext.getResponse();<br></span><span style="color: #008080;">13</span>         OutputStream os =<span style="color: #000000;"> response.getOutputStream();<br></span><span style="color: #008080;">14</span>         <span style="color: #008000;">//</span><span style="color: #008000;">弹出下载的框filename:提示用户下载的文件名</span><br><span style="color: #008080;">15</span>         response.addHeader(“content-disposition”, “attachment;filename=”+java.net.URLEncoder.encode(fileName,”utf-8”<span style="color: #000000;">));<br></span><span style="color: #008080;">16</span><br><span style="color: #008080;">17</span>         <span style="color: #0000ff;">byte</span>[] b = <span style="color: #0000ff;">new</span> <span style="color: #0000ff;">byte</span>[1024<span style="color: #000000;">];<br></span><span style="color: #008080;">18</span>         <span style="color: #0000ff;">int</span> size =<span style="color: #000000;"> is.read(b);<br></span><span style="color: #008080;">19</span>         <span style="color: #0000ff;">while</span>(size&gt;0<span style="color: #000000;">){<br></span><span style="color: #008080;">20</span>             os.write(b,0<span style="color: #000000;">,size);<br></span><span style="color: #008080;">21</span>             size =<span style="color: #000000;"> is.read(b);<br></span><span style="color: #008080;">22</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">23</span> <span style="color: #000000;">        is.close();<br></span><span style="color: #008080;">24</span> <span style="color: #000000;">        os.close();<br></span><span style="color: #008080;">25</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;<br></span><span style="color: #008080;">26</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">27</span><br><span style="color: #008080;">28</span> }</pre><br></div>

<p>index.jsp的内容如下：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> <a href="/test!fileLoad.action?fileName=A.java">A.java</a><br><span style="color: #008080;">2</span><br><span style="color: #008080;">3</span> <a href="/test!fileLoad.action?fileName=jquery.txt">jquery.txt</a><br><span style="color: #008080;">4</span><br><span style="color: #008080;">5</span> <a href="/test!fileLoad.action?fileName=中文.txt">中文.txt</a></pre><br></div>

<p>文件下载分为两步：读文件、写文件。从服务器读取，然后写到客户端去，所以需要InputStream和OutputStream。然后设置content-disposition弹出下载提示框，提示用户下载的文件名和从何处下载的。下面一段代码是读写文件的金典代码，我也不多讲了！</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> <span style="color: #0000ff;">byte</span>[] b = <span style="color: #0000ff;">new</span> <span style="color: #0000ff;">byte</span>[1024<span style="color: #000000;">];<br></span><span style="color: #008080;">2</span> <span style="color: #0000ff;">int</span> size =<span style="color: #000000;"> is.read(b);<br></span><span style="color: #008080;">3</span> <span style="color: #0000ff;">while</span>(size&gt;0<span style="color: #000000;">){<br></span><span style="color: #008080;">4</span>     os.write(b,0<span style="color: #000000;">,size);<br></span><span style="color: #008080;">5</span>     size =<span style="color: #000000;"> is.read(b);<br></span><span style="color: #008080;">6</span> }</pre><br></div>

<p>&nbsp;实现下载功能要注意：因为是用链接传过来的文件名，所以必须处理中文乱码问题。</p>
<p>以上方法实现下载功能没有使用struts2里面自带的文件下载。下面使用struts2自带的方法实现文件下载功能。</p>
<p>struts.xml配置如下：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <struts><br><span style="color: #008080;"> 2</span>    &lt;<span style="color: #0000ff;">package</span> name=”com.action” <span style="color: #0000ff;">extends</span>=”struts-default”&gt;<br><span style="color: #008080;"> 3</span>            <action name="download" <span="" style="color: #0000ff;">class=”com.action.FileLoadAction”&gt;<br><span style="color: #008080;"> 4</span>                <result name="success" type="stream"><br><span style="color: #008080;"> 5</span>                    <param name="contentType">application/txt;<br><span style="color: #008080;"> 6</span>                    <param name="inputName">downloadFile<br><span style="color: #008080;"> 7</span>                    <param name="bufferSize">2048<br><span style="color: #008080;"> 8</span>                </result><br><span style="color: #008080;"> 9</span>            </action><br><span style="color: #008080;">10</span>    &lt;/<span style="color: #0000ff;">package</span>&gt;<br><span style="color: #008080;">11</span> </struts>    </pre><br></div>

<p>FileLoadAction.java类</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> FileLoadAction <span style="color: #0000ff;">extends</span><span style="color: #000000;"> ActionSupport{<br></span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> String fileName;<br></span><span style="color: #008080;"> 3</span><br><span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String getFileName() {<br></span><span style="color: #008080;"> 5</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> fileName;<br></span><span style="color: #008080;"> 6</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> setFileName(String fileName) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> UnsupportedEncodingException {<br></span><span style="color: #008080;"> 8</span>         <span style="color: #0000ff;">this</span>.fileName = <span style="color: #0000ff;">new</span> String(fileName.getBytes(“iso8859-1”),”utf-8”<span style="color: #000000;">);<br></span><span style="color: #008080;"> 9</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">10</span>     <span style="color: #0000ff;">public</span> InputStream getDownloadFile() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> UnsupportedEncodingException, FileNotFoundException{<br></span><span style="color: #008080;">11</span>         <span style="color: #008000;">//</span><span style="color: #008000;">attachment为进行文件保存，这个时候还可以附件另一个参数filename表示保存时的缺省名称<br></span><span style="color: #008080;">12</span>         <span style="color: #008000;">//</span><span style="color: #008000;">inline为在线打开，不进行保存</span><br><span style="color: #008080;">13</span>         ServletActionContext.getResponse().setHeader(“Content-Disposition”,”attachment;fileName=”+ java.net.URLEncoder.encode(fileName, “UTF-8”<span style="color: #000000;">));<br></span><span style="color: #008080;">14</span>         HttpServletResponse response =<span style="color: #000000;"> ServletActionContext.getResponse();<br></span><span style="color: #008080;">15</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span> FileInputStream(“d:/“+<span style="color: #0000ff;">this</span><span style="color: #000000;">.getFileName());<br></span><span style="color: #008080;">16</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">17</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String downloadFile(){<br></span><span style="color: #008080;">18</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> SUCCESS;<br></span><span style="color: #008080;">19</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">20</span> }</pre><br></div>

<p>index.jsp代码如下：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;">1</span> &lt;%@ page language=”java” <span style="color: #0000ff;">import</span>=”java.util.*” pageEncoding=”utf-8”%&gt;<br><span style="color: #008080;">2</span> &lt;%@taglib prefix=”s” uri=”/struts-tags” %&gt;<br><span style="color: #008080;">3</span><br><span style="color: #008080;">4</span> <s:url value="download.action" var="url"><br><span style="color: #008080;">5</span>     <s:param name="fileName">中文.txt</s:param><br><span style="color: #008080;">6</span> </s:url><br><span style="color: #008080;">7</span> <a href="/${url }">点击下载</a></pre><br></div>

<p>action特殊的地方在于result的类型是一个流（stream），配置stream类型的结果时，因为无需指定实际的显示的物理资源，所以无需指定location属性，只需要指定inputName属性，该属性指向被下载文件的来源，对应着Action类中的某个属性，类型为InputStream,，struts2会寻找一个返回类型为InputStream的方法getInputStream()（方法名最好为getInputStream,有人说此方法名可以为别的可能需要与struts.xml中的inputName保存一致<span style="color: #66ffff; font-size: 12px;">下面有解释</span><span style="font-size: 16px;">，</span><span style="font-size: 16px;"><span style="line-height: 1.5; background-color: #f5f7f8; font-family: 宋体, Arial;"><strong>另一种理解：action中定义一个返回InputStream的方法，该方法作为被下载文件的入口，且需要配置stream类型结果时指定inputName参数，inputName参数的值就是方法去掉get前缀、首字母小写的字符串。</strong></span></span></p>
<p>&nbsp;</p>
<p><span style="line-height: 1.5; background-color: #f5f7f8; font-family: 宋体, Arial;"><span style="font-size: 16px;">下面则列出了和下载有关的一些参数列表：&nbsp;</span></span></p>
<div style="line-height: 1.5; background-color: #f5f7f8; margin: 0px; font-family: 宋体, Arial; padding: 0px;"><span style="font-size: 16px;">参数</span><span style="line-height: 1.5; font-size: 16px;">说明&nbsp;</span></div><br><div style="line-height: 1.5; background-color: #f5f7f8; margin: 0px; font-family: 宋体, Arial; padding: 0px;"><span style="font-size: 16px;">contentType&nbsp;</span></div><br><div style="line-height: 1.5; background-color: #f5f7f8; margin: 0px; font-family: 宋体, Arial; padding: 0px;"><span style="font-size: 16px;">内容类型，和互联网MIME标准中的规定类型一致，例如text/plain代表纯文本，text/xml表示XML，image/gif代表GIF图片，image/jpeg代表JPG图片&nbsp;</span></div><br><div style="line-height: 1.5; background-color: #f5f7f8; margin: 0px; font-family: 宋体, Arial; padding: 0px;"><span style="font-size: 16px;">&nbsp;</span></div><br><div style="line-height: 1.5; background-color: #f5f7f8; margin: 0px; font-family: 宋体, Arial; padding: 0px;"><span style="font-size: 16px;">inputName&nbsp;</span></div><br><div style="line-height: 1.5; background-color: #f5f7f8; margin: 0px; font-family: 宋体, Arial; padding: 0px;"><span style="font-size: 16px;">下载文件的来源流，对应着action类中某个类型为Inputstream的属性名，例如取值为inputStream的属性需要编写getInputStream()方法&nbsp;</span></div><br><div style="line-height: 1.5; background-color: #f5f7f8; margin: 0px; font-family: 宋体, Arial; padding: 0px;"><span style="font-size: 16px;">&nbsp;</span></div><br><div style="line-height: 1.5; background-color: #f5f7f8; margin: 0px; font-family: 宋体, Arial; padding: 0px;"><span style="font-size: 16px;">contentDisposition&nbsp;</span></div><br><div style="line-height: 1.5; background-color: #f5f7f8; margin: 0px; font-family: 宋体, Arial; padding: 0px;"><span style="font-size: 16px;">文件下载的处理方式，包括内联(inline)和附件(attachment)两种方式，而附件方式会弹出文件保存对话框，否则浏览器会尝试直接显示文件。取值为：&nbsp;</span></div><br><div style="line-height: 1.5; background-color: #f5f7f8; margin: 0px; font-family: 宋体, Arial; padding: 0px;"><span style="font-size: 16px;">&nbsp;</span></div><br><div style="line-height: 1.5; background-color: #f5f7f8; margin: 0px; font-family: 宋体, Arial; padding: 0px;"><span style="font-size: 16px;">attachment;filename=”struts2.txt”，表示文件下载的时候保存的名字应为struts2.txt。如果直接写filename=”struts2.txt”，那么默认情况是代表inline，浏览器会尝试自动打开它，等价于这样的写法：inline; filename=”struts2.txt”&nbsp;</span></div><br><div style="line-height: 1.5; background-color: #f5f7f8; margin: 0px; font-family: 宋体, Arial; padding: 0px;"><span style="font-size: 16px;">&nbsp;</span></div><br><div style="line-height: 1.5; background-color: #f5f7f8; margin: 0px; font-family: 宋体, Arial; padding: 0px;"><span style="font-size: 16px;">bufferSize&nbsp;</span></div><br><div style="line-height: 1.5; background-color: #f5f7f8; margin: 0px; font-family: 宋体, Arial; padding: 0px;"><span style="font-size: 16px;">下载缓冲区的大小</span></div>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuling07.github.io/2013/02/struts-file-download.html" data-id="ciiy5f4pb000sq1d0ogmhb6l0" class="article-share-link">Share</a>
      
        <a href="http://liuling07.github.io/2013/02/struts-file-download.html#ds-thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web后端/">web后端</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-myeclipse-webservice" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/01/myeclipse-webservice.html">使用MyEclipse构建webService简单案例</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2013/01/myeclipse-webservice.html">
      <time datetime="2013-01-31T07:08:00.000Z" itemprop="datePublished">2013-01-31</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/后端/">后端</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <div id="cnblogs_post_body"><br><br>转：<a href="http://www.cnblogs.com/jasoncc/archive/2011/12/22/2296052.html" target="_blank" rel="external">http://www.cnblogs.com/jasoncc/archive/2011/12/22/2296052.html</a><br><br>今天主要和大家分享，如何搭建一个Web服务，做Android开发，不可避免会涉及到客户端开发，我们怎么样来实现一个服务端，怎么样来实现一个客户端，并相互传递数据。就算调用别人的服务时，也能知道大概是怎么样实现的。<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WebService一般分为.Net版和Java版，今天我们主要来实现Java版的WebService，.Net版本的还是比较简单的。<br><br>&nbsp;&nbsp;&nbsp;&nbsp; 照例，轻松一笑：<br><br>&nbsp;&nbsp;&nbsp;&nbsp; 波音777是有史以来第一架完全在电脑虚拟现实中设计制造的飞机，所用的设备完全由IBM公司所提供。试飞前，波音公司的总裁非常热情的邀请IBM的技术主管去参加试飞，可那位主管却说道:&ldquo;啊，非常荣幸，可惜那天是我妻子的生日，所以…&rdquo;&nbsp;<br>波音公司的总载一听就生气了:&ldquo;胆小鬼，我还没告诉你试飞的日期呢!&rdquo;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/201112211649014549.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/201112211649055883.png" alt="1" title="1"></a><br><br><strong>&nbsp;&nbsp;&nbsp; 什么是WebServices？</strong><br><br>&nbsp;&nbsp;&nbsp; 它是一种构建应用程序的普遍模型,可以在任何支持网络通信的操作系统中实施运行;它是一种新的web应用程序分支，是自包含、自描述、模块化的应用，可以发布、定位、通过web调用。Web Service是一个应用组件,它逻辑性的为其他应用程序提供数据与服务.各应用程序通过网络协议和规定的一些标准数据格式（Http，XML，Soap)来访问Web Service,通过Web Service内部执行得到所需结果.Web Service可以执行从简单的请求到复杂商务处理的任何功能。一旦部署以后，其他Web Service应用程序可以发现并调用它部署的服务。<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<strong>关键的技术和规则</strong><br><br>&nbsp;&nbsp; 在构建和使用Web Service时,主要用到以下几个关键的技术和规则:<br><br>&nbsp;&nbsp;&nbsp;<span>1.XML</span>:描述数据的标准方法.<br><br>&nbsp;&nbsp;<span>2.SOAP</span>:表示信息交换的协议.<br><br>&nbsp;&nbsp;<span>3.WSDL</span>:Web服务描述语言.<br><br>&nbsp;&nbsp;&nbsp;<span>4.UDDI</span>:通用描述、发现与集成，它是一种独立于平台的，基于XML语言的用于在互联网上描述商务的协议。<br><br>&nbsp;&nbsp;&nbsp;<strong>XML</strong><br><br>&nbsp;&nbsp; 可扩展的标记语言(XML)是Web service平台中表示数据的基本格式。除了易于建立和易于分析外，<span>XML主要的优点在于它既是平台无关的，又是厂商无关的</span>。无关性是比技术优越性更重要的：软件厂商是不会选择一个由竞争对手所发明的技术的。<br><br><strong>&nbsp;&nbsp; SOAP</strong><br><br>&nbsp; SOAP是<span>web service的标准通信协议</span>，SOAP为simple object access protocoll的缩写，简单对象访问协议.&nbsp;<span>它是一种标准化的传输消息的XML消息格式</span>。<br><br><strong>&nbsp;&nbsp; WSDL</strong><br><br>&nbsp;&nbsp; WSDL的全称是web service Description Language,<span>是一种基于XML格式的关于web服务的描述语言</span>。其主要目的在于web service的提供者将自己的web服务的所有相关内容,如所提供的服务的传输方式，服务方法接口，接口参数，服务路径等，生成相应的完全文档，发布给使用者。使用者可以通过这个WSDL文档，创建相应的SOAP请求消息，通过HTTP传递给webservice提供者；web服务在完成服务请求后，将SOAP返回消息传回请求者，服务请求者再根据WSDL文档将SOAP返回消息解析成自己能够理解的内容。<br><br>&nbsp;&nbsp;<strong>UDDI</strong><br><br>&nbsp;&nbsp; 将web service进行UDDI注册发布,<span>UDDI是一种创建注册表服务的规范,以便大家将自己的web service进行注册发布供使用者查找.然而当服务提供者想将自己的web service向全世界公布</span>，以便外部找到其服务时，那么服务提供者可以将自己的web service注册到相应的UDDI商用注册网站，目前全球有IBM等4家UDDI商用注册网站。因为WSDL文件中已经给定了web service的地址URI，外部可以直接通过WSDL提供的URI进行相应的web service调用。所以UDDI并不是一个必需的web service组件，服务方完全可以不进行UDDI的注册。<br><br>&nbsp;&nbsp;<strong>创建并发布自己的WS</strong><br><br>&nbsp; 1 安装MyEclipse<br><br>&nbsp; 2 配置Tomcat<br><br>&nbsp;&nbsp; 打开MyEclipse<br><br>&nbsp;&nbsp;&nbsp;<a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/20111221164910838.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/201112211649134200.png" alt="2" title="2"></a><br><br>&nbsp;&nbsp; 菜单栏 &ndash;&gt; File &ndash;&gt; New &ndash;&gt; Web Service Project<br><br>&nbsp;&nbsp;&nbsp;<a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/20111221164917202.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/201112211649225158.png" alt="3" title="3"></a><br><br>&nbsp;&nbsp; 在这里，我们使用JAX-WS方式。<br><br>&nbsp;&nbsp;<strong>JAX-WS</strong><br><br>&nbsp; Jax-WS是Java1.6中才有的,新的WebService模式,基于注解的方式配置WebService,很类似Asp中的WebService,难度已经比Xfire方式的配置降低了很多.<br><br>&nbsp;&nbsp;&nbsp;<strong>REST(JAX-RS)</strong><br><br>&nbsp;&nbsp; 用的比较少<br><br>&nbsp;&nbsp;&nbsp;<strong>Xfire（已过时）</strong><br><br>&nbsp;&nbsp; 配置比较繁琐<br><br>&nbsp; 创建Service中的包及类库，实现自己的业务。<br><br>&nbsp; 我们创建的是一个用户管理系统，自然需要来管理用户。<br><br>&nbsp;&nbsp;<a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/201112211649269524.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/201112211649306016.png" alt="4" title="4"></a><br><br>&nbsp; 发布WS<br><br>&nbsp;&nbsp;&nbsp;<a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/201112211649326705.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/201112211649445517.png" alt="5" title="5"></a><br><br>&nbsp;&nbsp;<a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/201112211649541590.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/20111221164957284.png" alt="6" title="6"></a><br><br>&nbsp;<a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/201112211650015730.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/201112211650283553.png" alt="7" title="7"></a><br><br>&nbsp; 到此WS发布完成，接下来配置TomCat<br><br>&nbsp;&nbsp;<a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/201112211650319390.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/20111221165040381.png" alt="8" title="8"></a><br><br>&nbsp; 在弹出的窗体中依次展开 MyEclipse -&gt;Servers &ndash;&gt;Tomcat<br><br>&nbsp;<a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/201112211650438726.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/201112211650498797.png" alt="9" title="9"></a><br><br>&nbsp;<a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/201112211650516030.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/201112211650553328.png" alt="11" title="11"></a><br><br><a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/201112211650599887.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/201112211651058006.png" alt="12" title="12"></a><br><br>&nbsp; 对着项目右击添加库文件<br><br>&nbsp;&nbsp;<a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/201112211651102405.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/201112211651151048.png" alt="13" title="13"></a><br><br><a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/201112211651194758.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/201112211651239398.png" alt="14" title="14"></a><br><br><a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/201112211651439319.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/201112211651511290.png" alt="15" title="15"></a><br><br>&nbsp; 到此，所有步骤都以配置完毕 开始部署<br><br>&nbsp;&nbsp;<a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/201112211651541554.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/201112211651554751.png" alt="16" title="16"></a><br><br>&nbsp; 启动TomCat<br><br>&nbsp;&nbsp;<a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/201112211652037528.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/201112211652045086.png" alt="17" title="17"></a><br><br>&nbsp; 在工具栏中找到部署图标<br><br>&nbsp;&nbsp;<a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/201112211652083040.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/201112211652124026.png" alt="18" title="18"></a><br><br>&nbsp;&nbsp;<a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/201112211652163342.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/201112211653584488.png" alt="19" title="19"></a><br><br>&nbsp; 部署完成，打开IE进行测试<br><br>&nbsp;&nbsp;<strong>创建客户端进行测试</strong><br><br><strong>&nbsp;&nbsp;<a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/201112211654036346.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/201112211654078411.png" alt="21" title="21"></a></strong><br><br>&nbsp;&nbsp;<a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/201112211654129529.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/201112211654185173.png" alt="22" title="22"></a><br><br>&nbsp;&nbsp;<a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/201112211654273382.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/201112211654301760.png" alt="23" title="23"></a><br><br>&nbsp;&nbsp;<a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/201112211654384570.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/201112211654439733.png" alt="24" title="24"></a><br><br>&nbsp;&nbsp; 此时，项目中将会生成WS所需的类库文件<br><br>&nbsp;&nbsp;&nbsp;<a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/201112211654506905.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/201112211654533364.png" alt="25" title="25"></a><br><br>&nbsp;&nbsp;&nbsp; 创建一个调用测试类<br><br>&nbsp;&nbsp;&nbsp;<a href="http://images.cnblogs.com/cnblogs_com/jasoncc/201112/201112211654567565.png" target="_blank" rel="external"><img src="http://www.liuling123.com/wp-content/uploads/2015/11/20111221165505475.png" alt="27" title="27"></a><br><br>&nbsp; 到此，我们的WS就配置+测试完毕了。其实并不难，就算步骤比较多，比较繁琐，容易忘记，可以当一个备忘录吧，方便以后翻阅！<br><br></div>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuling07.github.io/2013/01/myeclipse-webservice.html" data-id="ciiy5f4s20050q1d00opinbt0" class="article-share-link">Share</a>
      
        <a href="http://liuling07.github.io/2013/01/myeclipse-webservice.html#ds-thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web后端/">web后端</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-cronexpression-quartz-spring" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/01/cronexpression-quartz-spring.html">Quartz在Spring中动态设置cronExpression （spring设置动态定时任务）------转帖</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2013/01/cronexpression-quartz-spring.html">
      <time datetime="2013-01-31T06:14:00.000Z" itemprop="datePublished">2013-01-31</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/后端/">后端</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <div id="app-share-content"><br><div><span style="font-size: small;">什么是动态定时任务：是由客户制定生成的，服务端只知道该去执行什么任务，但任务的定时是不确定的（是由客户制定）。</span></div><br><div><span style="font-size: small;">这样总不能修改配置文件每定制个定时任务就增加一个<span>trigger吧，即便允许客户修改配置文件，但总需要重新启动web服务啊，研究了下Quartz在Spring中的动态定时，发现<bean id="cronTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean"></bean></span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="jobDetail" ref="schedulerJobDetail"></property></span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="cronExpression"></property></span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <value>0/10 <em> </em> <em> </em> ?</value></span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></div><br><div><span style="font-size: small;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>中<span style="color: red;">cronExpression是关键，如果可以动态设置<span style="color: red;">cronExpression</span>的值，也就说如果我们可以直接调用CronTriggerBean中设置<span style="color: red;">cronExpression</span>的方法，就可以顺利解决问题了。</span></span></div><br><div><span style="font-size: small;">熟悉<span>1的朋友可以跳过不看，下面2、3是动态定时任务的具体实现。</span></span></div><br><div>&nbsp;</div><br><div style="text-indent: -18pt; margin: 0cm 0cm 0pt 18pt;"><span style="font-size: small;"><span>1． </span>Quartz在<span>Spring中的简单配置</span></span></div><br><div><span style="font-size: small;">Spring配置文件：</span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; <bean id="schedulerJobDetail" class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean"></bean></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="targetObject" ref="scheduleInfoAction"></property></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="<span style=" color:="" blue;"="">targetMethod</property></span>" value="<span style="color: purple;">simpleJobTest</span>"/></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="concurrent" value="false"></property></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; </span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; <bean id="cronTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean"></bean></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="jobDetail" ref="schedulerJobDetail"></property></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="**<span style=" color:="" red;"="">cronExpression</property></span>**"></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <value>0/10 <em> </em> <em> </em> ?</value></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; <bean id="schedulerFactory" class="org.springframework.scheduling.quartz.SchedulerFactoryBean"></bean></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="triggers"></property></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <list></list></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <ref local="cronTrigger"></ref></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></div><br><div><span style="font-size: small;"></span></div><br><div>&nbsp;</div><br><div><span style="font-size: small;">在上面的配置中设定了</span></div><br><div><span style="font-size: small;">① <span style="color: blue;">targetMethod: </span>指定需要定时执行<span>scheduleInfoAction中的simpleJobTest()方法</span></span></div><br><div><span style="font-size: small;">② concurrent：对于相同的<span>JobDetail，当指定多个Trigger时, 很可能第一个job完成之前，第二个job就开始了。指定concurrent设为false，多个job不会并发运行，第二个job将不会在第一个job完成之前开始。</span></span></div><br><div><span style="font-size: small;">③ <strong><span style="color: red;">cronExpression</span>：<span>0/10 <em> </em> <em> </em> ?表示每10秒执行一次，具体可参考<span style="color: purple;">附表</span>。</span></strong></span></div><br><div><span style="font-size: small;">④ triggers：通过再添加其他的<span>ref元素可在list中放置多个触发器。</span></span></div><br><div>&nbsp;</div><br><div><span style="font-size: small;">scheduleInfoAction中的<span>simpleJobTest()方法</span></span></div><br><div><span style="font-size: small;">注意：此方法没有参数，如果<span>scheduleInfoAction有两个方法<span style="color: purple;">simpleJobTest</span>()和simpleJobTest(String argument)，则spring只会去执行无参的<span style="color: purple;">simpleJobTest</span>().</span></span></div><br><div><span style="font-size: small;">public void <span style="color: purple;">simpleJobTest() { </span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log.warn(“uh oh, Job is scheduled !’” + “‘ Success…”);</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; }</span></span></div><br><div>&nbsp;</div><br><div><span style="font-size: small;"><span style="color: fuchsia;">2</span>．<span>Quartz在Spring中<strong><span style="color: purple;">动态设置</span></strong>cronTrigger方法一</span></span></div><br><div><span style="font-size: small;">Spring配置文件：</span></div><br><div align="left"><span style="font-size: small;"><bean id="scheduleInfoAction" class="com.lively.happyoa.jobs.webapp.action.ScheduleInfoAction"></bean></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="**<span style=" color:="" #003366;"="">scheduler</property></span>**" ref="schedulerFactory"/></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="**<span style=" color:="" #003366;"="">scheduleInfoManager</property></span>**" ref="scheduleInfoManager"/></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; </span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; <bean id="schedulerJobDetail" class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean"></bean></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="targetObject" ref="scheduleInfoAction"></property></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="targetMethod" value="**<span style=" color:="" purple;"="">reScheduleJob</property></span>**"/></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="concurrent" value="false"></property></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; </span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; <bean id="**<span style=" color:="" olive;"="">cronTrigger</bean></span>**" class="org.springframework.scheduling.quartz.CronTriggerBean" ></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="jobDetail" ref="schedulerJobDetail"></property></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="**<span style=" color:="" red;"="">cronExpression</property></span>**"></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <value>0/10 <em> </em> <em> </em> ?</value></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; <bean id="schedulerFactory" class="org.springframework.scheduling.quartz.SchedulerFactoryBean"></bean></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="triggers"></property></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <list></list></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <ref local="cronTrigger"></ref></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></div><br><div><span style="font-size: small;"></span></div><br><div>&nbsp;</div><br><div><span style="font-size: small;">scheduleInfoAction中的<strong><span style="color: purple;">reScheduleJob</span></strong> ()方法及相关方法</span></div><br><div><span style="font-size: small;">① <strong><span style="color: purple;">reScheduleJob</span>读取数据库，获得自定义定时器调度时间</strong>():</span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; private void <strong><span style="color: purple;">reScheduleJob</span></strong>() throws SchedulerException, ParseException {</span></span></div><br><div><span style="font-size: small;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // </span>运行时可通过动态注入的<span>scheduler得到trigger</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CronTriggerBean trigger = (CronTriggerBean) scheduler.getTrigger(</span></span></div><br><div><span style="font-size: small;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; “<strong><span style="color: olive;">cronTrigger</span></strong>“, Scheduler.DEFAULT_GROUP);</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String dbCronExpression = <span style="background: silver;">getCronExpressionFromDB</span>();</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String originConExpression = trigger.getCronExpression();</span></span></div><br><div><span style="font-size: small;"><span>&nbsp;&nbsp;&nbsp;&nbsp; // </span>判断从<span>DB中取得的任务时间(dbCronExpression)和现在的quartz线程中的任务时间(originConExpression)是否相等</span></span></div><br><div><span style="font-size: small;"><span>&nbsp;&nbsp;&nbsp;&nbsp; // </span>如果<span style="color: blue;">相等，则表示用户并没有重新设定数据库中的任务时间，这种情况<span style="color: blue;">不需要重新rescheduleJob</span></span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(!originConExpression.equalsIgnoreCase(dbCronExpression)){</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; trigger.setCronExpression(dbCronExpression);</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; scheduler.rescheduleJob(“<strong><span style="color: olive;">cronTrigger</span></strong>“, Scheduler.DEFAULT_GROUP, trigger);</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span></span></div><br><div><span style="font-size: small;"><span>&nbsp;&nbsp;&nbsp;&nbsp; // </span>下面是具体的<span>job内容，可自行设置</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; // executeJobDetail();</span></span></div><br><div style="text-indent: 18pt;"><span style="font-size: small;">}</span></div><br><div style="text-indent: 18pt;">&nbsp;</div><br><div><span style="font-size: small;">② <span style="background: silver;">getCronExpressionFromDB()</span>：从数据库中获得<span>dbCronExpression的具体代码，由于使用了scheduleInfoManager，所以要在定义相应的setter方法</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; private String <span style="background: silver;">getCronExpressionFromDB</span>(){</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String sql=”from ScheduleInfo scheduleInfo where 1=1 “;</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sql=sql+” and scheduleInfo.infoId = ‘“+”1” + “‘“;</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; List scheduleList = scheduleInfoManager.queryScheduleInListBySql(sql);</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ScheduleInfo scheduleInfo = (ScheduleInfo)scheduleList.get(0);</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String dbCronExpression = scheduleInfo.getCronExpression();</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return dbCronExpression;</span></span></div><br><div style="text-indent: 18pt;"><span style="font-size: small;">}</span></div><br><div style="text-indent: 18pt;">&nbsp;</div><br><div><span style="font-size: small;">③ 在<span>spring配置文件的scheduleInfoAction配置了相应的property（<strong><span style="color: #003366;">scheduler</span></strong>/<span style="color: #003366;"> <strong>scheduleInfoManager</strong></span>）,要为其设置setter方法</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; private Scheduler scheduler;</span></span></div><br><div><span style="font-size: small;"><span>&nbsp;&nbsp;&nbsp;&nbsp; // </span>设值注入，通过<span>setter方法传入被调用者的实例scheduler</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; public void <strong><span style="color: #003366;">setScheduler</span></strong>(Scheduler scheduler) {</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.scheduler = scheduler;</span></span></div><br><div><span style="font-size: small;"><span>&nbsp;&nbsp;&nbsp; }</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; private ScheduleInfoManager scheduleInfoManager;</span></span></div><br><div><span style="font-size: small;"><span>&nbsp;&nbsp;&nbsp;&nbsp; // </span>设值注入，通过<span>setter方法传入被调用者的实例scheduleInfoManager</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; public void <strong><span style="color: #003366;">setScheduleInfoManager</span></strong>(ScheduleInfoManager scheduleInfoManager){</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.scheduleInfoManager = scheduleInfoManager;</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; }</span></span></div><br><div>&nbsp;</div><br><div style="text-align: left; text-indent: -18pt; margin: 0cm 0cm 0pt 18pt;" align="left"><span style="font-size: small;"><span>3． </span>Quartz在<span>Spring中<strong><span style="color: purple;">动态设置</span></strong>cronTrigger方法二</span></span></div><br><div align="left"><span style="font-size: small;">在上面的<span style="color: fuchsia;">2中我们可以看到，尽管已经可以动态进行<span style="color: blue;">rescheduleJob</span>了，不过依然需要我们设置一个<strong><span style="color: red;">cronExpression</span></strong>，如果尝试一下拿掉spring配置中的</span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="**<span style=" color:="" red;"="">cronExpression</property></span>**"></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <value>0/10 <em> </em> <em> </em> ?</value></span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></div><br><div><span style="font-size: small;">则容器（如<span>tomcat）启动时会报错。</span></span></div><br><div><span style="font-size: small;">实际中我们希望<span>tomcat启动时就可以直接去读数据库，拿到相应的dbCronExpression，然后定时执行一个job，而不希望配置初始的<strong><span style="color: red;">cronExpression </span></strong>，观察下面的CronTriggerBean，考虑到<strong><span style="color: red;">cronExpression</span></strong>需要初始化，如果设定一个类<strong><span style="color: green;">InitializingCronTrigger</span></strong>继承CronTriggerBean，然后在这个类中做一些读取DB的初始化工作（设置<strong><span style="color: red;">cronExpression</span></strong>），问题就可以解决了。</span></span></div><br><div>&nbsp;</div><br><div><span style="font-size: small;">Spring配置文件：</span></div><br><div align="left"><span style="font-size: small;"><bean id="scheduleInfoAction" class="com.lively.happyoa.jobs.webapp.action.ScheduleInfoAction"></bean></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="**<span style=" color:="" #003366;"="">scheduler</property></span>**" ref="schedulerFactory"/></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="**<span style=" color:="" #003366;"="">scheduleInfoManager</property></span>**" ref="scheduleInfoManager"/></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; </span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; <bean id="schedulerJobDetail" class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean"></bean></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="targetObject" ref="scheduleInfoAction"></property></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="targetMethod" value="**<span style=" color:="" purple;"="">reScheduleJob</property></span>**"/></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="concurrent" value="false"></property></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; </span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="background: silver;"><bean id="**<span style=" color:="" olive;"="">cronTrigger</bean></span>**" class="com.lively.happyoa.jobs.webapp.action.ScheduleInfoAction.**<span style="color: green;">InitializingCronTrigger</span>**"></span></span></div><br><div align="left"><span style="background: silver;"><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="jobDetail" ref="schedulerJobDetail"></property></span></span></div><br><div align="left"><span style="background: silver;"><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: gray;"><!--<property name="**cronExpression**"></span></span></span></div>
<div align="left"><span style="background: silver; color: gray;"><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <value>0/10 * * * * ?</value></span></span></div>
<div align="left"><span style="background: silver; color: gray;"><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </property>--></span></span></span></div><br><div align="left"><span style="background: silver;"><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="**<span style=" color:="" #003366;"="">scheduleInfoManager</property></span>**" ref="scheduleInfoManager"/></span></div><br><div align="left"><span style="background: silver;"><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; <bean id="schedulerFactory" class="org.springframework.scheduling.quartz.SchedulerFactoryBean"></bean></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <property name="triggers"></property></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <list></list></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <ref local="cronTrigger"></ref></span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></div><br><div align="left"><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></div><br><div align="left"><span style="font-size: small;"></span></div><br><div>&nbsp;</div><br><div><span style="font-size: small;"><strong><span style="color: green;">InitializingCronTrigger</span></strong>中的相关方法</span></div><br><div><span style="font-size: small;">注意：在注入<span>scheduleInfoManager属性的时候，我们可以去读取DB任务时间（之所以放在setter方法中，是因为需要在设置scheduleInfoManager后进行<span style="background: silver;">getCronExpressionFromDB</span>()，否则，也可以<span style="color: blue;">①②</span>逻辑把放在类的构造函数中）.</span></span></div><br><div><span style="font-size: small;">注意<strong><span style="color: green;">InitializingCronTrigger</span></strong>必须<span style="color: fuchsia;">extends</span> <strong><span style="color: fuchsia;">CronTriggerBean</span></strong>.</span></div><br><div>&nbsp;</div><br><div><span style="font-size: small;">public class InitializingCronTrigger <span style="color: fuchsia;">extends <strong><span style="color: fuchsia;">CronTriggerBean</span></strong> implements Serializable {</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; private ScheduleInfoManager scheduleInfoManager;</span></span></div><br><div><span style="font-size: small;"><span>&nbsp;&nbsp;&nbsp;&nbsp; // </span>设值注入，通过<span>setter方法传入被调用者的实例scheduleInfoManager</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; public void <strong><span style="color: #003366;">setScheduleInfoManager</span></strong>(ScheduleInfoManager scheduleInfoManager){</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.scheduleInfoManager = scheduleInfoManager;</span></span></div><br><div><span style="font-size: small;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // </span>因为在<span style="background: silver;">getCronExpressionFromDB使用到了scheduleInfoManager，所以</span></span></div><br><div align="left"><span style="font-size: small;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // </span>必须上一行代码设置<span>scheduleInfoManager后进行<span style="background: silver;">getCronExpressionFromDB</span></span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String cronExpression = <span style="background: silver;">getCronExpressionFromDB</span> ();&nbsp;&nbsp;&nbsp; // <span style="color: blue;">①</span></span></span></div><br><div><span style="font-size: small;"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // </span>因为<span style="color: fuchsia;">extends <strong><span style="color: fuchsia;">CronTriggerBean </span>，此处调用父类方法初始化<strong><span style="color: red;">cronExpression</span></strong></strong></span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong><span style="color: blue;">setCronExpression</span></strong>(cronExpression);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // <span style="color: blue;">②</span></span></span></div><br><div style="text-indent: 21pt;"><span style="font-size: small;">}</span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp; private String <span style="background: silver;">getCronExpressionFromDB</span>(){</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String sql=”from ScheduleInfo scheduleInfo where 1=1 “;</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sql=sql+” and scheduleInfo.infoId = ‘“+”1” + “‘“;</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; List scheduleList = scheduleInfoManager.queryScheduleInListBySql(sql);</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ScheduleInfo scheduleInfo = (ScheduleInfo)scheduleList.get(0);</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; String dbCronExpression = scheduleInfo.getCronExpression();</span></span></div><br><div><span><span style="font-size: small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return dbCronExpression;</span></span></div><br><div style="text-indent: 21pt;"><span style="font-size: small;">}</span></div><br><div style="text-indent: 21pt;"><span style="font-size: small;">&hellip;&hellip;</span></div><br><div><span style="font-size: small;">}</span></div><br><div>&nbsp;</div><br><div>&nbsp;</div><br><div><span style="font-size: small;">附表：</span></div><br><div><span style="font-size: small;">“0 0 12 <em> </em> ?” 每天中午12点触发<br>“0 15 10 ? <em> </em>“ 每天上午10:15触发<br>“0 15 10 <em> </em> ?” 每天上午10:15触发<br>“0 15 10 <em> </em> ? <em>“ 每天上午10:15触发<br>“0 15 10 </em> <em> ? 2005” 2005年的每天上午10:15触发<br>“0 </em> 14 <em> </em> ?” 在每天下午2点到下午2:59期间的每1分钟触发<br>“0 0/5 14 <em> </em> ?” 在每天下午2点到下午2:55期间的每5分钟触发<br>“0 0/5 14,18 <em> </em> ?” 在每天下午2点到2:55期间和下午6点到6:55期间的每5分钟触发<br>“0 0-5 14 <em> </em> ?” 在每天下午2点到下午2:05期间的每1分钟触发<br>“0 10,44 14 ? 3 WED” 每年三月的星期三的下午2:10和2:44触发<br>“0 15 10 ? <em> MON-FRI” 周一至周五的上午10:15触发<br>“0 15 10 15 </em> ?” 每月15日上午10:15触发<br>“0 15 10 L <em> ?” 每月最后一日的上午10:15触发<br>“0 15 10 ? </em> 6L” 每月的最后一个星期五上午10:15触发<br>“0 15 10 ? <em> 6L 2002-2005” 2002年至2005年的每月的最后一个星期五上午10:15触发<br>“0 15 10 ? </em> 6#3” 每月的第三个星期五上午10:15触发<br></span><br><br><span style="font-size: small;">至于每个符号 看看例子就好了.很简单了.</span><br><br></div>

<p></p></div><p></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuling07.github.io/2013/01/cronexpression-quartz-spring.html" data-id="ciiy5f4x300cwq1d01q2oj2h4" class="article-share-link">Share</a>
      
        <a href="http://liuling07.github.io/2013/01/cronexpression-quartz-spring.html#ds-thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web后端/">web后端</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-hibernate-map-one-to-one" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/01/hibernate-map-one-to-one.html">hibernate中一对多关系的映射</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2013/01/hibernate-map-one-to-one.html">
      <time datetime="2013-01-14T06:59:00.000Z" itemprop="datePublished">2013-01-14</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/后端/">后端</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>　　昨天初次接触hibernate,仅仅弄懂了一对一关系的映射。今天学习了一天又有了新的收获，弄懂了一对多之间关系的映射。</p>
<p>一、一对多的关系映射</p>
<p>　　建立一对多关系关系的表的原则是将一的一方的主键加入到多的一方的表作为外键。这里以员工和部门为例子来演示。以前不用hibernate时建立pojo类要在员工类Emp中加入一个属性，即部门编号deptid.使用hibernate则不同了，需要在&ldquo;一&rdquo;的一方类中加入一个set集合，里面存放&ldquo;多&rdquo;的一方的对象。而在&ldquo;多&rdquo;的一方的类中需要加入一个&ldquo;一&rdquo;方的对象。也就是说在Dept类中需要加入一个set集合，存放Emp对象，因为一个部门里面对应多个员工，所以用一个集合来表示。而每一个员工只能属于一个部门，所以员工类Emp里面需要加入一个Depe类对象，表示所属部门。部门类和员工类的代码如下　</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> Dept <span style="color: #0000ff;">implements</span><span style="color: #000000;"> Serializable {<br></span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> deptId;<br></span><span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> String deptName;<br></span><span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">private</span> Set<emp> emps = <span style="color: #0000ff;">new</span> HashSet<emp><span style="color: #000000;">();<br></span><span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> getDeptId() {<br></span><span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> deptId;<br></span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> setDeptId(<span style="color: #0000ff;">int</span><span style="color: #000000;"> deptId) {<br></span><span style="color: #008080;"> 9</span>         <span style="color: #0000ff;">this</span>.deptId =<span style="color: #000000;"> deptId;<br></span><span style="color: #008080;">10</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">11</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String getDeptName() {<br></span><span style="color: #008080;">12</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> deptName;<br></span><span style="color: #008080;">13</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">14</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setDeptName(String deptName) {<br></span><span style="color: #008080;">15</span>         <span style="color: #0000ff;">this</span>.deptName =<span style="color: #000000;"> deptName;<br></span><span style="color: #008080;">16</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">17</span>     <span style="color: #0000ff;">public</span> Set<emp><span style="color: #000000;"> getEmps() {<br></span><span style="color: #008080;">18</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> emps;<br></span><span style="color: #008080;">19</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">20</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> setEmps(Set<emp><span style="color: #000000;"> emps) {<br></span><span style="color: #008080;">21</span>         <span style="color: #0000ff;">this</span>.emps =<span style="color: #000000;"> emps;<br></span><span style="color: #008080;">22</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">23</span> }</emp></emp></emp></emp></pre><br></div><br><div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> Emp <span style="color: #0000ff;">implements</span><span style="color: #000000;"> Serializable{<br></span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> empNo;<br></span><span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> String empName;<br></span><span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> Date empBirthday;<br></span><span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> Dept dept;<br></span><span style="color: #008080;"> 6</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> getEmpNo() {<br></span><span style="color: #008080;"> 7</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> empNo;<br></span><span style="color: #008080;"> 8</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> setEmpNo(<span style="color: #0000ff;">int</span><span style="color: #000000;"> empNo) {<br></span><span style="color: #008080;">10</span>         <span style="color: #0000ff;">this</span>.empNo =<span style="color: #000000;"> empNo;<br></span><span style="color: #008080;">11</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">12</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String getEmpName() {<br></span><span style="color: #008080;">13</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> empName;<br></span><span style="color: #008080;">14</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">15</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setEmpName(String empName) {<br></span><span style="color: #008080;">16</span>         <span style="color: #0000ff;">this</span>.empName =<span style="color: #000000;"> empName;<br></span><span style="color: #008080;">17</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">18</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> Date getEmpBirthday() {<br></span><span style="color: #008080;">19</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> empBirthday;<br></span><span style="color: #008080;">20</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">21</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setEmpBirthday(Date empBirthday) {<br></span><span style="color: #008080;">22</span>         <span style="color: #0000ff;">this</span>.empBirthday =<span style="color: #000000;"> empBirthday;<br></span><span style="color: #008080;">23</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">24</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> Dept getDept() {<br></span><span style="color: #008080;">25</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> dept;<br></span><span style="color: #008080;">26</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">27</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setDept(Dept dept) {<br></span><span style="color: #008080;">28</span>         <span style="color: #0000ff;">this</span>.dept =<span style="color: #000000;"> dept;<br></span><span style="color: #008080;">29</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">30</span><br><span style="color: #008080;">31</span> }</pre><br></div>

<p>　　写完pojo类后就要配置这两个类和表之间的映射关系了，代码如下：</p>
<p>1.Dept.hbm.xml</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <hibernate-mapping><br><span style="color: #008080;"> 2</span>     <!-- 表和类之间的映射 --><br><span style="color: #008080;"> 3</span>     &lt;<span style="color: #0000ff;">class</span> name=”com.pojo.Dept” table=”dept”&gt;<br><span style="color: #008080;"> 4</span>         <!-- 主键映射 --><br><span style="color: #008080;"> 5</span>         <id name="deptId" column="deptId"><br><span style="color: #008080;"> 6</span>             <generator <span="" style="color: #0000ff;">class=”native”&gt;</generator><br><span style="color: #008080;"> 7</span>         </id><br><span style="color: #008080;"> 8</span>         <!-- 属性映射 --><br><span style="color: #008080;"> 9</span>         <property name="deptName" column="deptName" length="50"></property><br><span style="color: #008080;">10</span>         <!-- 表之间关系映射 --><br><span style="color: #008080;">11</span>         <set name="emps" cascade="save-update,delete"><br><span style="color: #008080;">12</span>             <key column="deptId"></key><br><span style="color: #008080;">13</span>             <one-to-many <span="" style="color: #0000ff;">class=”com.pojo.Emp”/&gt;<br><span style="color: #008080;">14</span>         </one-to-many></set><br><span style="color: #008080;">15</span>     &lt;/<span style="color: #0000ff;">class</span>&gt;<br><span style="color: #008080;">16</span> </hibernate-mapping></pre><br></div>

<p>这里面配置了一个set,里面的name=”emps”表示在Dept类里的属性emps,它是一个集合，存放Emp对象的。cascade=”save-update,delete”指明可以级联删除，级联插入数据。cascade有四个值：all、save-update、delete、none,默认就是none,表示不能级联操作。<one-to-many class="com.pojo.Emp">表示Dept与Emp是一对多的关系，他们是以deptId建立关系的，即deptId是Emp的外键。</one-to-many></p>
<p>2.Emp.hbm.xml</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <hibernate-mapping><br><span style="color: #008080;"> 2</span>     <!-- 表和类之间的映射 --><br><span style="color: #008080;"> 3</span>     &lt;<span style="color: #0000ff;">class</span> name=”com.pojo.Emp” table=”emp”&gt;<br><span style="color: #008080;"> 4</span>         <!-- 主键映射 --><br><span style="color: #008080;"> 5</span>         <id name="empNo" column="empNo"><br><span style="color: #008080;"> 6</span>             <generator <span="" style="color: #0000ff;">class=”native”&gt;</generator><br><span style="color: #008080;"> 7</span>         </id><br><span style="color: #008080;"> 8</span>         <!-- 属性映射 --><br><span style="color: #008080;"> 9</span>         <property name="empName" column="empName" length="50"></property><br><span style="color: #008080;">10</span>         <property name="empBirthday" column="empBirthday"></property><br><span style="color: #008080;">11</span>         <!-- 表之间关系映射 --><br><span style="color: #008080;">12</span>         <many-to-one name="dept" column="deptId"></many-to-one><br><span style="color: #008080;">13</span>     &lt;/<span style="color: #0000ff;">class</span>&gt;<br><span style="color: #008080;">14</span> </hibernate-mapping></pre><br></div>

<p>　　这里加了<many-to-one></many-to-one>表示Emp与Dept是多对一的关系，name=”dept”表示在Emp类里面有一个属性是Dept对对象dept,column=”deptId”表示 它们之间是用deptId建立联系的。</p>
<p>下面是级联插入数据的代码：</p>
<div class="cnblogs_code"><br><pre><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.test;<br></span><span style="color: #008080;"> 2</span><br><span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Date;<br></span><span style="color: #008080;"> 4</span><br><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.hibernate.Session;<br></span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.hibernate.Transaction;<br></span><span style="color: #008080;"> 7</span><br><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.pojo.Dept;<br></span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.pojo.Emp;<br></span><span style="color: #008080;">10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.util.DBUtil;<br></span><span style="color: #008080;">11</span><br><span style="color: #008080;">12</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> 级联插入数据 {<br></span><span style="color: #008080;">13</span><br><span style="color: #008080;">14</span>     <span style="color: #008000;">/<em>*</em></span><br><span style="color: #008080;">15</span> <span style="color: #008000;">      </span><span style="color: #808080;">@param</span><span style="color: #008000;"> args<br></span><span style="color: #008080;">16</span>      <span style="color: #008000;">*/</span><br><span style="color: #008080;">17</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {<br></span><span style="color: #008080;">18</span>         <span style="color: #008000;">//</span><span style="color: #008000;">获得session</span><br><span style="color: #008080;">19</span>         Session session =<span style="color: #000000;"> DBUtil.getSession();<br></span><span style="color: #008080;">20</span>         <span style="color: #008000;">//</span><span style="color: #008000;">新建一个dept</span><br><span style="color: #008080;">21</span>         Dept dept = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Dept();<br></span><span style="color: #008080;">22</span>         dept.setDeptName(“吃饭部”<span style="color: #000000;">);<br></span><span style="color: #008080;">23</span><br><span style="color: #008080;">24</span>         <span style="color: #008000;">//</span><span style="color: #008000;">新建emp</span><br><span style="color: #008080;">25</span>         Emp e1 = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Emp();<br></span><span style="color: #008080;">26</span>         e1.setEmpName(“李白”<span style="color: #000000;">);<br></span><span style="color: #008080;">27</span>         e1.setEmpBirthday(<span style="color: #0000ff;">new</span><span style="color: #000000;"> Date());<br></span><span style="color: #008080;">28</span><br><span style="color: #008080;">29</span>         Emp e2 = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Emp();<br></span><span style="color: #008080;">30</span>         e2.setEmpName(“王维”<span style="color: #000000;">);<br></span><span style="color: #008080;">31</span>         e2.setEmpBirthday(<span style="color: #0000ff;">new</span><span style="color: #000000;"> Date());<br></span><span style="color: #008080;">32</span><br><span style="color: #008080;">33</span> <span style="color: #000000;">        dept.getEmps().add(e1);<br></span><span style="color: #008080;">34</span> <span style="color: #000000;">        dept.getEmps().add(e2);<br></span><span style="color: #008080;">35</span><br><span style="color: #008080;">36</span>         Transaction tr =<span style="color: #000000;"> session.beginTransaction();<br></span><span style="color: #008080;">37</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {<br></span><span style="color: #008080;">38</span> <span style="color: #000000;">            session.save(dept);<br></span><span style="color: #008080;">39</span> <span style="color: #000000;">            tr.commit();<br></span><span style="color: #008080;">40</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {<br></span><span style="color: #008080;">41</span> <span style="color: #000000;">            tr.rollback();<br></span><span style="color: #008080;">42</span>         }<span style="color: #0000ff;">finally</span><span style="color: #000000;">{<br></span><span style="color: #008080;">43</span> <span style="color: #000000;">            session.close();<br></span><span style="color: #008080;">44</span> <span style="color: #000000;">        }<br></span><span style="color: #008080;">45</span> <span style="color: #000000;">    }<br></span><span style="color: #008080;">46</span><br><span style="color: #008080;">47</span> }</pre><br></div>

<p>先建立一个dept对象，然后建立两个emp对象，然后把这两个emp对象加入到dept对象的集合里面，然后保存dept。级联插入只要操作父表，就可以操作子表。前提是要在前面那个cascade=”save-update”必须写。</p>
<p>　</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuling07.github.io/2013/01/hibernate-map-one-to-one.html" data-id="ciiy5f4vb009xq1d0bsf8mwj7" class="article-share-link">Share</a>
      
        <a href="http://liuling07.github.io/2013/01/hibernate-map-one-to-one.html#ds-thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web后端/">web后端</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/11/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/13/">Next &raquo;</a>
      </nav>
    </section>
      
        <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新博文</h3>
    <div class="widget">
      <ul id="recent-post" class="no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/人生感悟/">人生感悟</a></p>
              <p class="item-title"><a href="/2015/12/say-bye-to-my-2015.html" class="title">Say bye to my 2015</a></p>
              <p class="item-date"><time datetime="2015-12-25T09:25:10.000Z" itemprop="datePublished">2015-12-25</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/Android/">Android</a></p>
              <p class="item-title"><a href="/2015/12/mvp-pattern-android.html" class="title">MVP模式在Android项目中的使用</a></p>
              <p class="item-date"><time datetime="2015-12-23T14:16:04.000Z" itemprop="datePublished">2015-12-23</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/Android/">Android</a></p>
              <p class="item-title"><a href="/2015/12/intent-resolving-in-android-m.html" class="title">【译文】Android M中Intent的解析</a></p>
              <p class="item-date"><time datetime="2015-12-04T06:52:06.000Z" itemprop="datePublished">2015-12-04</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/Android/">Android</a></p>
              <p class="item-title"><a href="/2015/12/performance-listviews.html" class="title">【译文】高性能ListViews</a></p>
              <p class="item-date"><time datetime="2015-12-02T10:22:14.000Z" itemprop="datePublished">2015-12-02</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/Android/">Android</a></p>
              <p class="item-title"><a href="/2015/11/android-multi-photo-picker.html" class="title">Android带多选功能的PhotoPicker</a></p>
              <p class="item-date"><time datetime="2015-11-21T07:46:03.000Z" itemprop="datePublished">2015-11-21</time></p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">博文分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Framework/">Framework</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hadoop/">Hadoop</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JNI-amp-NDK/">JNI&amp;NDK</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java基础/">Java基础</a><span class="category-list-count">35</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NoSQL/">NoSQL</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/人生感悟/">人生感悟</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/其他技术/">其他技术</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/后端/">后端</a><span class="category-list-count">29</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构和算法/">数据结构和算法</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><span class="category-list-count">7</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/AsyncTask/" style="font-size: 11.54px;">AsyncTask</a> <a href="/tags/LruCache/" style="font-size: 10px;">LruCache</a> <a href="/tags/MVP/" style="font-size: 10px;">MVP</a> <a href="/tags/NoSQL/" style="font-size: 13.08px;">NoSQL</a> <a href="/tags/android/" style="font-size: 18.46px;">android</a> <a href="/tags/android-studio/" style="font-size: 10px;">android studio</a> <a href="/tags/c/" style="font-size: 10px;">c++</a> <a href="/tags/camera/" style="font-size: 10px;">camera</a> <a href="/tags/framework/" style="font-size: 10.77px;">framework</a> <a href="/tags/hadoop/" style="font-size: 14.62px;">hadoop</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/jni/" style="font-size: 13.08px;">jni</a> <a href="/tags/linux/" style="font-size: 16.15px;">linux</a> <a href="/tags/mysql/" style="font-size: 11.54px;">mysql</a> <a href="/tags/redis/" style="font-size: 13.08px;">redis</a> <a href="/tags/spring/" style="font-size: 10.77px;">spring</a> <a href="/tags/sqlite/" style="font-size: 10px;">sqlite</a> <a href="/tags/web后端/" style="font-size: 19.23px;">web后端</a> <a href="/tags/内存缓存/" style="font-size: 10px;">内存缓存</a> <a href="/tags/前端/" style="font-size: 13.85px;">前端</a> <a href="/tags/反射/" style="font-size: 10px;">反射</a> <a href="/tags/图片选择/" style="font-size: 10.77px;">图片选择</a> <a href="/tags/多线程/" style="font-size: 17.69px;">多线程</a> <a href="/tags/布局/" style="font-size: 12.31px;">布局</a> <a href="/tags/布局优化/" style="font-size: 10.77px;">布局优化</a> <a href="/tags/开源/" style="font-size: 10.77px;">开源</a> <a href="/tags/断点续传/" style="font-size: 11.54px;">断点续传</a> <a href="/tags/科学上网/" style="font-size: 10px;">科学上网</a> <a href="/tags/自定义控件/" style="font-size: 10px;">自定义控件</a> <a href="/tags/解决方案/" style="font-size: 16.92px;">解决方案</a> <a href="/tags/设计模式/" style="font-size: 15.38px;">设计模式</a> <a href="/tags/译文/" style="font-size: 10.77px;">译文</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">博文归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">March 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">November 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">September 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">August 2013</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">May 2013</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">November 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">August 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">July 2012</a><span class="archive-list-count">8</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap widget-list">
    <h3 class="widget-title">友情链接</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a target="_blank" href="http://blog.daimajia.com">代码家</a>
          </li>
        
          <li>
            <a target="_blank" href="http://www.trinea.cn">Trinea</a>
          </li>
        
          <li>
            <a target="_blank" href="https://www.aswifter.com">APP开发者</a>
          </li>
        
          <li>
            <a target="_blank" href="http://blog.seoui.com">笑松小站</a>
          </li>
        
          <li>
            <a target="_blank" href="http://www.apkfuns.com">舞影凌风</a>
          </li>
        
          <li>
            <a target="_blank" href="http://www.ttfde.org">TTF的家园</a>
          </li>
        
          <li>
            <a target="_blank" href="http://rocko.xyz">Rocko&#39;s blog</a>
          </li>
        
          <li>
            <a target="_blank" href="http://www.93sec.cc">教程资源网</a>
          </li>
        
      </ul>
    </div>
  </div>


  
  <div id="toTop" class="fa fa-chevron-up"></div>
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2000 - 2016 Lauren<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    

<script type="text/javascript">
  var duoshuoQuery = {short_name:"liuling07"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>





 <script src="//ajax.lug.ustc.edu.cn/ajax/libs/jquery/2.1.3/jquery.min.js"></script>




  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>